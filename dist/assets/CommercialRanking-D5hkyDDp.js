import{u as Q,r as n,j as e,C as q}from"./index-HcuLVkXM.js";import{f as K,b as Y}from"./commercial-BJ1Dvjq-.js";import{f as u}from"./utils-C6qNh0Lg.js";import{D as R}from"./download-CcofxccE.js";import{L as B}from"./loader-2-CJ7EHZdi.js";import{A as V}from"./arrow-up-down-BIh5lzKs.js";const D=o=>o.toISOString().slice(0,10),z=o=>{const f=new Date,r=new Date;switch(o){case"quinzenal":r.setDate(r.getDate()-15);break;case"mensal":r.setMonth(r.getMonth()-1);break;case"trimestral":r.setMonth(r.getMonth()-3);break;case"semestral":r.setMonth(r.getMonth()-6);break;case"anual":r.setFullYear(r.getFullYear()-1);break}return{from:D(r),to:D(f)}},x=o=>`"${String(o).replace(/"/g,'""')}"`,Z=()=>{const{effectiveClinicId:o}=Q(),[f,r]=n.useState(!0),[i,$]=n.useState("faturamento"),[b,j]=n.useState("desc"),[l,v]=n.useState([]),[h,A]=n.useState(""),[p,M]=n.useState(""),[P,C]=n.useState("mensal"),[{from:c,to:d},N]=n.useState(()=>z("mensal"));n.useEffect(()=>{(async()=>{if(!o){v([]),r(!1);return}r(!0);const a=await K({clinicId:o,from:c||void 0,to:d||void 0});v(Y(a)),r(!1)})()},[o,c,d]);const F=n.useMemo(()=>{const t=new Set;return l.forEach(a=>{(a.categorias||[]).forEach(s=>{s&&t.add(s)})}),Array.from(t).sort((a,s)=>a.localeCompare(s))},[l]),E=n.useMemo(()=>{const t=new Set;return l.forEach(a=>{(a.procedimentos||[]).forEach(s=>{s&&t.add(s)})}),Array.from(t).sort((a,s)=>a.localeCompare(s))},[l]),k=n.useMemo(()=>l.filter(t=>!(h&&!(t.categorias||[]).includes(h)||p&&!(t.procedimentos||[]).includes(p))),[l,h,p]),g=n.useMemo(()=>{const t=b==="asc"?1:-1;return[...k].sort((a,s)=>a[i]<s[i]?-1*t:a[i]>s[i]?1*t:0)},[k,i,b]),L=t=>{i===t?j(a=>a==="asc"?"desc":"asc"):($(t),j("desc"))},O=t=>{C(t),t!=="personalizado"&&N(z(t))},S=(t,a)=>{C("personalizado"),N({from:t,to:a})},T=()=>{const t=["Cliente","Faturamento","Atendimentos","Ticket médio","Recorrência","Qtd procedimentos"],a=g.map(m=>[x(m.name),x((m.faturamento||0).toFixed(2)),x(m.atendimentos||0),x((m.ticket||0).toFixed(2)),x(m.recorrencia||0),x(m.procedimentosCount||0)].join(",")),s=[t.join(","),...a].join(`
`),I=new Blob([s],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(I),y=document.createElement("a");y.href=w,y.download=`ranking-clientes-${c||"inicio"}-${d||"fim"}.csv`,y.click(),URL.revokeObjectURL(w)},U=()=>{const t=g.map(s=>`<tr>
      <td>${s.name}</td>
      <td>${u(s.faturamento||0)}</td>
      <td>${s.atendimentos}</td>
      <td>${u(s.ticket||0)}</td>
      <td>${s.recorrencia}</td>
      <td>${s.procedimentosCount}</td>
    </tr>`).join(""),a=window.open("","_blank");a&&(a.document.write(`
      <html><head><title>Ranking de Clientes</title>
      <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
      </head><body>
      <h3>Ranking de Clientes (${c||"início"} a ${d||"fim"})</h3>
      <table><thead><tr><th>Cliente</th><th>Faturamento</th><th>Atendimentos</th><th>Ticket médio</th><th>Recorrência</th><th>Qtd procedimentos</th></tr></thead>
      <tbody>${t}</tbody>
      </table>
      </body></html>
    `),a.document.close(),a.print())};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Comercial • Ranking dos Clientes"}),e.jsx("p",{className:"text-gray-500",children:"Ranking analítico por faturamento, ticket e recorrência."}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center gap-2 text-sm text-gray-600",children:["Clinic: ",o||"—"]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white",children:[e.jsx(q,{size:16})," Período:",e.jsxs("select",{value:P,onChange:t=>O(t.target.value),className:"text-sm bg-transparent focus:outline-none",children:[e.jsx("option",{value:"quinzenal",children:"Últimos 15 dias"}),e.jsx("option",{value:"mensal",children:"Últimos 30 dias"}),e.jsx("option",{value:"trimestral",children:"Últimos 3 meses"}),e.jsx("option",{value:"semestral",children:"Últimos 6 meses"}),e.jsx("option",{value:"anual",children:"Últimos 12 meses"}),e.jsx("option",{value:"personalizado",children:"Personalizado"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"De"}),e.jsx("input",{type:"date",value:c,onChange:t=>S(t.target.value,d),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"Até"}),e.jsx("input",{type:"date",value:d,onChange:t=>S(c,t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"Categorias:"}),e.jsxs("select",{value:h,onChange:t=>A(t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700",children:[e.jsx("option",{value:"",children:"Todas"}),F.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"Procedimentos:"}),e.jsxs("select",{value:p,onChange:t=>M(t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700",children:[e.jsx("option",{value:"",children:"Todos"}),E.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-3 py-2 text-sm border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(R,{size:14})," PDF"]}),e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-3 py-2 text-sm border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(R,{size:14})," CSV"]})]}),f?e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-500",children:[e.jsx(B,{className:"animate-spin mr-2",size:20})," Carregando..."]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100 text-gray-600",children:e.jsx("tr",{children:[["name","Cliente"],["faturamento","Faturamento"],["atendimentos","Atendimentos"],["ticket","Ticket médio"],["recorrencia","Recorrência (datas)"],["procedimentosCount","Qtd. procedimentos"]].map(([t,a])=>e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{onClick:()=>L(t),className:"inline-flex items-center gap-1 text-gray-700 hover:text-brand-600",children:[a," ",e.jsx(V,{size:14})]})},t))})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[g.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 font-semibold text-gray-800",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-gray-800",children:u(t.faturamento||0)}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.atendimentos}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:u(t.ticket||0)}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.recorrencia}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.procedimentosCount})]},a)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-400",children:"Sem dados para a clínica."})})]})]})})]})]})};export{Z as default};
