import{r,a as ys,u as js,j as e,T as vs,U as Rt,e as Ns,s as d,f as ws}from"./index-HcuLVkXM.js";import{c as Cs,b as _s}from"./utils-C6qNh0Lg.js";import{u as Lt}from"./useModalControls-BiWM_r1l.js";import{D as de}from"./download-CcofxccE.js";import{U as lt}from"./upload-DlYh6qZH.js";import{L as ie}from"./loader-2-CJ7EHZdi.js";import{P as te}from"./plus-DDz1DOCh.js";import{T as qt}from"./trash-2-FGsD9cgR.js";import{C as Ss}from"./credit-card-Cayxm7x4.js";const ks=u=>{const j=(u.match(/,/g)||[]).length;return(u.match(/;/g)||[]).length>j?";":","},Es=(u,j)=>{const N=[];let C="",S=!1;for(let G=0;G<u.length;G++){const W=u[G];if(W==='"'){S=!S;continue}W===j&&!S?(N.push(C),C=""):C+=W}return N.push(C),N.map(G=>G.trim())},ot=async u=>{const j=await u.arrayBuffer(),C=new TextDecoder("utf-8",{fatal:!1}).decode(j).replace(/^\uFEFF/,"");return C.includes("�")?new TextDecoder("windows-1252",{fatal:!1}).decode(j).replace(/^\uFEFF/,""):C},Sa=u=>{const N=u.replace(/^\uFEFF/,"").split(/\r?\n/).filter(W=>W.trim().length>0);if(!N.length)throw new Error("Arquivo vazio");const C=ks(N[0]),S=W=>Es(W,C),G=S(N[0]).map(W=>W.toLowerCase());return{lines:N,header:G,parseLine:S}},ka=u=>{const j=u.trim().toLowerCase();return j?["c","create","criar","novo","adicionar","inserir"].includes(j)?"create":["u","update","atualizar","editar","edit"].includes(j)?"update":["d","delete","apagar","remover","excluir"].includes(j)?"delete":null:null},Ps=u=>{const j=u.trim().toLowerCase();return j?["receita","receitas","r","income"].includes(j)?"receita":["despesa","despesas","d","expense"].includes(j)?"despesa":null:null},Ea="user-avatars",ct=350,Us=u=>u.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,As=u=>new Promise((j,N)=>{const C=new Image,S=URL.createObjectURL(u);C.onload=()=>{URL.revokeObjectURL(S),j({width:C.width,height:C.height})},C.onerror=()=>{URL.revokeObjectURL(S),N(new Error("Imagem inválida."))},C.src=S}),Pa=async u=>{if(!u.type.startsWith("image/"))return"Envie um arquivo de imagem.";try{const{width:j,height:N}=await As(u);return j!==N?"A imagem precisa ser quadrada.":j>ct||N>ct?`A imagem deve ter no máximo ${ct} x ${ct}px.`:null}catch{return"Não foi possível ler a imagem."}},Ua=async(u,j)=>{const N=Us(j.name),C=`clinics/${u}/${crypto.randomUUID()}-${N}`,{error:S}=await d.storage.from(Ea).upload(C,j,{upsert:!0});if(S)throw S;const{data:G}=d.storage.from(Ea).getPublicUrl(C);return G.publicUrl},Aa=(u,j)=>{const N=u.trim();if(N){const S=N.split(/\s+/).filter(Boolean);return S.length===1?S[0].slice(0,2).toUpperCase():`${S[0][0]||""}${S[S.length-1][0]||""}`.toUpperCase()}const C=j.trim();return C?C.slice(0,2).toUpperCase():"US"},Ts=()=>{const[u,j]=r.useState("geral"),[N,C]=ys(),[S,G]=r.useState(!0),[W,Ia]=r.useState([]),[J,$t]=r.useState("receita"),[Mt,Dt]=r.useState(!1),{effectiveClinicId:l,isAdmin:Fa,clinic:U,role:za}=js(),Re=[{value:"/",label:"Dash Financeiro"},{value:"/reports/attendance",label:"Relatório de Atendimento"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/assistant",label:"Assistente AI"},{value:"/profile",label:"Meu perfil"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Minha Clínica"},{value:"/settings?section=geral",label:"Minha Clínica • Informações gerais"},{value:"/settings?section=categorias",label:"Minha Clínica • Categorias"},{value:"/settings?section=taxas",label:"Minha Clínica • Taxas"},{value:"/settings?section=clientes",label:"Minha Clínica • Clientes"},{value:"/settings?section=procedimentos",label:"Minha Clínica • Procedimentos"},{value:"/settings?section=profissionais",label:"Minha Clínica • Profissionais"},{value:"/settings?section=fornecedores",label:"Minha Clínica • Fornecedores"},{value:"/settings?section=usuarios",label:"Minha Clínica • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dash comercial"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"},{value:"/pricing/calculator",label:"Precificação • Calculadora"},{value:"/pricing/procedures",label:"Precificação • Procedimentos"},{value:"/pricing/expenses",label:"Precificação • Gastos"},{value:"/pricing/focus-matrix",label:"Precificação • Matriz de Foco"},{value:"/hr/departments",label:"Minha Clínica • Departamentos"},{value:"/hr/collaborators",label:"Minha Clínica • Colaboradores"},{value:"/hr/feedback",label:"Recursos Humanos • Feedback"},{value:"/hr/meetings",label:"Recursos Humanos • Reuniões"},{value:"/app/agenda",label:"Recursos Humanos • Agenda"},{value:"/hr/archetypes",label:"Recursos Humanos • Arquétipos"},{value:"/hr/values",label:"Recursos Humanos • Teoria de valores"},{value:"/analytics/perfil",label:"Analytics • Perfil comportamental"}],Le=r.useMemo(()=>Object.fromEntries(Re.map(t=>[t.value,t.label])),[]),[je,qe]=r.useState(""),[Tt,Ot]=r.useState(!1),[$e,dt]=r.useState(null),[Vt,Ra]=r.useState([]),[R,me]=r.useState({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"}),[Bt,Gt]=r.useState(!1),[Me,mt]=r.useState(null),[Ht,La]=r.useState([]),[X,ve]=r.useState({name:"",cpf:"",cep:""}),[De,D]=r.useState(null),[Te,Oe]=r.useState(!1),[Ne,we]=r.useState(null),[Qt,Wt]=r.useState(!1),[Ve,Jt]=r.useState(null),[Be,qa]=r.useState(""),[ut,Ge]=r.useState(1),[ge,fe]=r.useState([]),[Kt,He]=r.useState(!1),[Z,Ce]=r.useState({name:"",cpf:"",cep:""}),xt=10,[Qe,$a]=r.useState([]),[A,le]=r.useState({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),[We,_e]=r.useState(null),[Xt,Zt]=r.useState(!1),[Yt,ea]=r.useState(!1),[ta,Se]=r.useState(!1),[he,ke]=r.useState([]),[aa,Ma]=r.useState(""),[sa,Da]=r.useState([]),[ae,Je]=r.useState({nome:"",tipo:"venda"}),[pt,ra]=r.useState(null),[na,ia]=r.useState(!1),[gt,Ta]=r.useState([]),[T,Ee]=r.useState({nome:"",cnpj:"",telefone:""}),[ft,la]=r.useState(null),[oa,ca]=r.useState(!1),[da,ma]=r.useState(!1),[ht,ua]=r.useState([]),[I,se]=r.useState({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),[bt,xa]=r.useState(null),[Ke,oe]=r.useState(!1),[pa,re]=r.useState(null),[yt,Oa]=r.useState(""),[jt,ga]=r.useState(!1),[vt,Nt]=r.useState(null),[Xe,wt]=r.useState(null),[Ze,Ct]=r.useState(null),[fa,Pe]=r.useState(!1),ha=()=>{He(!1),we(null),D(null)},ba=()=>{Se(!1),_e(null)},ya=()=>{Pe(!1),it()},Va=Lt({isOpen:Kt,onClose:ha}),Ba=Lt({isOpen:ta,onClose:ba}),Ga=Lt({isOpen:fa,onClose:ya}),[P,Y]=r.useState({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),[ja,ee]=r.useState(null),[_t,Ye]=r.useState(null),[et,tt]=r.useState(null),[at,st]=r.useState(null),St=r.useRef(null),kt=r.useRef(null),K=t=>t.replace(/\D/g,""),Ha=4500,va=async(t,a=Ha)=>{const s=K(t);if(s.length!==8)return null;const n=`https://nominatim.openstreetmap.org/search?postalcode=${encodeURIComponent(s)}&country=Brazil&format=json&limit=1`;try{const c=new AbortController,g=setTimeout(()=>c.abort(),a),b=await fetch(n,{headers:{"Accept-Language":"pt-BR"},signal:c.signal});if(clearTimeout(g),!b.ok)return null;const x=await b.json();return!x||!x[0]?null:{lat:parseFloat(x[0].lat),lng:parseFloat(x[0].lon)}}catch{return null}},Na=async(t,a)=>{if(!t)return;if(!a){await d.from("customers").update({lat:null,lng:null}).eq("id",t);return}const s=await va(a);s&&await d.from("customers").update({lat:s.lat,lng:s.lng}).eq("id",t)},Qa=async t=>{const a=t.map(c=>({id:c.id,cep:c.cep?K(c.cep):""})).filter(c=>c.cep.length===8);if(!a.length)return;const s=4,n=[...a];await Promise.all(Array.from({length:s}).map(async()=>{for(;n.length;){const c=n.shift();if(!c)return;const g=await va(c.cep);g&&await d.from("customers").update({lat:g.lat,lng:g.lng}).eq("id",c.id)}}))},Ue=r.useMemo(()=>(U?.paginas_liberadas||[]).map(t=>t.trim()).filter(Boolean),[U?.paginas_liberadas]),H=r.useMemo(()=>{if(!Ue.length)return Re;const t=Ue.includes("/settings");return Re.filter(a=>a.value==="/settings?section=usuarios"&&t||Ue.includes(a.value))},[Ue,Re]),wa=r.useMemo(()=>new Set(H.map(t=>t.value)),[H]),be=za==="owner",Ca=Cs("/auth/reset");r.useEffect(()=>()=>{Xe?.startsWith("blob:")&&URL.revokeObjectURL(Xe)},[Xe]),r.useEffect(()=>()=>{et?.startsWith("blob:")&&URL.revokeObjectURL(et)},[et]);const Et=t=>{const a=K(t);if(a.length!==11||/^(\d)\1+$/.test(a))return!1;const s=n=>{let c=0;for(let b=0;b<n;b++)c+=parseInt(a[b],10)*(n+1-b);const g=c*10%11;return g===10?0:g};return s(9)===parseInt(a[9],10)&&s(10)===parseInt(a[10],10)},rt=async()=>{try{G(!0);let t=d.from("categories").select("*").order("name");l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;if(s)throw s;Ia(a||[])}catch(t){console.error(t)}finally{G(!1)}},Pt=async()=>{let t=d.from("card_fees").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Ra(a)},ye=async()=>{let t=d.from("customers").select("*").order("name",{ascending:!0});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&La(a)},Ae=async()=>{let t=d.from("procedures").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&$a(a)},Ut=async()=>{let t=d.from("professionals").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Da(a)},nt=async()=>{let t=d.from("suppliers").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Ta(a)},Ie=async()=>{if(!l){ua([]);return}ga(!0);const{data:t,error:a}=await d.from("clinic_users").select("*").eq("clinic_id",l).order("created_at",{ascending:!1});!a&&t&&ua(t),ga(!1)};r.useEffect(()=>{const t=N.get("section");t&&["geral","categorias","taxas","clientes","procedimentos","profissionais","fornecedores","usuarios"].includes(t)&&j(t)},[N]),r.useEffect(()=>{u==="usuarios"&&be&&Ie()},[l,u,be]);const ce=t=>{j(t);const a=new URLSearchParams(N);a.set("section",t),C(a,{replace:!0})},Wa=async t=>{if(!l){alert("Nenhuma clínica ativa encontrada para associar os clientes.");return}Wt(!0),Jt(null);try{const s=(await ot(t)).split(/\r?\n/).filter(o=>o.trim().length>0);if(!s.length)throw new Error("Arquivo vazio.");const n=s[0],c=(n.match(/,/g)||[]).length,b=(n.match(/;/g)||[]).length>c?";":",",x=o=>{const i=[];let m="",p=!1;for(let w=0;w<o.length;w++){const $=o[w];if($==='"'){p=!p;continue}$===b&&!p?(i.push(m),m=""):m+=$}return i.push(m),i.map(w=>w.trim())},h=x(n).map(o=>o.toLowerCase()),v=h.some(o=>o.includes("cpf")||o.includes("nome")),z=v?s.slice(1):s,O=o=>{const i=h.findIndex(m=>o.some(p=>m.includes(p)));return i>=0?i:-1},V=v?O(["nome"]):-1,xe=v?O(["cpf"]):-1,pe=v?O(["cep"]):-1,Q=new Set,q=[],L=[],E=(o,i,m)=>{const p=i>=0?i:m;return o[p]??""};z.forEach(o=>{const i=x(o),m=(!v&&i.length>=3,0),p=E(i,V,m+0),w=E(i,xe,m+1),$=E(i,pe,m+2),F=K(w),k=K($);if(!p.trim()){q.push({name:p,cpf:w,cep:k,reason:"Nome obrigatório"});return}if(F){if(!Et(F)){q.push({name:p,cpf:w,cep:k,reason:"CPF inválido"});return}if(Q.has(F)){q.push({name:p,cpf:w,cep:k,reason:"CPF duplicado no arquivo"});return}Q.add(F)}L.push({name:p.trim(),cpf:F||null,cep:k||null})});const{data:y}=await d.from("customers").select("cpf").eq("clinic_id",l),_=new Set((y||[]).map(o=>K(o.cpf||"")).filter(Boolean)),f=L.filter(o=>o.cpf&&_.has(o.cpf)?(q.push({name:o.name,cpf:o.cpf,cep:o.cep||"",reason:"CPF já existe na clínica"}),!1):!0);if(f.length){const o=f.map(p=>({name:p.name,cpf:p.cpf,cep:p.cep||null,clinic_id:l})),{data:i,error:m}=await d.from("customers").insert(o).select("id, cep");if(m)throw m;i&&i.length&&Qa(i)}Jt({imported:f.length,rejected:q}),ye()}catch(a){alert("Erro ao importar clientes: "+a.message)}finally{Wt(!1)}};r.useEffect(()=>{l&&(rt(),Pt(),ye(),Ae(),Ut(),nt())},[l]);const Ja=async t=>{if(t.preventDefault(),!l){alert("Nenhuma clínica ativa definida.");return}if(je.trim()){Ot(!0);try{if($e){const{error:a}=await d.from("categories").update({name:je}).eq("id",$e);if(a)throw a}else{const{error:a}=await d.from("categories").insert([{name:je,tipo:J,cor_opcional:J==="receita"?"#0ea5e9":"#ef4444",clinic_id:l}]);if(a)throw a}qe(""),dt(null),rt()}catch(a){alert("Erro ao criar: "+a.message)}finally{Ot(!1)}}},Ka=async t=>{if(confirm("Excluir categoria?"))try{const{error:a}=await d.from("categories").delete().eq("id",t);if(a)throw a;$e===t&&(dt(null),qe("")),rt()}catch(a){alert("Erro: "+a.message)}},Xa=async t=>{if(!l){alert("Nenhuma clínica ativa definida.");return}Dt(!0);try{const a=await ot(t),{lines:s,header:n,parseLine:c}=Sa(a),g=n.some(f=>["acao","ação","action","nome","categoria","tipo","id"].some(o=>f.includes(o))),b=g?s.slice(1):s,x=f=>{const o=n.findIndex(i=>f.some(m=>i.includes(m)));return o>=0?o:-1},h=g?x(["acao","ação","action"]):-1,v=g?x(["id"]):-1,z=g?x(["nome","categoria"]):-1,O=g?x(["tipo"]):-1,V=z>=0?z:h>=0||v>=0?2:0,xe=O>=0?O:h>=0||v>=0?3:1,pe=v>=0?v:h>=0?1:-1,Q=[],q=[],L=[],E=[],y=(f,o,i)=>{const m=o>=0?o:i;return(f[m]??"").trim()};b.forEach((f,o)=>{const i=c(f);if(i.every(M=>!M.trim()))return;const m=h>=0?y(i,h,0):"",p=y(i,v,pe),w=y(i,z,V),$=y(i,O,xe);let F=m?ka(m):null;if(m&&!F){E.push({line:o+1,reason:"Ação inválida"});return}if(F||(F=p?"update":"create"),F==="delete"){if(!p){E.push({line:o+1,reason:"ID obrigatório para apagar"});return}L.push(p);return}const k=Ps($);if(F==="create"){if(!w){E.push({line:o+1,reason:"Nome obrigatório"});return}const M=k||J;Q.push({name:w,tipo:M,cor_opcional:M==="receita"?"#0ea5e9":"#ef4444",clinic_id:l});return}if(!p){E.push({line:o+1,reason:"ID obrigatório para atualizar"});return}const B={};if(w&&(B.name=w),k&&(B.tipo=k,B.cor_opcional=k==="receita"?"#0ea5e9":"#ef4444"),!Object.keys(B).length){E.push({line:o+1,reason:"Nada para atualizar"});return}q.push({id:p,payload:B})});const _=Q.length+q.length+L.length;if(!_&&E.length===0){alert("Nenhuma linha válida encontrada no CSV.");return}if(Q.length){const{error:f}=await d.from("categories").insert(Q);if(f)throw f}if(q.length){const o=(await Promise.all(q.map(i=>d.from("categories").update(i.payload).eq("id",i.id).eq("clinic_id",l)))).find(i=>i.error);if(o?.error)throw o.error}if(L.length){const{error:f}=await d.from("categories").delete().in("id",L).eq("clinic_id",l);if(f)throw f}if(rt(),_||E.length){const f=[`Criadas: ${Q.length}`,`Atualizadas: ${q.length}`,`Apagadas: ${L.length}`,`Rejeitadas: ${E.length}`].join(" • ");alert(`Importação de categorias concluída. ${f}`)}}catch(a){alert("Erro ao importar categorias: "+a.message)}finally{Dt(!1)}},Za=async t=>{if(!l){alert("Nenhuma clínica ativa definida.");return}ma(!0);try{const a=await ot(t),{lines:s,header:n,parseLine:c}=Sa(a),g=n.some(i=>["acao","ação","action","nome","cnpj","documento","telefone","id"].some(m=>i.includes(m))),b=g?s.slice(1):s,x=i=>{const m=n.findIndex(p=>i.some(w=>p.includes(w)));return m>=0?m:-1},h=g?x(["acao","ação","action"]):-1,v=g?x(["id"]):-1,z=g?x(["nome"]):-1,O=g?x(["cnpj","documento","doc"]):-1,V=g?x(["telefone","fone","celular"]):-1,xe=z>=0?z:h>=0||v>=0?2:0,pe=O>=0?O:h>=0||v>=0?3:1,Q=V>=0?V:h>=0||v>=0?4:2,q=v>=0?v:h>=0?1:-1,L=[],E=[],y=[],_=[],f=(i,m,p)=>{const w=m>=0?m:p;return(i[w]??"").trim()};b.forEach((i,m)=>{const p=c(i);if(p.every(bs=>!bs.trim()))return;const w=h>=0?f(p,h,0):"",$=f(p,v,q),F=f(p,z,xe),k=f(p,O,pe),B=f(p,V,Q);let M=w?ka(w):null;if(w&&!M){_.push({line:m+1,reason:"Ação inválida"});return}if(M||(M=$?"update":"create"),M==="delete"){if(!$){_.push({line:m+1,reason:"ID obrigatório para apagar"});return}y.push($);return}const _a=k?K(k)||k:"";if(M==="create"){if(!F){_.push({line:m+1,reason:"Nome obrigatório"});return}L.push({nome:F,cnpj:_a||null,telefone:B||null,clinic_id:l});return}if(!$){_.push({line:m+1,reason:"ID obrigatório para atualizar"});return}const ze={};if(F&&(ze.nome=F),k&&(ze.cnpj=_a||null),B&&(ze.telefone=B||null),!Object.keys(ze).length){_.push({line:m+1,reason:"Nada para atualizar"});return}E.push({id:$,payload:ze})});const o=L.length+E.length+y.length;if(!o&&_.length===0){alert("Nenhuma linha válida encontrada no CSV.");return}if(L.length){const{error:i}=await d.from("suppliers").insert(L);if(i)throw i}if(E.length){const m=(await Promise.all(E.map(p=>d.from("suppliers").update(p.payload).eq("id",p.id).eq("clinic_id",l)))).find(p=>p.error);if(m?.error)throw m.error}if(y.length){const{error:i}=await d.from("suppliers").delete().in("id",y).eq("clinic_id",l);if(i)throw i}if(nt(),o||_.length){const i=[`Criados: ${L.length}`,`Atualizados: ${E.length}`,`Apagados: ${y.length}`,`Rejeitados: ${_.length}`].join(" • ");alert(`Importação de fornecedores concluída. ${i}`)}}catch(a){alert("Erro ao importar fornecedores: "+a.message)}finally{ma(!1)}},Ya=async t=>{if(t.preventDefault(),!l){alert("Nenhuma clínica ativa definida.");return}if(!R.bandeira.trim())return;const a=parseInt(R.min_installments||"1",10)||1,s=parseInt(R.max_installments||"1",10)||1;if(a>s){alert("Intervalo de parcelas inválido (mínimo maior que máximo).");return}Gt(!0);try{const n=parseFloat(R.taxa_percent.replace(",","."))||0;if(Me){const{error:c}=await d.from("card_fees").update({bandeira:R.bandeira,taxa_percent:n,metodo:R.metodo,min_installments:a,max_installments:s,clinic_id:l}).eq("id",Me);if(c)throw c}else{const{error:c}=await d.from("card_fees").insert([{bandeira:R.bandeira,taxa_percent:n,metodo:R.metodo,min_installments:a,max_installments:s,clinic_id:l}]);if(c)throw c}me({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"}),mt(null),Pt()}catch(n){alert("Erro ao salvar taxa: "+n.message)}finally{Gt(!1)}},es=async t=>{if(!confirm("Excluir taxa?"))return;const{error:a}=await d.from("card_fees").delete().eq("id",t);a||(Me===t&&(mt(null),me({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"})),Pt())},ts=async t=>{if(t.preventDefault(),D(null),!l){D("Nenhuma clínica ativa encontrada.");return}if(!X.name.trim())return;const a=K(X.cpf),s=K(X.cep);if(a&&!Et(a)){D("CPF inválido.");return}if(s&&s.length!==8){D("CEP inválido (use 8 dígitos).");return}if(a){const{data:n}=await d.from("customers").select("id").eq("cpf",a).eq("clinic_id",l).maybeSingle();if(n){D("CPF já cadastrado.");return}}Oe(!0);try{const n={name:X.name,cpf:a||null,cep:s||null,clinic_id:l},{data:c,error:g}=await d.from("customers").insert([n]).select("id, cep");if(g)throw g;const b=c?.[0];b?.id&&Na(b.id,s||null),ve({name:"",cpf:"",cep:""}),ye()}catch(n){alert("Erro ao salvar cliente: "+n.message)}finally{Oe(!1)}},as=async t=>{if(t.preventDefault(),!Ne)return;if(D(null),!l){D("Nenhuma clínica ativa encontrada.");return}if(!Z.name.trim())return;const a=K(Z.cpf),s=K(Z.cep);if(a&&!Et(a)){D("CPF inválido.");return}if(s&&s.length!==8){D("CEP inválido (use 8 dígitos).");return}if(a){const{data:n}=await d.from("customers").select("id").eq("cpf",a).eq("clinic_id",l).maybeSingle();if(n&&n.id!==Ne){D("CPF já cadastrado.");return}}Oe(!0);try{const{error:n}=await d.from("customers").update({name:Z.name,cpf:a||null,cep:s||null,clinic_id:l}).eq("id",Ne);if(n)throw n;Na(Ne,s||null),He(!1),we(null),Ce({name:"",cpf:"",cep:""}),ye()}catch(n){alert("Erro ao salvar cliente: "+n.message)}finally{Oe(!1)}},ss=async t=>{if(!confirm("Excluir cliente?"))return;const{error:a}=await d.from("customers").delete().eq("id",t);a||(Ne===t&&(we(null),ve({name:"",cpf:"",cep:""})),fe(s=>s.filter(n=>n!==t)),ye())},rs=async()=>{if(!ge.length||!confirm(`Excluir ${ge.length} clientes selecionados?`))return;const{error:t}=await d.from("customers").delete().in("id",ge);if(t){alert("Erro ao excluir clientes: "+t.message);return}fe([]),ye()},ns=t=>{const a=h=>`"${String(h??"").replace(/"/g,'""')}"`,s=["Nome","CPF","CEP"],n=t.map(h=>[a(h.name||""),a(h.cpf||""),a(h.cep||"")].join(",")),c=[s.join(","),...n].join(`
`),g=new Blob([c],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(g),x=document.createElement("a");x.href=b,x.download="clientes.csv",x.click(),URL.revokeObjectURL(b)},is=(t,a)=>{const s=v=>`"${String(v??"").replace(/"/g,'""')}"`,n=["nome","tipo"],c=t.map(v=>[s(v.name||""),s(v.tipo||a)].join(",")),g=[n.join(","),...c].join(`
`),b=new Blob([g],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(b),h=document.createElement("a");h.href=x,h.download=`categorias_${a}.csv`,h.click(),URL.revokeObjectURL(x)},ls=t=>{const a=h=>`"${String(h??"").replace(/"/g,'""')}"`,s=["nome","documento","telefone"],n=t.map(h=>[a(h.nome||""),a(h.cnpj||""),a(h.telefone||"")].join(",")),c=[s.join(","),...n].join(`
`),g=new Blob([c],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(g),x=document.createElement("a");x.href=b,x.download="fornecedores.csv",x.click(),URL.revokeObjectURL(b)},os=t=>{const a=window.open("","_blank");if(!a)return;const s=t.map(n=>`
      <tr>
        <td>${n.name||""}</td>
        <td>${n.cpf||""}</td>
        <td>${n.cep||""}</td>
      </tr>
    `).join("");a.document.write(`
      <html>
        <head>
          <title>Clientes</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 24px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ddd; padding: 8px; font-size: 12px; }
            th { background: #f3f4f6; text-align: left; }
          </style>
        </head>
        <body>
          <h2>Clientes</h2>
          <table>
            <thead>
              <tr><th>Nome</th><th>CPF</th><th>CEP</th></tr>
            </thead>
            <tbody>${s}</tbody>
          </table>
        </body>
      </html>
    `),a.document.close(),a.focus(),a.print()},cs=()=>{se({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),re(null),Nt(null),wt(null),Ct(null)},it=()=>{xa(null),Y({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),ee(null),Ye(null),tt(null),st(null)},ds=t=>{xa(t.id),Y({name:t.name||"",email:t.email||"",role:t.role||"user",ativo:t.ativo!==!1,paginas_liberadas:t.paginas_liberadas||[],avatar_url:t.avatar_url||null}),ee(null),Ye(null),tt(null),st(null),Pe(!0)},ms=async t=>{if(!l)return;const{error:a}=await d.from("clinic_users").update({ativo:t.ativo===!1}).eq("id",t.id).eq("clinic_id",l);if(a){alert("Erro ao atualizar usuário: "+a.message);return}Ie()},us=async t=>{const a=await Pa(t);if(a){Ct(a),Nt(null),wt(null);return}Ct(null),Nt(t),wt(URL.createObjectURL(t))},xs=async t=>{const a=await Pa(t);if(a){st(a),Ye(null),tt(null);return}st(null),Ye(t),tt(URL.createObjectURL(t))},ps=async t=>{if(!l)return;if(!be){alert("Apenas o super admin da clínica pode excluir usuários.");return}const a=t.name||t.email||"este usuário";if(!confirm(`Apagar ${a}?`))return;const{error:s}=await d.from("clinic_users").delete().eq("id",t.id).eq("clinic_id",l);if(s){alert("Erro ao apagar usuário: "+s.message);return}bt===t.id&&(Pe(!1),it()),Ie()},gs=async t=>{if(t.preventDefault(),!be){re("Apenas o super admin da clínica pode gerenciar usuários.");return}if(!l){re("Nenhuma clínica ativa encontrada.");return}const a=I.name.trim(),s=I.email.trim().toLowerCase();if(!a||!s){re("Nome e e-mail são obrigatórios.");return}if(Ze&&vt){re(Ze);return}const n=H.length>0?I.paginas_liberadas.filter(x=>wa.has(x)):I.paginas_liberadas;oe(!0),re(null);let c=I.avatar_url;if(vt)try{c=await Ua(l,vt)}catch(x){re(`Erro ao enviar imagem: ${x.message}`),oe(!1);return}const g={clinic_id:l,name:a,email:s,role:I.role,ativo:I.ativo,paginas_liberadas:n,avatar_url:c||null},b=await d.from("clinic_users").insert(g);if(b.error){re(b.error.message),oe(!1);return}if(Ca){const x={shouldCreateUser:!0,emailRedirectTo:Ca},{error:h}=await d.auth.signInWithOtp({email:s,options:x});h&&re(`Usuário criado, mas não foi possível enviar o e-mail: ${h.message}`)}cs(),Ie(),oe(!1)},fs=async t=>{if(t.preventDefault(),!be){ee("Apenas o super admin da clínica pode gerenciar usuários.");return}if(!l){ee("Nenhuma clínica ativa encontrada.");return}if(!bt){ee("Nenhum usuário selecionado para edição.");return}const a=P.name.trim(),s=P.email.trim().toLowerCase();if(!a||!s){ee("Nome e e-mail são obrigatórios.");return}if(at&&_t){ee(at);return}const n=H.length>0?P.paginas_liberadas.filter(x=>wa.has(x)):P.paginas_liberadas;oe(!0),ee(null);let c=P.avatar_url;if(_t)try{c=await Ua(l,_t)}catch(x){ee(`Erro ao enviar imagem: ${x.message}`),oe(!1);return}const g={clinic_id:l,name:a,email:s,role:P.role,ativo:P.ativo,paginas_liberadas:n,avatar_url:c||null},b=await d.from("clinic_users").update(g).eq("id",bt).eq("clinic_id",l);if(b.error){ee(b.error.message),oe(!1);return}Pe(!1),it(),Ie(),oe(!1)},At=W.filter(t=>t.tipo===J),ne=r.useMemo(()=>{const t=Be.trim().toLowerCase(),a=[...Ht].sort((s,n)=>(s.name||"").localeCompare(n.name||""));return t?a.filter(s=>(s.name||"").toLowerCase().includes(t)):a},[Ht,Be]),ue=Math.max(1,Math.ceil(ne.length/xt)),Fe=Math.min(ut,ue),hs=ne.slice((Fe-1)*xt,Fe*xt),It=r.useMemo(()=>{const t=yt.trim().toLowerCase();return t?ht.filter(a=>{const s=(a.name||"").toLowerCase(),n=(a.email||"").toLowerCase();return s.includes(t)||n.includes(t)}):ht},[ht,yt]),Ft=Xe||I.avatar_url||"",zt=et||P.avatar_url||"";return r.useEffect(()=>{Ge(1)},[Be]),r.useEffect(()=>{ut>ue&&Ge(ue)},[ut,ue]),e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Minha Clínica"}),e.jsx("p",{className:"text-gray-500",children:"Gerencie informações e cadastros da clínica"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>ce("geral"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="geral"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Informações gerais"}),e.jsx("button",{onClick:()=>ce("categorias"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="categorias"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Categorias"}),e.jsx("button",{onClick:()=>ce("taxas"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="taxas"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Taxas de Cartão"}),e.jsx("button",{onClick:()=>ce("clientes"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="clientes"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Clientes"}),e.jsx("button",{onClick:()=>ce("procedimentos"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="procedimentos"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Procedimentos"}),e.jsx("button",{onClick:()=>ce("profissionais"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="profissionais"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Profissionais"}),e.jsx("button",{onClick:()=>ce("fornecedores"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="fornecedores"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Fornecedores"}),Fa&&e.jsx("button",{onClick:()=>ce("usuarios"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${u==="usuarios"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Usuários"})]}),u==="geral"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsx("div",{className:"h-20 w-20 rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:U?.logo_url?e.jsx("img",{src:U.logo_url,alt:"Logo da clínica",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:(U?.name||"CL").slice(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Informações gerais"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Dados cadastrados da clínica."})]})]}),U?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ID da clínica"}),e.jsx("p",{className:"text-sm font-medium text-gray-800 break-all",children:U.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nome da clínica"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Responsável"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.responsavel_nome||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Documento"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.documento||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"E-mail de contato"}),e.jsx("p",{className:"text-sm font-medium text-gray-800 break-all",children:U.email_contato||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Telefone de contato"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.telefone_contato||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Plano"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.plano||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Status"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.ativo===!1?"Inativa":"Ativa"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Criado em"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:U.created_at?_s(U.created_at):"-"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Páginas liberadas"}),U.paginas_liberadas&&U.paginas_liberadas.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:U.paginas_liberadas.map(t=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full border border-gray-200 text-gray-600",children:Le[t]||t},t))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma página definida."})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nenhuma clínica ativa encontrada."})]}),u==="categorias"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsx("button",{onClick:()=>$t("receita"),className:`flex-1 py-4 text-sm font-medium text-center transition-colors ${J==="receita"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50":"text-gray-500 hover:text-gray-700"}`,children:"Categorias de Receitas"}),e.jsx("button",{onClick:()=>$t("despesa"),className:`flex-1 py-4 text-sm font-medium text-center transition-colors ${J==="despesa"?"text-red-600 border-b-2 border-red-600 bg-red-50":"text-gray-500 hover:text-gray-700"}`,children:"Categorias de Despesas"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre categorias individualmente ou importe via CSV."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`nome,tipo
Categoria ${J==="receita"?"Receita":"Despesa"},${J}`)}`,download:`modelo_categorias_${J}.csv`,className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>is(At,J),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Baixar CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Mt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(lt,{size:14})," ",Mt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Xa(t.target.files[0]),t.target.value="")}})]})]})]}),e.jsxs("form",{onSubmit:Ja,className:"flex gap-3 mb-8",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{value:je,onChange:t=>qe(t.target.value),placeholder:`Nova categoria de ${J}...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("button",{type:"submit",disabled:Tt||!je.trim(),className:"px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50 flex items-center gap-2",children:[Tt?e.jsx(ie,{size:18,className:"animate-spin"}):e.jsx(te,{size:18}),$e?"Atualizar":"Adicionar"]})]}),S?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Carregando..."}):e.jsxs("ul",{className:"divide-y divide-gray-100",children:[At.map(t=>e.jsxs("li",{className:"py-3 flex items-center justify-between hover:bg-gray-50 px-2 rounded-lg -mx-2 transition-colors",children:[e.jsx("span",{className:"font-medium text-gray-700",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{dt(t.id),qe(t.name)},className:"text-xs text-gray-500 hover:text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>Ka(t.id),className:"p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition-colors",children:e.jsx(qt,{size:16})})]})]},t.id)),At.length===0&&e.jsx("li",{className:"text-center py-8 text-gray-400 italic",children:"Nenhuma categoria cadastrada."})]})]})]}),u==="taxas"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ss,{size:18})," Taxas por Bandeira"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre a taxa (%) por bandeira de cartão de crédito."})]})}),e.jsxs("form",{onSubmit:Ya,className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bandeira"}),e.jsx("input",{required:!0,value:R.bandeira,onChange:t=>me({...R,bandeira:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: Visa, Master, Elo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Taxa (%)"}),e.jsx("input",{required:!0,type:"number",step:"0.01",value:R.taxa_percent,onChange:t=>me({...R,taxa_percent:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas (mín)"}),e.jsx("input",{required:!0,type:"number",min:"1",value:R.min_installments,onChange:t=>me({...R,min_installments:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas (máx)"}),e.jsx("input",{required:!0,type:"number",min:"1",value:R.max_installments,onChange:t=>me({...R,max_installments:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"submit",disabled:Bt,className:"w-full px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[Bt?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),Me?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[Vt.map(t=>e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.bandeira}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.metodo," • ",t.min_installments,"x até ",t.max_installments,"x"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-brand-600 font-bold",children:[t.taxa_percent,"%"]}),e.jsx("button",{onClick:()=>{mt(t.id),me({bandeira:t.bandeira,taxa_percent:String(t.taxa_percent),metodo:t.metodo,min_installments:String(t.min_installments||1),max_installments:String(t.max_installments||1)})},className:"text-gray-400 hover:text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>es(t.id),className:"text-gray-400 hover:text-red-600",children:e.jsx(qt,{size:16})})]})]},t.id)),Vt.length===0&&e.jsx("div",{className:"text-sm text-gray-400",children:"Nenhuma taxa cadastrada."})]})]}),u==="clientes"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Rt,{size:18})," Clientes"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Registre clientes. CPF e CEP são opcionais."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`Nome,CPF,CEP
Fulano da Silva,12345678909,01000-000
Maria Souza,98765432100,20000-000`)}`,download:"modelo_clientes.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>ns(ne),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Baixar CSV"]}),e.jsxs("button",{type:"button",onClick:()=>os(ne),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Baixar PDF"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Qt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(lt,{size:14})," ",Qt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Wa(t.target.files[0]),t.target.value="")}})]})]})]}),Ve&&e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 bg-gray-50 text-sm",children:[e.jsx("p",{className:"font-semibold text-gray-800 mb-1",children:"Relatório de importação"}),e.jsxs("p",{className:"text-gray-700",children:["Importados: ",Ve.imported]}),Ve.rejected.length>0&&e.jsxs("div",{className:"mt-2 text-gray-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Registros recusados:"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1",children:Ve.rejected.map((t,a)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:t.name||"(sem nome)"})," — CPF: ",t.cpf||"(vazio)"," — CEP: ",t.cep||"-"," — ",t.reason]},a))})]})]}),e.jsxs("form",{onSubmit:ts,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{required:!0,value:X.name,onChange:t=>ve({...X,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome completo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{value:X.cpf,onChange:t=>ve({...X,cpf:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Somente números"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsx("input",{value:X.cep,onChange:t=>ve({...X,cep:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"00000-000"})]}),e.jsx("div",{className:"md:col-span-4 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:Te,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Te?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar Cliente"]})})]}),De&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg",children:De}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("input",{value:Be,onChange:t=>qa(t.target.value),placeholder:"Buscar cliente por nome...",className:"w-full md:max-w-xs px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:ne.length>0&&ne.every(t=>ge.includes(t.id)),onChange:t=>{t.target.checked?fe(ne.map(a=>a.id)):fe([])}}),"Selecionar todos"]}),e.jsx("button",{type:"button",disabled:!ge.length,onClick:rs,className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100 disabled:opacity-50",children:"Excluir selecionados"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[ne.length," clientes"]})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[hs.map(t=>{const a=ge.includes(t.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:s=>{s.target.checked?fe(n=>[...n,t.id]):fe(n=>n.filter(c=>c!==t.id))}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["CPF: ",t.cpf||"-"," • CEP: ",t.cep||"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{D(null),we(t.id),Ce({name:t.name||"",cpf:t.cpf||"",cep:t.cep||""}),He(!0)},className:"text-gray-400 hover:text-brand-600 text-sm",children:"Editar"}),e.jsx("button",{onClick:()=>ss(t.id),className:"text-gray-400 hover:text-red-600",children:e.jsx(qt,{size:16})})]})]},t.id)}),ne.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum cliente cadastrado."})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("button",{type:"button",disabled:Fe<=1,onClick:()=>Ge(t=>Math.max(1,t-1)),className:"px-3 py-2 border border-gray-200 rounded-lg disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{children:["Página ",Fe," de ",ue]}),e.jsx("button",{type:"button",disabled:Fe>=ue,onClick:()=>Ge(t=>Math.min(ue,t+1)),className:"px-3 py-2 border border-gray-200 rounded-lg disabled:opacity-50",children:"Próxima"})]}),Kt&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:Va.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-lg space-y-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar cliente"}),e.jsx("button",{onClick:ha,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:as,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{required:!0,value:Z.name,onChange:t=>Ce({...Z,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{value:Z.cpf,onChange:t=>Ce({...Z,cpf:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsx("input",{value:Z.cep,onChange:t=>Ce({...Z,cep:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),De&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg",children:De}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{He(!1),we(null),D(null)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Te,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Te?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar alterações"]})]})]})]})})]}),u==="procedimentos"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ns,{size:16})," Procedimentos realizados"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre procedimentos individualmente ou importe via CSV."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`#,Categoria,Procedimento,Custo insumo,Tempo (min),Valor cobrado
1,Consulta,Consulta Geral,50,30,200`)}`,download:"modelo_procedimentos.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Modelo CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Yt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(lt,{size:14})," ",Yt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{if(!t.target.files?.length)return;if(!l){alert("Nenhuma clínica ativa para importar procedimentos.");return}const a=t.target.files[0];ea(!0);try{const n=(await ot(a)).split(/\r?\n/).filter(y=>y.trim().length>0);if(!n.length)throw new Error("Arquivo vazio");const c=n[0],g=(c.match(/,/g)||[]).length,x=(c.match(/;/g)||[]).length>g?";":",",h=y=>{const _=[];let f="",o=!1;for(let i=0;i<y.length;i++){const m=y[i];if(m==='"'){o=!o;continue}m===x&&!o?(_.push(f),f=""):f+=m}return _.push(f),_.map(i=>i.trim())},v=h(c).map(y=>y.toLowerCase()),z=v.some(y=>y.includes("procedimento")||y.includes("categoria")),O=z?n.slice(1):n,V=y=>{const _=v.findIndex(f=>y.some(o=>f.includes(o)));return _>=0?_:-1},xe=z?V(["categoria"]):-1,pe=z?V(["procedimento"]):-1,Q=z?V(["custo"]):-1,q=z?V(["tempo"]):-1,L=z?V(["valor"]):-1,E=O.map(y=>{const _=h(y),f=!z&&_.length>=6?1:0,o=k=>{if(k==null||k==="")return null;const B=k.replace(/\./g,"").replace(",","."),M=Number(B);return Number.isFinite(M)?M:null},i=(k,B)=>{const M=k>=0?k:B;return _[M]??""},m=i(xe,f+0),p=i(pe,f+1),w=i(Q,f+2),$=i(q,f+3),F=i(L,f+4);return{categoria:m||null,procedimento:p||"",custo_insumo:o(w),tempo_minutos:o($),valor_cobrado:o(F),clinic_id:l}}).filter(y=>y.procedimento);if(E.length){const{error:y}=await d.from("procedures").insert(E);if(y)throw y;Ae()}else alert("Nenhuma linha válida encontrada no CSV.")}catch(s){alert("Erro ao importar CSV: "+s.message)}finally{ea(!1),t.target.value=""}}})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("input",{type:"text",value:aa,onChange:t=>Ma(t.target.value),placeholder:"Buscar procedimento...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500 flex-1 min-w-[220px]"}),e.jsx("button",{onClick:async()=>{if(!he.length||!confirm("Apagar procedimentos selecionados?"))return;const{error:t}=await d.from("procedures").delete().in("id",he);t||(ke([]),Ae())},className:"px-4 py-2 bg-red-50 text-red-700 rounded-lg border border-red-200 text-sm mr-2 disabled:opacity-50",disabled:!he.length,children:"Apagar selecionados"}),e.jsxs("button",{onClick:()=>{_e(null),le({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),Se(!0)},className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[e.jsx(te,{size:16})," Novo procedimento"]})]}),e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:he.length>0&&he.length===Qe.length,onChange:t=>{t.target.checked?ke(Qe.map(a=>a.id)):ke([])}})}),e.jsx("th",{className:"px-4 py-2 text-left",children:"#"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Procedimento"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Custo insumo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Tempo (min)"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Valor cobrado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Qe.filter(t=>t.procedimento?.toLowerCase().includes(aa.toLowerCase())).map((t,a)=>{const s=he.includes(t.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:e.jsx("input",{type:"checkbox",checked:s,onChange:n=>{n.target.checked?ke(c=>[...c,t.id]):ke(c=>c.filter(g=>g!==t.id))}})}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:a+1}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.categoria||"-"}),e.jsx("td",{className:"px-4 py-2 font-semibold text-gray-800",children:t.procedimento}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.custo_insumo??"-"}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.tempo_minutos??"-"}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.valor_cobrado??"-"}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[e.jsx("button",{onClick:()=>{_e(t.id),le({categoria:t.categoria||"",procedimento:t.procedimento||"",valor_cobrado:t.valor_cobrado||"",custo_insumo:t.custo_insumo||"",tempo_minutos:t.tempo_minutos||""}),Se(!0)},className:"text-brand-600 text-sm mr-3",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir procedimento?"))return;const{error:n}=await d.from("procedures").delete().eq("id",t.id);n||Ae()},className:"text-red-600 text-sm",children:"Apagar"})]})]},t.id)}),Qe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-sm text-gray-400",children:"Nenhum procedimento cadastrado."})})]})]})}),ta&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:Ba.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:We?"Editar procedimento":"Novo procedimento"}),e.jsx("button",{onClick:ba,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!A.procedimento.trim()){if(!l){alert("Nenhuma clínica ativa para salvar procedimento.");return}Zt(!0);try{const a={categoria:A.categoria||null,procedimento:A.procedimento,valor_cobrado:A.valor_cobrado?Number(A.valor_cobrado):null,custo_insumo:A.custo_insumo?Number(A.custo_insumo):null,tempo_minutos:A.tempo_minutos?Number(A.tempo_minutos):null,clinic_id:l};if(We){const{error:s}=await d.from("procedures").update(a).eq("id",We);if(s)throw s}else{const{error:s}=await d.from("procedures").insert([a]);if(s)throw s}le({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),_e(null),Se(!1),Ae()}catch(a){alert("Erro ao salvar procedimento: "+a.message)}finally{Zt(!1)}}},className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsx("input",{value:A.categoria,onChange:t=>le({...A,categoria:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: Consulta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedimento"}),e.jsx("input",{required:!0,value:A.procedimento,onChange:t=>le({...A,procedimento:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do procedimento"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor cobrado"}),e.jsx("input",{type:"number",value:A.valor_cobrado,onChange:t=>le({...A,valor_cobrado:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custo insumo"}),e.jsx("input",{type:"number",value:A.custo_insumo,onChange:t=>le({...A,custo_insumo:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tempo (min)"}),e.jsx("input",{type:"number",value:A.tempo_minutos,onChange:t=>le({...A,tempo_minutos:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Se(!1),_e(null)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Xt,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Xt?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),We?"Atualizar":"Salvar"]})]})]})]})})]}),u==="profissionais"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Rt,{size:16})," Profissionais"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre profissionais para venda e execução."})]})}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!ae.nome.trim()){ia(!0);try{if(pt){const{error:a}=await d.from("professionals").update({nome:ae.nome,tipo:ae.tipo,clinic_id:l}).eq("id",pt);if(a)throw a}else{const{error:a}=await d.from("professionals").insert([{nome:ae.nome,tipo:ae.tipo,clinic_id:l}]);if(a)throw a}Je({nome:"",tipo:"venda"}),ra(null),Ut()}catch(a){alert("Erro ao salvar profissional: "+a.message)}finally{ia(!1)}}},className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:ae.nome,onChange:t=>Je({...ae,nome:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do profissional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:ae.tipo,onChange:t=>Je({...ae,tipo:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"venda",children:"Venda"}),e.jsx("option",{value:"execucao",children:"Execução"})]})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:na,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[na?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),pt?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[sa.map(t=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tipo: ",t.tipo]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{ra(t.id),Je({nome:t.nome||"",tipo:t.tipo||"venda"})},className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir profissional?"))return;const{error:a}=await d.from("professionals").delete().eq("id",t.id);a||Ut()},className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),sa.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum profissional cadastrado."})]})]}),u==="fornecedores"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Rt,{size:16})," Fornecedores"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre fornecedores para usar no lançamento de despesas."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`nome,documento,telefone
Fornecedor Ltda,12345678000199,11999999999`)}`,download:"modelo_fornecedores.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>ls(gt),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(de,{size:14})," Baixar CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${da?"opacity-60 pointer-events-none":""}`,children:[e.jsx(lt,{size:14})," ",da?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Za(t.target.files[0]),t.target.value="")}})]})]})]}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!T.nome.trim()){ca(!0);try{if(ft){const{error:a}=await d.from("suppliers").update({nome:T.nome,cnpj:T.cnpj,telefone:T.telefone,clinic_id:l}).eq("id",ft);if(a)throw a}else{const{error:a}=await d.from("suppliers").insert([{nome:T.nome,cnpj:T.cnpj,telefone:T.telefone,clinic_id:l}]);if(a)throw a}Ee({nome:"",cnpj:"",telefone:""}),la(null),nt()}catch(a){alert("Erro ao salvar fornecedor: "+a.message)}finally{ca(!1)}}},className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da empresa"}),e.jsx("input",{value:T.nome,onChange:t=>Ee({...T,nome:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Fornecedor Ltda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ"}),e.jsx("input",{value:T.cnpj,onChange:t=>Ee({...T,cnpj:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Somente números"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:T.telefone,onChange:t=>Ee({...T,telefone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"(00) 00000-0000"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:oa,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[oa?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),ft?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[gt.map(t=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["CNPJ: ",t.cnpj||"-"," • Tel: ",t.telefone||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{la(t.id),Ee({nome:t.nome||"",cnpj:t.cnpj||"",telefone:t.telefone||""})},className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir fornecedor?"))return;const{error:a}=await d.from("suppliers").delete().eq("id",t.id);a||nt()},className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),gt.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum fornecedor cadastrado."})]})]}),u==="usuarios"&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ws,{size:16})," Usuários"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crie usuários e defina quais páginas cada um pode acessar."})]})}),l?e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:gs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:I.name,onChange:t=>se({...I,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:I.email,onChange:t=>se({...I,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@clinica.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem do usuário"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-[10px] text-gray-400",children:Ft?e.jsx("img",{src:Ft,alt:"Avatar do usuário",className:"h-full w-full object-cover"}):e.jsx("span",{children:"Sem imagem"})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[Ft?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async t=>{const a=t.target.files?.[0];a&&await us(a),t.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),Ze&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:Ze})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),e.jsxs("select",{value:I.role,onChange:t=>se({...I,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"user-active",type:"checkbox",checked:I.ativo,onChange:t=>se({...I,ativo:t.target.checked}),className:"h-4 w-4 text-brand-600"}),e.jsx("label",{htmlFor:"user-active",className:"text-sm text-gray-700",children:"Usuário ativo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Páginas liberadas"}),H.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>se(t=>({...t,paginas_liberadas:H.map(a=>a.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>se(t=>({...t,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]})]}),H.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Defina as páginas liberadas para a clínica antes de liberar acessos."}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:St,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:H.map(t=>e.jsx("button",{type:"button",onClick:()=>{I.paginas_liberadas.includes(t.value)||(se(a=>({...a,paginas_liberadas:[...a.paginas_liberadas,t.value]})),St.current&&St.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:t.label},t.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.paginas_liberadas.map(t=>e.jsxs("button",{type:"button",onClick:()=>se(a=>({...a,paginas_liberadas:a.paginas_liberadas.filter(s=>s!==t)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[Le[t]||t," ✕"]},t))})]})]}),pa&&e.jsx("p",{className:"text-sm text-red-600",children:pa}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:Ke,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Ke?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Adicionar usuário"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("input",{value:yt,onChange:t=>Oa(t.target.value),placeholder:"Buscar usuário...",className:"w-full md:max-w-xs px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[It.length," usuários"]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[jt&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Carregando usuários..."}),!jt&&It.map(t=>e.jsxs("div",{className:"p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 shrink-0 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:`Foto de ${t.name||"usuário"}`,className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:Aa(t.name||"",t.email||"")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Perfil: ",t.role||"user"," • ",t.ativo===!1?"Inativo":"Ativo"]}),t.paginas_liberadas&&t.paginas_liberadas.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Páginas: ",t.paginas_liberadas.map(a=>Le[a]||a).join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ds(t),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{type:"button",onClick:()=>ms(t),className:`text-sm ${t.ativo===!1?"text-emerald-600":"text-red-600"}`,children:t.ativo===!1?"Ativar":"Desativar"}),e.jsx("button",{type:"button",onClick:()=>ps(t),className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),!jt&&It.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum usuário cadastrado."})]})]}),fa&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:Ga.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-auto space-y-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar usuário"}),e.jsx("button",{type:"button",onClick:ya,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:fs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:P.name,onChange:t=>Y({...P,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:P.email,onChange:t=>Y({...P,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@clinica.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem do usuário"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:zt?e.jsx("img",{src:zt,alt:"Avatar do usuário",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:Aa(P.name||"",P.email||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[zt?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async t=>{const a=t.target.files?.[0];a&&await xs(a),t.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),at&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:at})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),e.jsxs("select",{value:P.role,onChange:t=>Y({...P,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"edit-user-active",type:"checkbox",checked:P.ativo,onChange:t=>Y({...P,ativo:t.target.checked}),className:"h-4 w-4 text-brand-600"}),e.jsx("label",{htmlFor:"edit-user-active",className:"text-sm text-gray-700",children:"Usuário ativo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Páginas liberadas"}),H.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Y(t=>({...t,paginas_liberadas:H.map(a=>a.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>Y(t=>({...t,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]})]}),H.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Defina as páginas liberadas para a clínica antes de liberar acessos."}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:kt,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:H.map(t=>e.jsx("button",{type:"button",onClick:()=>{P.paginas_liberadas.includes(t.value)||(Y(a=>({...a,paginas_liberadas:[...a.paginas_liberadas,t.value]})),kt.current&&kt.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:t.label},t.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.paginas_liberadas.map(t=>e.jsxs("button",{type:"button",onClick:()=>Y(a=>({...a,paginas_liberadas:a.paginas_liberadas.filter(s=>s!==t)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[Le[t]||t," ✕"]},t))})]})]}),ja&&e.jsx("p",{className:"text-sm text-red-600",children:ja}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Pe(!1),it()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Ke,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Ke?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar alterações"]})]})]})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Selecione uma clínica para gerenciar usuários."})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Acesso restrito ao super admin da clínica."})})]})};export{Ts as default};
