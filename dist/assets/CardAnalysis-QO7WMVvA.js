import{u as ve,r as x,s as P,j as e,C as ee,g as je,h as Ne,A as _e}from"./index-HcuLVkXM.js";import{f,b as y,a as ke}from"./utils-C6qNh0Lg.js";import{u as De}from"./useModalControls-BiWM_r1l.js";import{R as we}from"./refresh-cw-CbS8BK1e.js";import{F as te}from"./filter-CRrigRAv.js";import{R as ae,n as se,X as re,Y as ne,T as oe,q as ie,B as qe}from"./generateCategoricalChart-B03fitBM.js";import{A as Ce,a as ce}from"./AreaChart-CrBvek2G.js";import{D as M}from"./download-CcofxccE.js";import{A as le}from"./arrow-up-down-BIh5lzKs.js";import{T as $e}from"./trash-2-FGsD9cgR.js";import{B as Pe}from"./BarChart-CmfSdQYO.js";const Se=(s,i)=>{if(!s)return"";const r=new Date(s);return isNaN(r.getTime())?s:(r.setDate(r.getDate()+i),r.toISOString().split("T")[0])},Fe=(s,i)=>{if(!s)return"";const r=new Date(s);if(isNaN(r.getTime()))return s;let l=0;for(;l<i;){r.setDate(r.getDate()+1);const d=r.getDay();d!==0&&d!==6&&(l+=1)}return r.toISOString().split("T")[0]},V=s=>{const i=new Date,r=i.toISOString().split("T")[0],l=new Date(i);switch(s){case"dia":break;case"semana":l.setDate(i.getDate()-7);break;case"quinzenal":l.setDate(i.getDate()-15);break;case"mes":l.setMonth(i.getMonth()-1);break;case"ano":l.setFullYear(i.getFullYear()-1);break}return{start:l.toISOString().split("T")[0],end:r}},Te=s=>{if(!s)return[];try{const i=Array.isArray(s)?s:typeof s=="string"?JSON.parse(s):[];return Array.isArray(i)?i.map(r=>typeof r=="string"?{vencimento:r}:!r||typeof r!="object"?null:{vencimento:r.vencimento||r.due_date||r.data||r.date||""}).filter(Boolean):[]}catch{return[]}},ue=s=>Te(s.recebimento_parcelas).map(i=>i.vencimento).filter(Boolean),K=(s,i=1)=>{const r=s?.data_competencia;if(!r)return"";const l=ue(s);if(l.length)return l[i-1]||l[0];const d=(s.forma_pagamento||"").toLowerCase(),N=s.data_recebimento||r;if(d.includes("boleto")||d.includes("cheque"))return N;if(d.includes("débito")||d.includes("debito"))return s.data_recebimento?N:Fe(N,1);if(d.includes("crédito")||d.includes("credito")||d.includes("convenio")||d.includes("convênio")){const m=s.data_recebimento?30*(i-1):30*i;return Se(N,m)}return N},xe=s=>{const i=new Date(s);return isNaN(i.getTime())?null:i},de=(s,i)=>{const r=xe(s);if(!r)return Number.POSITIVE_INFINITY;const l=new Date(r);switch(l.setHours(0,0,0,0),i){case"semana":{const d=(l.getDay()+6)%7;l.setDate(l.getDate()-d);break}case"quinzenal":l.setDate(l.getDate()<=15?1:16);break;case"mes":l.setDate(1);break;case"ano":l.setMonth(0,1);break}return l.getTime()},me=(s,i)=>{const r=xe(s);if(!r)return s;const l=r.getFullYear(),d=`${r.getMonth()+1}`.padStart(2,"0"),N=`${r.getDate()}`.padStart(2,"0"),m=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],q=m[r.getMonth()]?`${m[r.getMonth()]}/${l}`:`${d}/${l}`;switch(i){case"dia":return`${l}-${d}-${N}`;case"semana":{const b=new Date(r.getTime()),S=(r.getDay()+6)%7;b.setDate(r.getDate()-S+3);const _=new Date(b.getFullYear(),0,4);return`Semana ${1+Math.round(((b.getTime()-_.getTime())/864e5-3)/7)}/${l}`}case"quinzenal":return`${q} - ${r.getDate()<=15?"1ª quinzena":"2ª quinzena"}`;case"mes":return q;case"ano":return`${l}`;default:return s}},A=s=>s?s.includes("Semana")||s.includes("quinzena")?s:/^\d{4}-\d{2}-\d{2}$/.test(s)?y(s):/^\d{4}-\d{2}$/.test(s)?ke(s):s:"",ze=s=>{if(!s)return null;const i=s.match(/NSU\s*:?\s*([^|]+)/i);return i&&i[1].trim()||null},Le=s=>Number.isFinite(s)?new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s)+"%":"0,00%",I=s=>Number.isFinite(s)?new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s):"0,00",Je=()=>{const{effectiveClinicId:s}=ve(),i=s||null,[r,l]=x.useState([]),[d,N]=x.useState("mes"),[m,q]=x.useState(V("mes").start),[b,S]=x.useState(V("mes").end),[_,E]=x.useState("vendas"),[O,pe]=x.useState({column:"data_competencia",direction:"asc"}),[U,be]=x.useState({column:"data_recebimento",direction:"asc"}),[Y,J]=x.useState(null),[k,F]=x.useState(null),[B,G]=x.useState(!1),he=De({isOpen:!!k,onClose:()=>F(null)}),v=x.useMemo(()=>new Date().toISOString().split("T")[0],[]),j=x.useCallback(async()=>{try{if(J(null),!i){l([]);return}let t="id, data_competencia, data_recebimento, recebimento_parcelas, valor_bruto, valor_liquido, valor, forma_pagamento, paciente, parcelas, bandeira, nsu, observacoes",a=P.from("revenues").select(t);i&&(a=a.eq("clinic_id",i)),_==="vendas"&&m&&(a=a.gte("data_competencia",m)),b&&(a=a.lte("data_competencia",b));let{data:o,error:n}=await a;if(n){const u=`${n.message}`.toLowerCase();(u.includes("nsu")||u.includes("recebimento_parcelas"))&&(t="id, data_competencia, data_recebimento, valor_bruto, valor_liquido, valor, forma_pagamento, paciente, parcelas, bandeira, observacoes",a=P.from("revenues").select(t),i&&(a=a.eq("clinic_id",i)),_==="vendas"&&m&&(a=a.gte("data_competencia",m)),b&&(a=a.lte("data_competencia",b)),{data:o,error:n}=await a)}if(n)throw n;const c=(o||[]).map(u=>({...u,nsu:u.nsu||ze(u.observacoes)}));l(c)}catch(t){console.error(t),J(t?.message||"Erro ao carregar dados"),l([])}},[m,b,_,i]);x.useEffect(()=>{const{start:t,end:a}=V(d);q(t),S(a)},[d]),x.useEffect(()=>{j()},[j]),x.useEffect(()=>{const t=i?`clinic_id=eq.${i}`:void 0,a=P.channel(`card-analysis-updates-${i??"all"}`);return a.on("postgres_changes",{event:"*",schema:"public",table:"revenues",...t?{filter:t}:{}},()=>j()),a.subscribe(),()=>{P.removeChannel(a)}},[i,j]),x.useEffect(()=>{const t=()=>j();return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[j]),x.useEffect(()=>{const t=window.setInterval(()=>j(),3e4);return()=>window.clearInterval(t)},[j]);const ge=async()=>{if(k){G(!0);try{const{error:t}=await P.from("revenues").delete().eq("id",k.id);if(t)throw t;F(null),j()}catch(t){alert("Erro ao excluir venda: "+(t?.message||"Erro desconhecido"))}finally{G(!1)}}},X=t=>{const a=[];return t.forEach(o=>{if(!o.data_competencia)return;const n=ue(o),c=Math.max(1,n.length||Number(o.parcelas||1)),u=Number(o.valor_bruto??o.valor??o.valor_liquido??0),h=Number(o.valor_liquido??o.valor??o.valor_bruto??0);for(let g=1;g<=c;g++){const D=u/c,p=h/c,R=o.data_competencia,$=n[g-1]||K(o,g)||R;a.push({...o,parcelaNumero:g,parcelaTotal:c,valorParcela:D,valorParcelaLiquido:p,data_recebimento:$,data_venda:R})}}),a},H=(t,a)=>{const o=a.direction==="asc"?1:-1;return[...t].sort((n,c)=>{const u=n[a.column]??"",h=c[a.column]??"";return u<h?-1*o:u>h?1*o:0})},C=x.useMemo(()=>r.filter(t=>t.data_competencia>=m&&t.data_competencia<=b),[r,m,b]),w=x.useMemo(()=>X(r),[r]),fe=x.useMemo(()=>{const t=new Map;return C.forEach(a=>{const o=me(a.data_competencia,d),n=de(a.data_competencia,d),c=t.get(o)||{bucket:o,bruto:0,liquido:0,sortKey:n};c.bruto+=Number(a.valor_bruto??a.valor??0),c.liquido+=Number(a.valor_liquido??a.valor??0),c.sortKey=Math.min(c.sortKey,n),t.set(o,c)}),Array.from(t.values()).sort((a,o)=>a.sortKey-o.sortKey)},[C,d]),ye=x.useMemo(()=>{const t=new Map,a=m>v?m:v;return w.filter(n=>n.data_recebimento&&n.data_recebimento>=a&&n.data_recebimento<=b).forEach(n=>{const c=n.data_recebimento,u=me(c,d),h=de(c,d),g=t.get(u)||{bucket:u,liquido:0,sortKey:h};g.liquido+=Number(n.valorParcelaLiquido||n.valor_liquido||0),g.sortKey=Math.min(g.sortKey,h),t.set(u,g)}),Array.from(t.values()).sort((n,c)=>n.sortKey-c.sortKey)},[w,m,b,v,d]),T=x.useMemo(()=>{const t=r.filter(a=>a.data_competencia>=m&&a.data_competencia<=b);return H(X(t),O)},[r,m,b,O]),z=x.useMemo(()=>{const t=m>v?m:v,a=w.filter(o=>o.data_recebimento&&o.data_recebimento>=t&&o.data_recebimento<=b);return H(a,U)},[w,m,b,U,v]),Q=(t,a)=>{a==="vendas"?pe(o=>({column:t,direction:o.column===t&&o.direction==="asc"?"desc":"asc"})):be(o=>({column:t,direction:o.column===t&&o.direction==="asc"?"desc":"asc"}))},W=(t,a)=>{const o=["Paciente","Data venda","Data recebimento","Parcela","Valor venda","Valor parcela","Parcela líquido","Forma pgto","NSU","Bandeira"],n=p=>{if(p==null)return"";const $=String(p).replace(/"/g,'""');return/[;\n\r"]/.test($)?`"${$}"`:$},u="\uFEFF"+[o.map(n).join(";"),...t.map(p=>[n(p.paciente||"-"),n(y(p.data_venda||p.data_competencia)),n(y(p.data_recebimento||K(p))),n(`${p.parcelaNumero||1}/${p.parcelaTotal||1}`),n(I(Number(p.valor_bruto||p.valor||p.valor_liquido||0))),n(I(Number(p.valorParcela||0))),n(I(Number(p.valorParcelaLiquido||0))),n(p.forma_pagamento||"-"),n(p.nsu||"-"),n(p.bandeira||"-")].join(";"))].join(`\r
`),h=new Blob([u],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(h),D=document.createElement("a");D.href=g,D.setAttribute("download",`${a}.csv`),document.body.appendChild(D),D.click(),document.body.removeChild(D)},Z=(t,a)=>{const o=t.map(c=>`
      <tr>
        <td>${c.paciente||"-"}</td>
        <td>${y(c.data_venda||c.data_competencia)}</td>
        <td>${y(c.data_recebimento||K(c))}</td>
        <td>${c.parcelaNumero||1}/${c.parcelaTotal||1}</td>
        <td>${f(Number(c.valor_bruto||c.valor||c.valor_liquido||0))}</td>
        <td>${f(Number(c.valorParcela||0))}</td>
        <td>${f(Number(c.valorParcelaLiquido||0))}</td>
        <td>${c.forma_pagamento||"-"}</td>
        <td>${c.nsu||"-"}</td>
        <td>${c.bandeira||"-"}</td>
      </tr>
    `).join(""),n=window.open("","_blank");n&&(n.document.write(`
      <html>
        <head>
          <title>${a}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 16px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ddd; padding: 8px; font-size: 12px; }
            th { background: #f3f4f6; text-align: left; }
          </style>
        </head>
        <body>
          <h2>${a}</h2>
          <table>
            <thead>
              <tr>
                <th>Paciente</th><th>Data venda</th><th>Data receb.</th><th>Parcela</th><th>Valor venda</th><th>Valor parcela</th><th>Parcela líquido</th><th>Forma pgto</th><th>NSU</th><th>Bandeira</th>
              </tr>
            </thead>
            <tbody>${o}</tbody>
          </table>
        </body>
      </html>
    `),n.document.close(),n.print())},L=x.useMemo(()=>{const t=C.reduce((u,h)=>u+Number(h.valor_bruto??h.valor??0),0),a=C.reduce((u,h)=>u+Number(h.valor_liquido??h.valor??0),0),o=m>v?m:v,n=w.reduce((u,h)=>{const g=h.data_recebimento;return g&&g>=o&&g<=b?u+Number(h.valorParcelaLiquido||h.valor_liquido||0):u},0),c=t>0?(1-a/t)*100:0;return{vendidoBruto:t,vendidoLiquido:a,receberPeriodo:n,taxaPercentual:c}},[C,w,m,b,v]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Análise de Cartão"}),e.jsx("p",{className:"text-gray-500",children:"Compare vendas e recebíveis considerando taxas e prazos de cartão."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[["dia","semana","quinzenal","mes","ano"].map(t=>e.jsx("button",{onClick:()=>N(t),className:`px-3 py-2 rounded-lg text-sm border ${d===t?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:t[0].toUpperCase()+t.slice(1)},t)),e.jsxs("button",{onClick:j,className:"px-3 py-2 border border-gray-200 rounded-lg text-gray-700 flex items-center gap-2",title:"Atualiza os dados do período",children:[e.jsx(we,{size:16})," Atualizar"]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(ee,{size:16})}),e.jsx("input",{type:"date",value:m,onChange:t=>q(t.target.value),className:"pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500"})]}),e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(ee,{size:16})}),e.jsx("input",{type:"date",value:b,onChange:t=>S(t.target.value),className:"pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500"})]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Vendido (bruto)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:f(L.vendidoBruto)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Vendido (líquido c/ taxa)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:f(L.vendidoLiquido)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"A receber no período"}),e.jsx("p",{className:"text-lg font-semibold text-emerald-700",children:f(L.receberPeriodo)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Taxa média cobrada"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:Le(L.taxaPercentual)})]})]})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[Y&&e.jsxs("div",{className:"mb-3 p-3 rounded-lg bg-red-50 text-red-700 text-sm",children:["Erro ao carregar dados: ",Y]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm border ${_==="vendas"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,onClick:()=>E("vendas"),children:[e.jsx(je,{size:16})," Vendas"]}),e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm border ${_==="recebiveis"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,onClick:()=>E("recebiveis"),children:[e.jsx(Ne,{size:16})," Recebíveis"]})]}),_==="vendas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-gray-700 font-semibold",children:[e.jsx(te,{size:16})," Vendas por data (bruto x líquido)"]}),e.jsx("div",{className:"h-72",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Ce,{data:fe,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"gradBruto",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#64748b",stopOpacity:.35}),e.jsx("stop",{offset:"95%",stopColor:"#64748b",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"gradLiquido",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#0ea5e9",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#0ea5e9",stopOpacity:0})]})]}),e.jsx(se,{strokeDasharray:"3 3",vertical:!1}),e.jsx(re,{dataKey:"bucket",tickFormatter:A}),e.jsx(ne,{}),e.jsx(oe,{formatter:t=>f(t),labelFormatter:A}),e.jsx(ie,{}),e.jsx(ce,{type:"monotone",dataKey:"bruto",stroke:"#64748b",fill:"url(#gradBruto)",name:"Bruto"}),e.jsx(ce,{type:"monotone",dataKey:"liquido",stroke:"#0ea5e9",fill:"url(#gradLiquido)",name:"Líquido (c/ taxa)"})]})})}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("span",{className:"text-sm text-gray-600 flex items-center gap-2 font-semibold",children:"Detalhe de vendas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>W(T,"onefinc-vendas"),className:"flex items-center gap-1 px-3 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(M,{size:14})," CSV"]}),e.jsxs("button",{onClick:()=>Z(T,"Vendas"),className:"flex items-center gap-1 px-3 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(M,{size:14})," PDF"]})]})]}),e.jsx("div",{className:"mt-2 max-h-[420px] overflow-auto",children:e.jsxs("table",{className:"min-w-[1100px] w-full text-sm border-t border-gray-100 table-fixed whitespace-nowrap",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[[{key:"paciente",label:"Paciente"},{key:"data_venda",label:"Data venda"},{key:"data_recebimento",label:"Data receb."},{key:"parcelaNumero",label:"Parcela"},{key:"valor_bruto",label:"Valor venda"},{key:"valorParcela",label:"Valor parcela"},{key:"valorParcelaLiquido",label:"Parcela líquido"},{key:"forma_pagamento",label:"Forma pgto"},{key:"nsu",label:"NSU"},{key:"bandeira",label:"Bandeira"}].map(t=>e.jsx("th",{className:"py-2 pr-3 font-medium cursor-pointer select-none",onClick:()=>Q(t.key,"vendas"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.label," ",e.jsx(le,{size:12,className:"text-gray-400"})]})},t.key)),e.jsx("th",{className:"py-2 pr-3 font-medium",children:"Ações"})]})}),e.jsxs("tbody",{children:[T.map(t=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-800 truncate max-w-[180px]",title:t.paciente||"-",children:t.paciente||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-32",children:y(t.data_venda||t.data_competencia)}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-32",children:y(t.data_recebimento)}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-28",children:`${t.parcelaNumero||1} de ${t.parcelaTotal||1}`}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 font-semibold w-32",children:f(Number(t.valor_bruto||t.valor||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 w-32",children:f(Number(t.valorParcela||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 w-40",children:f(Number(t.valorParcelaLiquido||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[170px]",title:t.forma_pagamento||"-",children:t.forma_pagamento||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[140px]",title:t.nsu||"-",children:t.nsu||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[140px]",title:t.bandeira||"-",children:t.bandeira||"-"}),e.jsx("td",{className:"py-2 pr-3",children:e.jsx("button",{type:"button",onClick:()=>F({id:t.id,paciente:t.paciente,data:t.data_venda||t.data_competencia}),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Excluir venda",children:e.jsx($e,{size:16})})})]},`${t.id}-${t.parcelaNumero}`)),T.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"py-3 text-center text-gray-400",children:"Nenhum registro no período selecionado."})})]})]})})]}),_==="recebiveis"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-gray-700 font-semibold",children:[e.jsx(te,{size:16})," Recebíveis futuros (líquido)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Mostrando apenas recebíveis a partir de hoje (",y(v),") para facilitar a previsão de entradas futuras."]}),e.jsx("div",{className:"h-72",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:ye,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(re,{dataKey:"bucket",tickFormatter:A}),e.jsx(ne,{}),e.jsx(oe,{formatter:t=>f(t),labelFormatter:A}),e.jsx(ie,{}),e.jsx(qe,{dataKey:"liquido",fill:"#22c55e",name:"Líquido a receber",radius:[6,6,0,0]})]})})}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("span",{className:"text-sm text-gray-600 flex items-center gap-2 font-semibold",children:"Detalhe de recebíveis"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>W(z,"onefinc-recebiveis"),className:"flex items-center gap-1 px-3 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(M,{size:14})," CSV"]}),e.jsxs("button",{onClick:()=>Z(z,"Recebiveis"),className:"flex items-center gap-1 px-3 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(M,{size:14})," PDF"]})]})]}),e.jsx("div",{className:"mt-2 max-h-[420px] overflow-auto",children:e.jsxs("table",{className:"min-w-[1100px] w-full text-sm border-t border-gray-100 table-fixed whitespace-nowrap",children:[e.jsx("thead",{children:e.jsx("tr",{className:"text-left text-gray-500",children:[{key:"paciente",label:"Paciente"},{key:"data_venda",label:"Data venda"},{key:"data_recebimento",label:"Data receb."},{key:"parcelaNumero",label:"Parcela"},{key:"valor_bruto",label:"Valor venda"},{key:"valorParcela",label:"Valor parcela"},{key:"valorParcelaLiquido",label:"Parcela líquido"},{key:"forma_pagamento",label:"Forma pgto"},{key:"nsu",label:"NSU"},{key:"bandeira",label:"Bandeira"}].map(t=>e.jsx("th",{className:"py-2 pr-3 font-medium cursor-pointer select-none",onClick:()=>Q(t.key,"recebiveis"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.label," ",e.jsx(le,{size:12,className:"text-gray-400"})]})},t.key))})}),e.jsxs("tbody",{children:[z.map(t=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-800 truncate max-w-[180px]",title:t.paciente||"-",children:t.paciente||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-32",children:y(t.data_venda||t.data_competencia)}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-32",children:y(t.data_recebimento)}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 w-28",children:`${t.parcelaNumero||1} de ${t.parcelaTotal||1}`}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 font-semibold w-32",children:f(Number(t.valor_bruto||t.valor||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 w-32",children:f(Number(t.valorParcela||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-900 w-40",children:f(Number(t.valorParcelaLiquido||0))}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[170px]",title:t.forma_pagamento||"-",children:t.forma_pagamento||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[140px]",title:t.nsu||"-",children:t.nsu||"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-600 truncate max-w-[140px]",title:t.bandeira||"-",children:t.bandeira||"-"})]},`${t.id}-${t.parcelaNumero}`)),z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"py-3 text-center text-gray-400",children:"Nenhum recebível no período selecionado."})})]})]})})]})]}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",onClick:he.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(_e,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Você está prestes a excluir esta venda e todas as parcelas associadas. Essa ação não pode ser desfeita."})]})]}),e.jsxs("div",{className:"p-5 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Paciente:"})," ",k.paciente||"-"]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Data da venda:"})," ",k.data?y(k.data):"-"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>F(null),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",disabled:B,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ge,disabled:B,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:B?"Excluindo...":"Sim, excluir"})]})]})})]})};export{Je as default};
