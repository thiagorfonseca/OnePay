import{c as C,u as E,r as i,j as e,A as v,C as D,W as B,v as F}from"./index-HcuLVkXM.js";import{l as L,a as P,b as R,c as V,d as z,S as T}from"./service-C61pE4fL.js";import{A as W}from"./AlertsPanel-PKjpcU2n.js";const H=C("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),J=()=>{const{effectiveClinicId:j}=E(),n=j,[y,p]=i.useState(!0),[b,N]=i.useState([]),[o,w]=i.useState([]),[c,S]=i.useState([]),[f,I]=i.useState([]),[l,_]=i.useState([]);i.useEffect(()=>{n&&(p(!0),Promise.all([L(n),P(n),R(n),V(n),z(n,400)]).then(([t,d,m,x,h])=>{N(t),w(d),S(m),I(x),_(h)}).finally(()=>p(!1)))},[n]);const r=i.useMemo(()=>{const t=new Map(c.map(s=>[s.item_id,s])),d=o.filter(s=>{const a=t.get(s.id)?.qty_on_hand??0,g=s.min_stock??s.reorder_point??0;return g>0&&a<g}),m=f.filter(s=>!s.expiry_date||(s.qty_on_hand??0)<=0?!1:new Date(s.expiry_date).getTime()-Date.now()<=1e3*60*60*24*30),x=c.reduce((s,a)=>s+(a.stock_value||0),0),h=l.filter(s=>s.movement_type==="loss").filter(s=>new Date(s.created_at).getMonth()===new Date().getMonth()).reduce((s,a)=>s+Math.abs(Number(a.qty_delta||0)),0),k=l.filter(s=>s.movement_type==="consumption"),u=new Map;k.forEach(s=>{const a=u.get(s.item_id)||0;u.set(s.item_id,a+Math.abs(Number(s.qty_delta||0)))});const A=Array.from(u.entries()).sort((s,a)=>a[1]-s[1]).slice(0,5).map(([s,a])=>({name:o.find(q=>q.id===s)?.name||"Item",qty:a}));return{criticalItems:d,expiringSoon:m,stockValue:x,lossesMonth:h,topConsumed:A}},[o,c,f,l]),M=i.useMemo(()=>{const t=[];return r.criticalItems.length&&t.push("Itens abaixo do mínimo: revisar reposição agora."),r.expiringSoon.length&&t.push("Lotes vencendo em 30 dias: priorizar FEFO e revisar validade."),r.lossesMonth>0&&t.push("Perdas registradas neste mês: revisar causas e abrir ajuste."),t.length||t.push("Estoque saudável. Revisar alertas semanais para evitar rupturas."),t},[r]);return n?e.jsxs("div",{className:"space-y-8",children:[e.jsx(T,{title:"Dashboard de Estoque",subtitle:"KPIs críticos, alertas e ações recomendadas para manter a clínica abastecida."}),y?e.jsx("div",{className:"text-sm text-gray-500",children:"Carregando dados do estoque..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(v,{className:"h-4 w-4"})," Itens críticos"]}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-gray-900",children:r.criticalItems.length})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(D,{className:"h-4 w-4"})," Vencendo em 30 dias"]}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-gray-900",children:r.expiringSoon.length})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(B,{className:"h-4 w-4"})," Valor em estoque"]}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-gray-900",children:r.stockValue.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(F,{className:"h-4 w-4"})," Perdas do mês"]}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-gray-900",children:r.lossesMonth})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx(H,{className:"h-4 w-4"})," Itens mais consumidos"]}),e.jsx("div",{className:"mt-4 space-y-2",children:r.topConsumed.length?r.topConsumed.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:t.name}),e.jsx("span",{className:"text-gray-500",children:t.qty})]},t.name)):e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum consumo registrado."})})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:"Ações recomendadas"}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-gray-600",children:M.map(t=>e.jsxs("li",{children:["• ",t]},t))})]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx(v,{className:"h-4 w-4"})," Alertas ativos"]}),e.jsx("div",{className:"mt-4",children:e.jsx(W,{alerts:b.filter(t=>t.status!=="resolved").slice(0,6)})})]})]})]}):null};export{J as default};
