import{r as p,s as y,i as G,a as H,d as W,j as e,L as B,R as X}from"./index-HcuLVkXM.js";const k=l=>{const[r,d]=p.useState(l),[_,g]=p.useState(!0),[j,u]=p.useState(null);return{data:r,setData:d,loading:_,setLoading:g,error:j,setError:u}},Y=l=>{const r=k(null),d=p.useCallback(async()=>{if(!l){r.setData(null),r.setLoading(!1);return}r.setLoading(!0);const{data:_,error:g}=await y.from("content_items").select("*").eq("id",l).maybeSingle();g&&r.setError(g.message),r.setData(_||null),r.setLoading(!1)},[l]);return p.useEffect(()=>{d()},[d]),{...r,refresh:d}},ee=l=>{const r=k([]),d=p.useCallback(async()=>{if(!l){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:_,error:g}=await y.from("content_modules").select("*").eq("content_id",l).order("order_index",{ascending:!0});g&&r.setError(g.message),r.setData(_||[]),r.setLoading(!1)},[l]);return p.useEffect(()=>{d()},[d]),{...r,refresh:d}},te=l=>{const r=k([]),d=p.useCallback(async()=>{if(!l){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:_,error:g}=await y.from("content_lessons").select("*").eq("module_id",l).order("order_index",{ascending:!0});g&&r.setError(g.message),r.setData(_||[]),r.setLoading(!1)},[l]);return p.useEffect(()=>{d()},[d]),{...r,refresh:d}},V=l=>{const r=k([]),d=p.useCallback(async()=>{if(!l){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:_,error:g}=await y.from("content_lesson_files").select("*").eq("lesson_id",l).order("created_at",{ascending:!1});g&&r.setError(g.message),r.setData(_||[]),r.setLoading(!1)},[l]);return p.useEffect(()=>{d()},[d]),{...r,refresh:d}},re=l=>{const{contentId:r,moduleId:d,lessonId:_,studentUserId:g}=l,j=k([]),u=p.useMemo(()=>JSON.stringify(l),[l]),c=p.useCallback(async()=>{if(!r){j.setData([]),j.setLoading(!1);return}j.setLoading(!0);let h=y.from("content_comments").select("*").eq("content_id",r).order("created_at",{ascending:!1});d&&(h=h.eq("module_id",d)),_&&(h=h.eq("lesson_id",_)),g&&(h=h.eq("student_user_id",g));const{data:f,error:v}=await h;v&&j.setError(v.message),j.setData(f||[]),j.setLoading(!1)},[r,d,_,g]);return p.useEffect(()=>{c()},[c,u]),{...j,refresh:c}},P="content-files",ae=l=>{const{data:r}=y.storage.from(P).getPublicUrl(l);return r.publicUrl},se=l=>{const r=`/storage/v1/object/public/${P}/`,d=l.indexOf(r);return d===-1?null:l.slice(d+r.length)},I=l=>l.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,M=async(l,r)=>{const{error:d}=await y.storage.from(P).upload(l,r,{upsert:!0});if(d)throw d;return ae(l)},ne=({lessonId:l})=>{const{data:r,refresh:d}=V(l),[_,g]=p.useState(!1),j=async c=>{g(!0);try{const h=I(c.name),f=`lesson-files/${l}/${crypto.randomUUID()}-${h}`,v=await M(f,c),{error:N}=await y.from("content_lesson_files").insert({lesson_id:l,file_name:c.name,file_url:v});if(N){alert(`Erro ao salvar arquivo: ${N.message}`);return}d()}catch(h){alert(`Erro ao enviar arquivo: ${h.message}`)}finally{g(!1)}},u=async(c,h)=>{if(confirm("Excluir arquivo?"))try{if(h){const v=se(h);if(v){const{error:N}=await y.storage.from(P).remove([v]);if(N){alert(`Erro ao remover arquivo do storage: ${N.message}`);return}}}const{error:f}=await y.from("content_lesson_files").delete().eq("id",c);if(f){alert(`Erro ao excluir arquivo: ${f.message}`);return}d()}catch(f){alert(`Erro ao excluir arquivo: ${f.message}`)}};return e.jsxs("div",{className:"mt-2 border border-gray-100 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Materiais"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-brand-50 text-brand-700 rounded cursor-pointer",children:[_?"Enviando...":"Adicionar arquivo",e.jsx("input",{type:"file",className:"hidden",onChange:c=>{const h=c.target.files?.[0];h&&j(h),c.currentTarget.value=""}})]})]}),r.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"Nenhum arquivo anexado."}):e.jsx("div",{className:"space-y-2",children:r.map(c=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("a",{href:c.file_url||"#",target:"_blank",rel:"noreferrer",className:"text-brand-600 hover:underline",children:c.file_name||"Arquivo"}),e.jsx("button",{type:"button",onClick:()=>u(c.id,c.file_url),className:"text-xs text-red-600 hover:underline",children:"Excluir"})]},c.id))})]})},le=({lessonId:l})=>{const{data:r}=V(l),d=r.length;return e.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded",children:[d," arquivo",d===1?"":"s"]})},de=({moduleId:l})=>{const{data:r,refresh:d}=te(l),[_,g]=p.useState(null),[j,u]=p.useState({}),[c,h]=p.useState({title:"",description:"",panda_video_id:"",panda_video_url:"",order_index:1,published:!1});p.useEffect(()=>{const s={};r.forEach(n=>{s[n.id]={title:n.title||"",description:n.description||"",panda_video_id:n.panda_video_id||"",panda_video_url:n.panda_video_url||"",order_index:n.order_index??0,published:!!n.published}}),u(s)},[r]);const f=async s=>{const n=j[s];if(!n)return;if(n.published&&!n.panda_video_id){alert("Informe o Panda Video ID para publicar a aula.");return}const{error:a}=await y.from("content_lessons").update({title:n.title.trim(),description:n.description||null,panda_video_id:n.panda_video_id||null,panda_video_url:n.panda_video_url||null,order_index:n.order_index,published:n.published}).eq("id",s);if(a){alert(`Erro ao salvar aula: ${a.message}`);return}d()},v=async s=>{if(!confirm("Excluir aula?"))return;const{error:n}=await y.from("content_lessons").delete().eq("id",s);if(n){alert(`Erro ao excluir aula: ${n.message}`);return}d()},N=async()=>{if(!c.title.trim())return;if(c.published&&!c.panda_video_id){alert("Informe o Panda Video ID para publicar a aula.");return}const{error:s}=await y.from("content_lessons").insert({module_id:l,title:c.title.trim(),description:c.description||null,panda_video_id:c.panda_video_id||null,panda_video_url:c.panda_video_url||null,order_index:c.order_index,published:c.published});if(s){alert(`Erro ao criar aula: ${s.message}`);return}h({title:"",description:"",panda_video_id:"",panda_video_url:"",order_index:c.order_index+1,published:!1}),d()},E=async(s,n)=>{const a=r.findIndex(U=>U.id===s);if(a===-1)return;const m=n==="up"?a-1:a+1;if(m<0||m>=r.length)return;const D=r[a],L=r[m],{error:S}=await y.from("content_lessons").update({order_index:L.order_index}).eq("id",D.id);if(S){alert(`Erro ao reordenar aulas: ${S.message}`);return}const{error:$}=await y.from("content_lessons").update({order_index:D.order_index}).eq("id",L.id);if($){alert(`Erro ao reordenar aulas: ${$.message}`);return}d()};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"overflow-x-auto border border-gray-100 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Ordem"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Aula"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Descrição"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Panda ID"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Arquivos"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[r.map(s=>{const n=j[s.id];return e.jsxs(X.Fragment,{children:[e.jsxs("tr",{className:"align-top",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:n?.order_index??0,onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],order_index:Number(a.target.value)}})),onClick:a=>a.stopPropagation(),className:"w-16 px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{type:"button",onClick:()=>E(s.id,"up"),className:"text-xs text-gray-500 hover:text-gray-700",children:"↑"}),e.jsx("button",{type:"button",onClick:()=>E(s.id,"down"),className:"text-xs text-gray-500 hover:text-gray-700",children:"↓"})]})]})}),e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("input",{value:n?.title||"",onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],title:a.target.value}})),onClick:a=>a.stopPropagation(),className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-500 mt-2",children:[e.jsx("input",{type:"checkbox",checked:!!n?.published,onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],published:a.target.checked}})),onClick:a=>a.stopPropagation()}),"Publicado"]})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("textarea",{value:n?.description||"",onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],description:a.target.value}})),onClick:a=>a.stopPropagation(),rows:2,className:"w-full px-2 py-1 border border-gray-300 rounded"})}),e.jsxs("td",{className:"px-3 py-2 space-y-2",children:[e.jsx("input",{value:n?.panda_video_id||"",onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],panda_video_id:a.target.value}})),onClick:a=>a.stopPropagation(),placeholder:"ID do Panda",className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:n?.panda_video_url||"",onChange:a=>u(m=>({...m,[s.id]:{...m[s.id],panda_video_url:a.target.value}})),onClick:a=>a.stopPropagation(),placeholder:"URL/Embed",className:"w-full px-2 py-1 border border-gray-300 rounded"})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("button",{type:"button",onClick:()=>g(_===s.id?null:s.id),className:"flex items-center gap-2 text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",children:[e.jsx("span",{children:"Arquivos"}),e.jsx(le,{lessonId:s.id})]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>f(s.id),onMouseDown:a=>a.stopPropagation(),className:"text-xs px-2 py-1 bg-gray-900 text-white rounded",children:"Salvar"}),e.jsx("button",{type:"button",onClick:()=>v(s.id),onMouseDown:a=>a.stopPropagation(),className:"text-xs text-red-600 hover:underline",children:"Excluir"})]})})]}),_===s.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 pb-4",children:e.jsx(ne,{lessonId:s.id})})})]},s.id)}),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-4 text-sm text-gray-500",children:"Nenhuma aula cadastrada."})})]})]})}),e.jsxs("div",{className:"border border-dashed border-gray-200 rounded-lg p-3 space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Nova aula"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{value:c.title,onChange:s=>h(n=>({...n,title:s.target.value})),placeholder:"Título",className:"px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:c.panda_video_id,onChange:s=>h(n=>({...n,panda_video_id:s.target.value})),placeholder:"Panda Video ID",className:"px-2 py-1 border border-gray-300 rounded"})]}),e.jsx("textarea",{value:c.description,onChange:s=>h(n=>({...n,description:s.target.value})),placeholder:"Descrição",rows:2,className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:c.panda_video_url,onChange:s=>h(n=>({...n,panda_video_url:s.target.value})),placeholder:"URL/Embed (opcional)",className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center text-sm text-gray-600",children:[e.jsxs("label",{className:"flex items-center gap-2",children:["Ordem",e.jsx("input",{type:"number",value:c.order_index,onChange:s=>h(n=>({...n,order_index:Number(s.target.value)})),className:"w-20 px-2 py-1 border border-gray-300 rounded"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.published,onChange:s=>h(n=>({...n,published:s.target.checked}))}),"Publicado"]}),e.jsx("button",{type:"button",onClick:N,className:"px-3 py-2 bg-brand-600 text-white rounded-lg text-sm",children:"Adicionar aula"})]})]})]})},ie=()=>{const{id:l}=G(),[r,d]=H(),_=W(),g=r.get("tab")||"about",j=r.get("type"),{data:u,loading:c,refresh:h}=Y(l),{data:f,refresh:v}=ee(l),[N,E]=p.useState(!1),[s,n]=p.useState({}),[a,m]=p.useState({title:"",description:"",thumbnail_url:"",banner_url:"",published:!1});p.useEffect(()=>{u&&m({title:u.title||"",description:u.description||"",thumbnail_url:u.thumbnail_url||"",banner_url:u.banner_url||"",published:!!u.published})},[u]),p.useEffect(()=>{const t={};f.forEach(o=>{t[o.id]={title:o.title||"",order_index:o.order_index??0,thumbnail_url:o.thumbnail_url||""}}),n(t)},[f]);const D=async()=>{if(u){E(!0);try{const{error:t}=await y.from("content_items").update({title:a.title.trim(),description:a.description||null,thumbnail_url:a.thumbnail_url||null,banner_url:a.banner_url||null,published:a.published}).eq("id",u.id);if(t){alert(`Erro ao salvar conteúdo: ${t.message}`);return}h()}catch(t){alert(`Erro ao salvar conteúdo: ${t.message}`)}finally{E(!1)}}},L=async(t,o)=>{if(u?.id)try{const b=I(t.name),i=`content-items/${u.id}/${o}-${crypto.randomUUID()}-${b}`,x=await M(i,t);m(w=>({...w,thumbnail_url:o==="thumbnail"?x:w.thumbnail_url,banner_url:o==="banner"?x:w.banner_url}))}catch(b){alert(`Erro ao enviar imagem: ${b.message}`)}},S=async(t,o)=>{try{const b=I(o.name),i=`content-modules/${t}/thumbnail-${crypto.randomUUID()}-${b}`,x=await M(i,o);n(w=>({...w,[t]:{title:w[t]?.title||"",order_index:w[t]?.order_index??0,thumbnail_url:x}}))}catch(b){alert(`Erro ao enviar imagem do módulo: ${b.message}`)}},$=async()=>{if(!u?.id)return;const{error:t}=await y.from("content_modules").insert({content_id:u.id,title:"Novo módulo",order_index:f.length+1});if(t){alert(`Erro ao criar módulo: ${t.message}`);return}v()},U=async(t,o,b,i)=>{const{error:x}=await y.from("content_modules").update({title:o.trim(),order_index:b,thumbnail_url:i||null}).eq("id",t);if(x){alert(`Erro ao atualizar módulo: ${x.message}`);return}v()},z=async t=>{if(!confirm("Excluir módulo?"))return;const{error:o}=await y.from("content_modules").delete().eq("id",t);if(o){alert(`Erro ao excluir módulo: ${o.message}`);return}v()},T=async(t,o)=>{const b=f.findIndex(Z=>Z.id===t);if(b===-1)return;const i=o==="up"?b-1:b+1;if(i<0||i>=f.length)return;const x=f[b],w=f[i],{error:O}=await y.from("content_modules").update({order_index:w.order_index}).eq("id",x.id);if(O){alert(`Erro ao reordenar módulos: ${O.message}`);return}const{error:R}=await y.from("content_modules").update({order_index:x.order_index}).eq("id",w.id);if(R){alert(`Erro ao reordenar módulos: ${R.message}`);return}v()},{data:q,refresh:K}=re({contentId:l||null,moduleId:r.get("module")||null,lessonId:r.get("lesson")||null,studentUserId:r.get("student")||null}),[J,A]=p.useState([]),[Q,F]=p.useState([]);if(p.useEffect(()=>{(async()=>{if(!f.length){F([]);return}const o=f.map(i=>i.id),{data:b}=await y.from("content_lessons").select("id, module_id, title").in("module_id",o).order("order_index",{ascending:!0});F(b||[])})()},[f]),p.useEffect(()=>{(async()=>{const o=Array.from(new Set(q.map(x=>x.student_user_id).filter(Boolean)));if(!o.length){A([]);return}const{data:b}=await y.from("profiles").select("id, full_name").in("id",o),i=(b||[]).map(x=>({id:x.id,name:x.full_name||x.id}));A(i)})()},[q]),c)return e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"Carregando conteúdo..."});if(!u)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-500",children:"Conteúdo não encontrado."}),e.jsx(B,{to:"/admin/content",className:"text-brand-600 hover:underline",children:"Voltar"})]});const C=j||u.type;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(B,{to:`/admin/content?type=${C}`,className:"text-sm text-brand-600 hover:underline",children:"← Voltar para lista"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mt-2",children:u.title||"Sem título"}),e.jsx("p",{className:"text-gray-500",children:u.type==="course"?"Curso":"Treinamento"})]}),e.jsx("button",{type:"button",onClick:()=>_(`/admin/content?type=${C}`),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50",children:"Fechar"})]}),e.jsx("div",{className:"flex gap-2",children:["about","modules","comments"].map(t=>e.jsx("button",{type:"button",onClick:()=>d({tab:t,type:C}),className:`px-3 py-2 text-sm rounded-lg border ${g===t?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:t==="about"?"Sobre":t==="modules"?"Módulos":"Comentários"},t))}),g==="about"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Sobre"}),e.jsx("button",{type:"button",onClick:D,disabled:N,className:"px-4 py-2 bg-brand-600 text-white rounded-lg text-sm hover:bg-brand-700 disabled:opacity-50",children:N?"Salvando...":"Salvar"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:a.title,onChange:t=>m(o=>({...o,title:t.target.value})),placeholder:"Nome",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{value:a.description,onChange:t=>m(o=>({...o,description:t.target.value})),placeholder:"Descrição",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:a.published,onChange:t=>m(o=>({...o,published:t.target.checked}))}),"Publicado"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Thumbnail URL"}),e.jsx("input",{value:a.thumbnail_url,onChange:t=>m(o=>({...o,thumbnail_url:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-gray-100 rounded cursor-pointer inline-block",children:[a.thumbnail_url?"Trocar thumbnail":"Upload thumbnail",e.jsx("input",{type:"file",className:"hidden",onChange:t=>{const o=t.target.files?.[0];o&&L(o,"thumbnail"),t.currentTarget.value=""}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Banner URL"}),e.jsx("input",{value:a.banner_url,onChange:t=>m(o=>({...o,banner_url:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-gray-100 rounded cursor-pointer inline-block",children:[a.banner_url?"Trocar banner":"Upload banner",e.jsx("input",{type:"file",className:"hidden",onChange:t=>{const o=t.target.files?.[0];o&&L(o,"banner"),t.currentTarget.value=""}})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:a.banner_url?e.jsx("img",{src:a.banner_url,alt:"Banner",className:"w-full h-32 object-cover"}):e.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center text-xs text-gray-400",children:"Banner 1250x250"})}),e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden w-40 h-40",children:a.thumbnail_url?e.jsx("img",{src:a.thumbnail_url,alt:"Thumbnail",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-xs text-gray-400",children:"Thumbnail"})})]})]})]}),g==="modules"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Módulos"}),e.jsx("button",{type:"button",onClick:$,className:"px-4 py-2 bg-brand-600 text-white rounded-lg text-sm",children:"Novo módulo"})]}),f.length===0?e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-6 text-gray-500 text-sm",children:"Nenhum módulo cadastrado."}):e.jsx("div",{className:"space-y-3",children:f.map((t,o)=>{const b=s[t.id];return e.jsxs("details",{open:!0,className:"bg-white border border-gray-100 rounded-xl p-4 space-y-3",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:b?.title||"",onChange:i=>n(x=>({...x,[t.id]:{title:i.target.value,order_index:x[t.id]?.order_index??0,thumbnail_url:x[t.id]?.thumbnail_url||""}})),onClick:i=>i.stopPropagation(),className:"px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{type:"number",value:b?.order_index??0,onChange:i=>n(x=>({...x,[t.id]:{title:x[t.id]?.title||"",order_index:Number(i.target.value),thumbnail_url:x[t.id]?.thumbnail_url||""}})),onClick:i=>i.stopPropagation(),className:"w-20 px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),T(t.id,"up")},className:"text-xs text-gray-500 hover:text-gray-700",children:"↑"}),e.jsx("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),T(t.id,"down")},className:"text-xs text-gray-500 hover:text-gray-700",children:"↓"})]}),e.jsx("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),U(t.id,b?.title||"",b?.order_index??0,b?.thumbnail_url||"")},className:"text-xs px-2 py-1 bg-gray-900 text-white rounded",children:"Salvar"}),e.jsx("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),z(t.id)},className:"text-xs text-red-600 hover:underline",children:"Excluir"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Módulo ",o+1]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Imagem do módulo (URL)"}),e.jsx("input",{value:b?.thumbnail_url||"",onChange:i=>n(x=>({...x,[t.id]:{title:x[t.id]?.title||"",order_index:x[t.id]?.order_index??0,thumbnail_url:i.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),e.jsxs("label",{className:"text-xs px-2 py-2 bg-gray-100 rounded cursor-pointer text-gray-600 text-center",children:["Upload imagem",e.jsx("input",{type:"file",className:"hidden",onChange:i=>{const x=i.target.files?.[0];x&&S(t.id,x),i.currentTarget.value=""}})]})]}),e.jsx(de,{moduleId:t.id})]},t.id)})})]}),g==="comments"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Comentários"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:r.get("module")||"",onChange:t=>d({tab:"comments",type:C,module:t.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todos os módulos"}),f.map(t=>e.jsx("option",{value:t.id,children:t.title||"Sem módulo"},t.id))]}),e.jsxs("select",{value:r.get("lesson")||"",onChange:t=>d({tab:"comments",type:C,module:r.get("module")||"",lesson:t.target.value,student:r.get("student")||""}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todas as aulas"}),Q.filter(t=>{const o=r.get("module");return o?t.module_id===o:!0}).map(t=>e.jsx("option",{value:t.id,children:t.title||t.id},t.id))]}),e.jsxs("select",{value:r.get("student")||"",onChange:t=>d({tab:"comments",type:C,module:r.get("module")||"",lesson:r.get("lesson")||"",student:t.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todos os alunos"}),J.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl divide-y divide-gray-100",children:[q.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"Nenhum comentário encontrado."}),q.map(t=>e.jsxs("details",{className:"p-4",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Comentário"}),e.jsx("p",{className:"text-xs text-gray-500",children:t.created_at?.slice(0,10)})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t.status==="answered"?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"}`,children:t.status==="answered"?"Respondido":"Pendente"})]}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:t.content||"Sem conteúdo."}),t.status!=="answered"&&e.jsx("button",{type:"button",onClick:async()=>{await y.from("content_comments").update({status:"answered"}).eq("id",t.id),K()},className:"text-xs text-brand-600 hover:underline",children:"Marcar como respondido"})]})]},t.id))]})]})]})};export{ie as default};
