import{d as Ua,u as Ea,r,s as i,j as e,S as Aa,B as Xe,f as Ra,W as Pa,e as La}from"./index-HcuLVkXM.js";import{c as Ia,b as Ze}from"./utils-C6qNh0Lg.js";import{u as Ye}from"./useModalControls-BiWM_r1l.js";import{R as $a}from"./refresh-cw-CbS8BK1e.js";import{L as ie}from"./loader-2-CJ7EHZdi.js";import{P as ne}from"./plus-DDz1DOCh.js";const ea="user-avatars",oe=350,za=g=>g.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,Ma=g=>new Promise((b,x)=>{const N=new Image,k=URL.createObjectURL(g);N.onload=()=>{URL.revokeObjectURL(k),b({width:N.width,height:N.height})},N.onerror=()=>{URL.revokeObjectURL(k),x(new Error("Imagem inválida."))},N.src=k}),aa=async g=>{if(!g.type.startsWith("image/"))return"Envie um arquivo de imagem.";try{const{width:b,height:x}=await Ma(g);return b!==x?"A imagem precisa ser quadrada.":b>oe||x>oe?`A imagem deve ter no máximo ${oe} x ${oe}px.`:null}catch{return"Não foi possível ler a imagem."}},sa=async(g,b)=>{const x=za(b.name),N=`clinics/${g}/${crypto.randomUUID()}-${x}`,{error:k}=await i.storage.from(ea).upload(N,b,{upsert:!0});if(k)throw k;const{data:f}=i.storage.from(ea).getPublicUrl(N);return f.publicUrl},ke=g=>{const b=g.trim();if(!b)return"CL";const x=b.split(/\s+/).filter(Boolean);return x.length===1?x[0].slice(0,2).toUpperCase():`${x[0][0]||""}${x[x.length-1][0]||""}`.toUpperCase()},Wa=({initialTab:g="overview"})=>{const b=Ua(),{isSystemAdmin:x,selectedClinicId:N,setSelectedClinicId:k}=Ea(),f=[{value:"/",label:"Dash Financeiro"},{value:"/reports/attendance",label:"Relatório de Atendimento"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/profile",label:"Meu perfil"},{value:"/assistant",label:"Assistente AI"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Minha Clínica"},{value:"/settings?section=geral",label:"Minha Clínica • Informações gerais"},{value:"/settings?section=categorias",label:"Minha Clínica • Categorias"},{value:"/settings?section=taxas",label:"Minha Clínica • Taxas"},{value:"/settings?section=clientes",label:"Minha Clínica • Clientes"},{value:"/settings?section=procedimentos",label:"Minha Clínica • Procedimentos"},{value:"/settings?section=profissionais",label:"Minha Clínica • Profissionais"},{value:"/settings?section=fornecedores",label:"Minha Clínica • Fornecedores"},{value:"/settings?section=usuarios",label:"Minha Clínica • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dash comercial"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"},{value:"/pricing/calculator",label:"Precificação • Calculadora"},{value:"/pricing/procedures",label:"Precificação • Procedimentos"},{value:"/pricing/expenses",label:"Precificação • Gastos"},{value:"/pricing/focus-matrix",label:"Precificação • Matriz de Foco"},{value:"/hr/departments",label:"Minha Clínica • Departamentos"},{value:"/hr/collaborators",label:"Minha Clínica • Colaboradores"},{value:"/hr/feedback",label:"Recursos Humanos • Feedback"},{value:"/hr/meetings",label:"Recursos Humanos • Reuniões"},{value:"/app/agenda",label:"Recursos Humanos • Agenda"},{value:"/hr/archetypes",label:"Recursos Humanos • Arquétipos"},{value:"/hr/values",label:"Recursos Humanos • Teoria de valores"},{value:"/analytics/perfil",label:"Analytics • Perfil comportamental"}],z=r.useMemo(()=>Object.fromEntries(f.map(a=>[a.value,a.label])),[]),[A,Se]=r.useState(g),[ce,Ue]=r.useState(!0),[w,Ee]=r.useState([]),[m,j]=r.useState({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),[de,me]=r.useState(null),[R,ue]=r.useState(null),[q,xe]=r.useState(null),[B,ta]=r.useState([]),[ra,la]=r.useState({}),[M,Ae]=r.useState(null),[Re,T]=r.useState(!1),[u,v]=r.useState({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),[ge,W]=r.useState(null),[P,G]=r.useState(null),[J,H]=r.useState(null),[be,V]=r.useState([]),[K,Pe]=r.useState(""),[L,Le]=r.useState("todas"),[Ie,E]=r.useState([]),[y,C]=r.useState({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}),[Q,F]=r.useState(null),[$e,O]=r.useState(!1),[p,h]=r.useState({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}),[X,pe]=r.useState([]),[ze,ia]=r.useState(""),[Me,na]=r.useState("user"),[he,Z]=r.useState([]),[Y,ee]=r.useState(!1),[fe,ae]=r.useState(!1),[Te,Fe]=r.useState(null),[Oe,ve]=r.useState([]),[I,oa]=r.useState(!0),[S,se]=r.useState({clinic_id:"",email:"",role:"user"}),[De,qe]=r.useState(!1),[ca,da]=r.useState(null),U=Ia("/auth/callback"),ye=r.useRef(null),je=r.useRef(null),Ne=r.useRef(null),we=r.useRef(null),Ce=r.useRef(null),ma={overview:"/admin/dashboard",clinics:"/admin/clinics",users:"/admin/users"},D=async()=>{Ue(!0);try{const{data:a,error:s}=await i.from("clinics").select("*, bank_accounts (id), categories (id), clinic_users (id, ativo)").order("created_at",{ascending:!1});if(s)throw s;Ee(a||[])}catch(a){console.error("Erro ao carregar clínicas:",a)}finally{Ue(!1)}},ua=async()=>{const{data:a,error:s}=await i.from("content_packages").select("*").order("created_at",{ascending:!1});s||ta(a||[])},Be=async()=>{const{data:a,error:s}=await i.from("clinic_packages").select("clinic_id, package_id");if(s)return;const t={};(a||[]).forEach(l=>{!l.clinic_id||!l.package_id||(t[l.clinic_id]||(t[l.clinic_id]=[]),t[l.clinic_id].push(l.package_id))}),la(t)},We=async(a,s)=>{if(await i.from("clinic_packages").delete().eq("clinic_id",a),s){const t=[{clinic_id:a,package_id:s}];await i.from("clinic_packages").insert(t)}Be()},Ge=async(a,s)=>{if(!a.length)return;const{error:t}=await i.from("clinics").update({ativo:s}).in("id",a);if(t){alert("Erro ao atualizar clínicas: "+t.message);return}V([]),D()},xa=()=>{j({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),me(null),ue(null),xe(null)},te=()=>{Ae(null),v({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),W(null),G(null),H(null)},Je=()=>{T(!1),te()},He=()=>{O(!1),F(null),h({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})},ga=Ye({isOpen:Re,onClose:Je}),ba=Ye({isOpen:$e,onClose:He}),pa=async a=>{const s=await aa(a);if(s){xe(s),me(null),ue(null);return}xe(null),me(a),ue(URL.createObjectURL(a))},ha=async a=>{const s=await aa(a);if(s){H(s),W(null),G(null);return}H(null),W(a),G(URL.createObjectURL(a))},fa=a=>{Ae(a.id),v({name:a.name||"",responsavel_nome:a.responsavel_nome||"",documento:a.documento||"",email_contato:a.email_contato||"",telefone_contato:a.telefone_contato||"",plano:a.plano||"basico",paginas_liberadas:a.paginas_liberadas||[],package_id:(ra[a.id]||[])[0]||"",ativo:a.ativo??!0,logo_url:a.logo_url||null}),W(null),G(null),H(null),T(!0)},va=a=>{F(a.id),h({clinic_id:a.clinic_id||"",name:a.name||"",email:a.email||"",role:a.role||"user",ativo:a.ativo??!0,paginas_liberadas:a.paginas_liberadas||[]}),O(!0)},ya=async a=>{if(a.preventDefault(),!!m.name.trim()){if(q&&de){alert(q);return}ee(!0);try{const{package_id:s,...t}=m,l=B.find(d=>d.id===s),n={...t,plano:l?.name||m.plano||"basico"},o=n.email_contato?.trim().toLowerCase();if(o){const{data:d}=await i.from("clinic_users").select("id, clinic_id").eq("email",o).maybeSingle();if(d){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}}const{data:c,error:_}=await i.from("clinics").insert([{...n}]).select().single();if(_)throw _;if(c?.id&&de)try{const d=await sa(c.id,de);await i.from("clinics").update({logo_url:d}).eq("id",c.id)}catch(d){alert(`Clínica criada, mas não foi possível enviar a imagem: ${d.message}`)}if(c?.id&&o){const{data:d}=await i.from("clinic_users").select("id").eq("clinic_id",c.id).eq("email",o).maybeSingle();if(!d){const{error:$}=await i.from("clinic_users").insert({clinic_id:c.id,email:o,name:m.responsavel_nome?.trim()||o.split("@")[0]||"Responsável",role:"owner",ativo:!0,paginas_liberadas:m.paginas_liberadas||[]});if($)console.warn("Erro ao criar usuário da clínica:",$.message),alert(`Clínica criada, mas não foi possível criar o usuário automaticamente: ${$.message}`);else{const Ve=U?`${U}?redirectTo=${encodeURIComponent("/")}`:void 0,Ke={shouldCreateUser:!0};Ve&&(Ke.emailRedirectTo=Ve);const{error:Qe}=await i.auth.signInWithOtp({email:o,options:Ke});Qe&&alert(`Usuário criado, mas não foi possível enviar o e-mail de acesso: ${Qe.message}`)}}}c?.id&&await We(c.id,s||""),xa(),D()}catch(s){alert("Erro ao salvar clínica: "+s.message)}finally{ee(!1)}}},ja=async a=>{if(a.preventDefault(),!!M&&u.name.trim()){if(J&&ge){alert(J);return}ee(!0);try{const{package_id:s,...t}=u,l=B.find(_=>_.id===s),n={...t,plano:l?.name||u.plano||"basico"};let o=u.logo_url||null;ge&&(o=await sa(M,ge));const{error:c}=await i.from("clinics").update({...n,logo_url:o}).eq("id",M);if(c)throw c;await We(M,s||""),T(!1),te(),D()}catch(s){alert("Erro ao atualizar clínica: "+s.message)}finally{ee(!1)}}},Na=async a=>{const s=a.name||a.id||"esta clínica";if(confirm(`Excluir ${s}? Essa ação é permanente.`))try{await i.from("clinic_packages").delete().eq("clinic_id",a.id);const{error:t}=await i.from("clinics").delete().eq("id",a.id);if(t)throw t;Ee(l=>l.filter(n=>n.id!==a.id)),V(l=>l.filter(n=>n!==a.id)),M===a.id&&(T(!1),te())}catch(t){alert("Erro ao excluir clínica: "+t.message)}},wa=async a=>{const s=a.email_contato?.trim().toLowerCase()||"",{data:t,error:l}=await i.from("clinic_users").select("email, role, ativo, created_at").eq("clinic_id",a.id).eq("ativo",!0).order("created_at",{ascending:!0});if(l)throw l;const n=(t||[]).filter(d=>!!d.email);if(!n.length||(s?n.find(d=>d.email?.trim().toLowerCase()===s):null))return s;const c=n.find(d=>d.role==="owner");if(c?.email)return c.email.trim().toLowerCase();const _=n.find(d=>d.role==="admin");return _?.email?_.email.trim().toLowerCase():n[0]?.email?.trim().toLowerCase()||s},Ca=async a=>{if(a?.id){Fe(a.id);try{const s=await wa(a);if(!s){alert("Sem e-mail de acesso disponível. Cadastre um usuário ativo ou o e-mail de contato da clínica.");return}if(!confirm(`Reenviar acesso para ${s}?`))return;const t=U?`${U}?redirectTo=${encodeURIComponent("/")}`:void 0,l={shouldCreateUser:!0};t&&(l.emailRedirectTo=t);const{error:n}=await i.auth.signInWithOtp({email:s,options:l});if(n)throw n;alert(`Acesso reenviado para ${s}.`)}catch(s){alert("Não foi possível reenviar o acesso: "+s.message)}finally{Fe(null)}}},_a=async()=>{ae(!0);try{const a=y.email.trim().toLowerCase();if(!a){alert("Informe um e-mail válido.");return}const{data:s}=await i.from("clinic_users").select("id").eq("email",a).maybeSingle();if(s){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}const{error:t}=await i.from("clinic_users").insert([{...y,email:a}]);if(t)throw t;if(a){const n=U?`${U}?redirectTo=${encodeURIComponent("/")}`:void 0,o={shouldCreateUser:!0};n&&(o.emailRedirectTo=n);const{error:c}=await i.auth.signInWithOtp({email:a,options:o});c&&alert("Usuário criado, mas não foi possível enviar o email de acesso: "+c.message)}const{data:l}=await i.from("clinic_users").select("*").order("created_at",{ascending:!1});l&&E(l),C({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})}catch(a){alert("Erro ao salvar usuário: "+a.message)}finally{ae(!1)}},ka=async a=>{if(a.preventDefault(),!!Q){ae(!0);try{const s=p.email.trim().toLowerCase();if(!s){alert("Informe um e-mail válido.");return}const{data:t}=await i.from("clinic_users").select("id").eq("email",s).maybeSingle();if(t&&t.id!==Q){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}const{error:l}=await i.from("clinic_users").update({...p,email:s}).eq("id",Q);if(l)throw l;const{data:n}=await i.from("clinic_users").select("*").order("created_at",{ascending:!1});n&&E(n),O(!1),F(null),h({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})}catch(s){alert("Erro ao atualizar usuário: "+s.message)}finally{ae(!1)}}},Sa=async a=>{const s=a.name||a.email||"este usuário";if(!confirm(`Excluir ${s}?`))return;const{error:t}=await i.from("clinic_users").delete().eq("id",a.id);if(t){alert("Erro ao excluir usuário: "+t.message);return}E(l=>l.filter(n=>n.id!==a.id)),pe(l=>l.filter(n=>n!==a.id)),Q===a.id&&(O(!1),F(null),h({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}))};r.useEffect(()=>{Se(g)},[g]);const _e=a=>{Se(a),b(ma[a])};r.useEffect(()=>{D(),ua(),Be(),i.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>{a&&E(a)}),i.from("clinic_invites").select("*").order("created_at",{ascending:!1}).then(({data:a,error:s})=>{if(s){console.warn("Convites indisponíveis (tabela ausente?):",s.message),oa(!1);return}ve(a||[])}),i.auth.getSession().then(({data:a})=>da(a.session?.user.id||null))},[]),r.useEffect(()=>()=>{R?.startsWith("blob:")&&URL.revokeObjectURL(R)},[R]),r.useEffect(()=>()=>{P?.startsWith("blob:")&&URL.revokeObjectURL(P)},[P]);const re=r.useMemo(()=>{const a=w.length,s=w.reduce((n,o)=>n+(o.clinic_users?.length||0),0),t=w.reduce((n,o)=>n+(o.clinic_users?.filter(c=>c.ativo!==!1).length||0),0),l=w.reduce((n,o)=>n+(o.bank_accounts?.length||0),0);return{totalClinics:a,totalUsers:s,totalUsersAtivos:t,totalAccounts:l}},[w]),le=r.useMemo(()=>w.filter(a=>{const s=a.name?.toLowerCase().includes(K.toLowerCase()),t=L==="todas"||L==="ativas"&&a.ativo!==!1||L==="inativas"&&a.ativo===!1;return s&&t}),[w,K,L]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Aa,{size:22})," Administrador"]}),e.jsx("p",{className:"text-gray-500",children:"Visão geral de todos os clientes (multiusuário)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_e("overview"),className:`px-3 py-2 text-sm rounded-lg border ${A==="overview"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Visão geral"}),e.jsx("button",{onClick:()=>_e("clinics"),className:`px-3 py-2 text-sm rounded-lg border ${A==="clinics"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Clínicas"}),e.jsx("button",{onClick:()=>_e("users"),className:`px-3 py-2 text-sm rounded-lg border ${A==="users"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Usuários"}),e.jsxs("button",{onClick:D,className:"px-4 py-2 bg-white border border-gray-200 rounded-lg flex items-center gap-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx($a,{size:16})," Atualizar"]})]})]}),A==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-50 text-brand-600 flex items-center justify-center",children:e.jsx(Xe,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Clínicas"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:re.totalClinics})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center",children:e.jsx(Ra,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Usuários"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[re.totalUsers," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",re.totalUsersAtivos," ativos)"]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center",children:e.jsx(Pa,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Contas Bancárias"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:re.totalAccounts})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Clínicas"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Dados gerais de todos os clientes"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{type:"text",value:K,onChange:a=>Pe(a.target.value),placeholder:"Buscar clínica por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("select",{value:L,onChange:a=>Le(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"todas",children:"Todas"}),e.jsx("option",{value:"ativas",children:"Ativas"}),e.jsx("option",{value:"inativas",children:"Inativas"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Nome"}),e.jsx("th",{className:"px-6 py-3",children:"Criada em"}),e.jsx("th",{className:"px-6 py-3",children:"Plano"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Usuários"}),e.jsx("th",{className:"px-6 py-3",children:"Contas"}),e.jsx("th",{className:"px-6 py-3",children:"Categorias"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[ce&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-6 text-center text-gray-400",children:"Carregando..."})}),!ce&&le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-6 text-center text-gray-400",children:"Nenhuma clínica encontrada."})}),!ce&&le.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-800",children:a.name}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:Ze(a.created_at)}),e.jsx("td",{className:"px-6 py-4 text-gray-600 capitalize",children:a.plano||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a.ativo===!1?"bg-gray-100 text-gray-600":"bg-emerald-50 text-emerald-700"}`,children:a.ativo===!1?"Inativa":"Ativa"})}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[a.clinic_users?.length||0,a.clinic_users&&a.clinic_users.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[" • ",a.clinic_users.filter(s=>s.ativo!==!1).length," ativos"]})]}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.bank_accounts?.length||0}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.categories?.length||0})]},a.id))]})]})})]})]}),A==="clinics"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Xe,{size:18})," Clínicas"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestão completa das clínicas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ge(be,!0),className:"px-3 py-2 text-sm bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-100",children:"Ativar selecionadas"}),e.jsx("button",{onClick:()=>Ge(be,!1),className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100",children:"Desativar selecionadas"})]})]}),e.jsxs("form",{onSubmit:ya,className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Clínica"}),e.jsx("input",{value:m.name,onChange:a=>j(s=>({...s,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem da clínica"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-[150px] w-[150px] rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:R||m.logo_url?e.jsx("img",{src:R||m.logo_url||"",alt:"Imagem da clínica",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:ke(m.name||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[R||m.logo_url?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async a=>{const s=a.target.files?.[0];s&&await pa(s),a.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),q&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsável"}),e.jsx("input",{value:m.responsavel_nome,onChange:a=>j(s=>({...s,responsavel_nome:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ/CPF"}),e.jsx("input",{value:m.documento,onChange:a=>j(s=>({...s,documento:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{value:m.email_contato,onChange:a=>j(s=>({...s,email_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:m.telefone_contato,onChange:a=>j(s=>({...s,telefone_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacote"}),e.jsxs("select",{value:m.package_id,onChange:a=>j(s=>({...s,package_id:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),B.map(a=>e.jsx("option",{value:a.id,children:a.name||"Sem nome"},a.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>j(a=>({...a,paginas_liberadas:f.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>j(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:ye,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(a=>e.jsx("button",{type:"button",onClick:()=>{m.paginas_liberadas.includes(a.value)||(j(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),ye.current&&ye.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>j(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[z[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:a=>j(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativa"]}),e.jsxs("button",{type:"submit",disabled:Y,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[Y?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(ne,{size:16}),"Salvar"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{type:"text",value:K,onChange:a=>Pe(a.target.value),placeholder:"Buscar clínica por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("select",{value:L,onChange:a=>Le(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"todas",children:"Todas"}),e.jsx("option",{value:"ativas",children:"Ativas"}),e.jsx("option",{value:"inativas",children:"Inativas"})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[le.map(a=>{const s=be.includes(a.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:t=>{t.target.checked?V(l=>[...l,a.id]):V(l=>l.filter(n=>n!==a.id))}}),e.jsx("div",{className:"h-[150px] w-[150px] rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:a.logo_url?e.jsx("img",{src:a.logo_url,alt:`Logo de ${a.name||"clínica"}`,className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:ke(a.name||"")})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["ID: ",a.id]})," ",a.name," ",!a.ativo&&e.jsx("span",{className:"text-xs text-red-600",children:"(inativa)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Pacote: ",a.plano||"—"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Contato: ",a.responsavel_nome||"-"," • ",a.email_contato||"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx("button",{onClick:()=>{k(a.id),b("/")},className:"text-sm text-emerald-600",children:"Acessar"}),e.jsx("button",{onClick:()=>Ca(a),disabled:Te===a.id,className:"text-sm text-sky-600 disabled:opacity-50",children:Te===a.id?"Enviando...":"Reenviar acesso"}),e.jsx("button",{onClick:()=>fa(a),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>Na(a),className:"text-sm text-red-600",children:"Excluir"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.ativo?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:a.ativo?"Ativa":"Inativa"}),x&&N===a.id&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-amber-50 text-amber-700",children:"Em uso"})]})]},a.id)}),le.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhuma clínica cadastrada."})]}),Re&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:ga.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-auto space-y-4",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar clínica"}),e.jsx("button",{type:"button",onClick:Je,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:ja,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Clínica"}),e.jsx("input",{value:u.name,onChange:a=>v(s=>({...s,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem da clínica"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-[150px] w-[150px] rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:P||u.logo_url?e.jsx("img",{src:P||u.logo_url||"",alt:"Imagem da clínica",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:ke(u.name||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[P||u.logo_url?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async a=>{const s=a.target.files?.[0];s&&await ha(s),a.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),J&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:J})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsável"}),e.jsx("input",{value:u.responsavel_nome,onChange:a=>v(s=>({...s,responsavel_nome:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ/CPF"}),e.jsx("input",{value:u.documento,onChange:a=>v(s=>({...s,documento:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{value:u.email_contato,onChange:a=>v(s=>({...s,email_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:u.telefone_contato,onChange:a=>v(s=>({...s,telefone_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacote"}),e.jsxs("select",{value:u.package_id,onChange:a=>v(s=>({...s,package_id:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),B.map(a=>e.jsx("option",{value:a.id,children:a.name||"Sem nome"},a.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>v(a=>({...a,paginas_liberadas:f.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>v(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:je,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(a=>e.jsx("button",{type:"button",onClick:()=>{u.paginas_liberadas.includes(a.value)||(v(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),je.current&&je.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>v(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[z[a]||a," ✕"]},a))})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 w-full",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:u.ativo,onChange:a=>v(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativa"]}),e.jsx("button",{type:"button",onClick:()=>{T(!1),te()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Y,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[Y?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(ne,{size:16}),"Salvar alterações"]})]})]})]})})]}),A==="users"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(La,{size:16})," Usuários da Clínica"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i.from("clinic_users").update({ativo:!0}).in("id",X).then(()=>i.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&E(a))),className:"px-3 py-2 text-sm bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-100",children:"Ativar"}),e.jsx("button",{onClick:()=>i.from("clinic_users").update({ativo:!1}).in("id",X).then(()=>i.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&E(a))),className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100",children:"Desativar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-4 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Convidar usuário"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Gere um convite por e-mail (role: owner/admin/user)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:S.email,onChange:a=>se(s=>({...s,email:a.target.value})),placeholder:"email@dominio.com",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("select",{value:S.clinic_id,onChange:a=>se(s=>({...s,clinic_id:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"Clínica..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs("select",{value:S.role,onChange:a=>se(s=>({...s,role:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]}),e.jsx("button",{type:"button",disabled:De||!I,onClick:async()=>{if(!I){alert("Convites indisponíveis: tabela clinic_invites não encontrada no Supabase.");return}if(!S.email||!S.clinic_id){alert("Informe e-mail e clínica");return}const a=S.email.trim().toLowerCase(),{data:s}=await i.from("clinic_users").select("id").eq("email",a).maybeSingle();if(s){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}qe(!0);try{const t=crypto.randomUUID(),l=new Date(Date.now()+10080*60*1e3).toISOString(),{error:n,data:o}=await i.from("clinic_invites").insert([{clinic_id:S.clinic_id,email:a,role:S.role,token:t,invited_by:ca,expires_at:l}]).select().single();if(n)throw n;const c=U?`${U}?redirectTo=${encodeURIComponent(`/accept-invite?token=${o.token}`)}`:void 0,_={shouldCreateUser:!0};c&&(_.emailRedirectTo=c);const{error:d}=await i.auth.signInWithOtp({email:a,options:_});alert(d?`Convite gerado, mas não foi possível enviar o email: ${d.message}. Link: /accept-invite?token=${o.token}`:`Convite enviado por email. Se necessário, use o link /accept-invite?token=${o.token}`);const{data:$}=await i.from("clinic_invites").select("*").order("created_at",{ascending:!1});$&&ve($),se({clinic_id:"",email:"",role:"user"})}catch(t){alert("Erro ao enviar convite: "+t.message)}finally{qe(!1)}},className:`px-4 py-2 rounded-lg text-sm ${I?"bg-brand-600 text-white hover:bg-brand-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:I?De?"Enviando...":"Enviar convite":"Convites indisponíveis"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-white text-gray-500 border border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"E-mail"}),e.jsx("th",{className:"px-3 py-2",children:"Clínica"}),e.jsx("th",{className:"px-3 py-2",children:"Role"}),e.jsx("th",{className:"px-3 py-2",children:"Expira"}),e.jsx("th",{className:"px-3 py-2",children:"Token"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[I?Oe.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-800",children:a.email}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:a.clinic_id}),e.jsx("td",{className:"px-3 py-2 text-gray-600 capitalize",children:a.role}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:Ze(a.expires_at)}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-500 break-all",children:a.token}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:async()=>{if(!confirm("Revogar convite?"))return;const{error:s}=await i.from("clinic_invites").delete().eq("id",a.id);if(s){alert(s.message);return}ve(t=>t.filter(l=>l.id!==a.id))},className:"text-sm text-red-600 hover:underline",children:"Revogar"})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-3 text-center text-gray-400",children:"Convites indisponíveis (tabela clinic_invites ausente)."})}),I&&Oe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-3 text-center text-gray-400",children:"Nenhum convite pendente."})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),e.jsxs("select",{value:y.clinic_id,onChange:a=>C({...y,clinic_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:y.name,onChange:a=>C({...y,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:y.email,onChange:a=>C({...y,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@dominio.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Papel/Acesso"}),e.jsxs("select",{value:y.role,onChange:a=>C({...y,role:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>C(a=>({...a,paginas_liberadas:f.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>C(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:Ne,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(a=>e.jsx("button",{type:"button",onClick:()=>{y.paginas_liberadas.includes(a.value)||(C(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),Ne.current&&Ne.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>C(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[z[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:y.ativo,onChange:a=>C(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativo"]}),e.jsxs("button",{type:"button",onClick:_a,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[fe?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(ne,{size:16}),"Adicionar"]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:ze,onChange:a=>ia(a.target.value),placeholder:"Buscar usuário por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500 flex-1"}),e.jsx("button",{onClick:()=>{i.from("clinic_users").update({role:Me,paginas_liberadas:he}).in("id",X).then(()=>i.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&E(a)))},className:"px-3 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700",children:"Aplicar papel/páginas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aplicar papel aos selecionados"}),e.jsxs("select",{value:Me,onChange:a=>na(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas (aplicar aos selecionados)"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>Z(f.map(a=>a.value)),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>Z([]),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:Ce,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(a=>e.jsx("button",{type:"button",onClick:()=>{he.includes(a.value)||(Z(s=>[...s,a.value]),Ce.current&&Ce.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:he.map(a=>e.jsxs("button",{type:"button",onClick:()=>Z(s=>s.filter(t=>t!==a)),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[z[a]||a," ✕"]},a))})]})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[Ie.filter(a=>a.name?.toLowerCase().includes(ze.toLowerCase())).map(a=>{const s=X.includes(a.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:t=>{t.target.checked?pe(l=>[...l,a.id]):pe(l=>l.filter(n=>n!==a.id))}}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:[a.name," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",a.role||"user",")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.email," • Clínica: ",a.clinic_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>va(a),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>Sa(a),className:"text-sm text-red-600",children:"Excluir"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.ativo?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:a.ativo?"Ativo":"Inativo"})]})]},a.id)}),Ie.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum usuário cadastrado."})]}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:ba.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar usuário"}),e.jsx("button",{type:"button",onClick:He,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:ka,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),e.jsxs("select",{value:p.clinic_id,onChange:a=>h({...p,clinic_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:p.name,onChange:a=>h({...p,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:p.email,onChange:a=>h({...p,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@dominio.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Papel/Acesso"}),e.jsxs("select",{value:p.role,onChange:a=>h({...p,role:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>h(a=>({...a,paginas_liberadas:f.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>h(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:we,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:f.map(a=>e.jsx("button",{type:"button",onClick:()=>{p.paginas_liberadas.includes(a.value)||(h(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),we.current&&we.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>h(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[z[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"edit-user-active",type:"checkbox",checked:p.ativo,onChange:a=>h({...p,ativo:a.target.checked}),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"edit-user-active",className:"text-sm text-gray-700",children:"Ativo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),F(null),h({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:fe,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[fe?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(ne,{size:16}),"Salvar alterações"]})]})]})]})})]})]})};export{Wa as default};
