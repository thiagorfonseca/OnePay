import{s as a,t as s}from"./index-HcuLVkXM.js";const p=e=>({FACILITADOR:Number(e?.FACILITADOR??0)||0,ANALISTA:Number(e?.ANALISTA??0)||0,REALIZADOR:Number(e?.REALIZADOR??0)||0,VISIONÁRIO:Number(e?.VISIONÁRIO??0)||0}),_=async e=>{const r=e.trim(),{data:t,error:n}=await s.from("archetype_public_links").select("clinic_id, audience_type, is_active, collaborator_id").eq("token",r).eq("is_active",!0).maybeSingle();return n||!t?null:t},d=async e=>{const{answers:r,...t}=e,n=r.map(c=>({question_id:c.questionId,selected_word:c.selectedWord,scored_profile:c.scoredProfile})),{data:o,error:i}=await s.rpc("submit_archetype_response",{p_public_token:t.public_token,p_clinic_id:t.clinic_id,p_audience_type:t.audience_type,p_name:t.name,p_email:t.email??null,p_phone:t.phone??null,p_profession:t.profession??null,p_city:t.city??null,p_consent_lgpd:t.consent_lgpd,p_scores:t.scores,p_top_profile:t.top_profile,p_top_profiles:t.top_profiles??null,p_answers:n});if(i||!o)throw i||new Error("Erro ao salvar respondente.");return o},u=async e=>{let r=a.from("archetype_respondents").select("*").eq("clinic_id",e.clinicId).order("created_at",{ascending:!1});if(e.dateFrom&&(r=r.gte("created_at",`${e.dateFrom}T00:00:00`)),e.dateTo&&(r=r.lte("created_at",`${e.dateTo}T23:59:59`)),e.topProfile&&(r=r.eq("top_profile",e.topProfile)),e.audienceType&&(r=r.eq("audience_type",e.audienceType)),e.token&&(r=r.eq("public_token",e.token)),e.search){const o=`%${e.search}%`;r=r.or(`name.ilike.${o},email.ilike.${o}`)}const{data:t,error:n}=await r;if(n)throw n;return(t||[]).map(o=>({...o,scores:p(o.scores)}))},m=async(e,r)=>{const{data:t,error:n}=await a.from("archetype_respondents").select("*, archetype_answers (question_id, selected_word, scored_profile)").eq("clinic_id",r).eq("id",e).single();if(n)throw n;return t?{...t,scores:p(t.scores)}:null},f=async e=>{const{data:r,error:t}=await a.from("archetype_public_links").select("*").eq("clinic_id",e).order("created_at",{ascending:!1});if(t)throw t;return r||[]},y=async e=>{const{data:r,error:t}=await a.from("archetype_public_links").insert([e]).select("*").single();if(t)throw t;return r},b=async(e,r)=>{const{data:t,error:n}=await a.from("archetype_public_links").update({is_active:r}).eq("id",e).select("*").single();if(n)throw n;return t};export{m as a,y as c,u as f,f as l,_ as r,d as s,b as t};
