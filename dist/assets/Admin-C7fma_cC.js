import{b as ba,r,s as l,j as e,S as pa,B as De,e as ha,W as fa,d as va}from"./index-Bi_Yktdj.js";import{c as ya,b as qe}from"./utils-Bgz2xRk4.js";import{R as ja}from"./refresh-cw-BVgxwze2.js";import{L as se}from"./loader-2-wegoqaf-.js";import{P as te}from"./plus-CW1JmJBD.js";const Me="user-avatars",re=350,Na=g=>g.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,wa=g=>new Promise((h,o)=>{const u=new Image,f=URL.createObjectURL(g);u.onload=()=>{URL.revokeObjectURL(f),h({width:u.width,height:u.height})},u.onerror=()=>{URL.revokeObjectURL(f),o(new Error("Imagem inválida."))},u.src=f}),Be=async g=>{if(!g.type.startsWith("image/"))return"Envie um arquivo de imagem.";try{const{width:h,height:o}=await wa(g);return h!==o?"A imagem precisa ser quadrada.":h>re||o>re?`A imagem deve ter no máximo ${re} x ${re}px.`:null}catch{return"Não foi possível ler a imagem."}},We=async(g,h)=>{const o=Na(h.name),u=`clinics/${g}/${crypto.randomUUID()}-${o}`,{error:f}=await l.storage.from(Me).upload(u,h,{upsert:!0});if(f)throw f;const{data:F}=l.storage.from(Me).getPublicUrl(u);return F.publicUrl},_e=g=>{const h=g.trim();if(!h)return"CL";const o=h.split(/\s+/).filter(Boolean);return o.length===1?o[0].slice(0,2).toUpperCase():`${o[0][0]||""}${o[o.length-1][0]||""}`.toUpperCase()},Ea=({initialTab:g="overview"})=>{const h=ba(),o=[{value:"/",label:"Dashboard"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/profile",label:"Meu perfil"},{value:"/assistant",label:"Assistente IA"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Configurações"},{value:"/settings?section=categorias",label:"Configurações • Categorias"},{value:"/settings?section=taxas",label:"Configurações • Taxas"},{value:"/settings?section=clientes",label:"Configurações • Clientes"},{value:"/settings?section=procedimentos",label:"Configurações • Procedimentos"},{value:"/settings?section=profissionais",label:"Configurações • Profissionais"},{value:"/settings?section=fornecedores",label:"Configurações • Fornecedores"},{value:"/settings?section=usuarios",label:"Configurações • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dashboard"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"}],u=r.useMemo(()=>Object.fromEntries(o.map(a=>[a.value,a.label])),[]),[f,F]=r.useState(g),[le,Ce]=r.useState(!0),[w,Je]=r.useState([]),[m,j]=r.useState({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),[ie,ne]=r.useState(null),[U,oe]=r.useState(null),[T,ce]=r.useState(null),[O,Ge]=r.useState([]),[Ve,Ke]=r.useState({}),[D,ke]=r.useState(null),[Qe,q]=r.useState(!1),[x,v]=r.useState({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),[de,M]=r.useState(null),[E,B]=r.useState(null),[W,J]=r.useState(null),[me,ue]=r.useState([]),[G,Se]=r.useState(""),[R,Xe]=r.useState("todas"),[Ue,k]=r.useState([]),[y,_]=r.useState({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}),[V,I]=r.useState(null),[Ze,z]=r.useState(!1),[b,p]=r.useState({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}),[K,xe]=r.useState([]),[Ee,He]=r.useState(""),[Ae,Ye]=r.useState("user"),[ge,Q]=r.useState([]),[X,Z]=r.useState(!1),[be,H]=r.useState(!1),[Pe,pe]=r.useState([]),[A,ea]=r.useState(!0),[C,Y]=r.useState({clinic_id:"",email:"",role:"user"}),[Le,Re]=r.useState(!1),[aa,sa]=r.useState(null),P=ya("/auth/callback"),he=r.useRef(null),fe=r.useRef(null),ve=r.useRef(null),ye=r.useRef(null),je=r.useRef(null),ta={overview:"/admin/dashboard",clinics:"/admin/clinics",users:"/admin/users"},$=async()=>{Ce(!0);try{const{data:a,error:s}=await l.from("clinics").select("*, bank_accounts (id), categories (id), clinic_users (id, ativo)").order("created_at",{ascending:!1});if(s)throw s;Je(a||[])}catch(a){console.error("Erro ao carregar clínicas:",a)}finally{Ce(!1)}},ra=async()=>{const{data:a,error:s}=await l.from("content_packages").select("*").order("created_at",{ascending:!1});s||Ge(a||[])},Ie=async()=>{const{data:a,error:s}=await l.from("clinic_packages").select("clinic_id, package_id");if(s)return;const t={};(a||[]).forEach(i=>{!i.clinic_id||!i.package_id||(t[i.clinic_id]||(t[i.clinic_id]=[]),t[i.clinic_id].push(i.package_id))}),Ke(t)},ze=async(a,s)=>{if(await l.from("clinic_packages").delete().eq("clinic_id",a),s){const t=[{clinic_id:a,package_id:s}];await l.from("clinic_packages").insert(t)}Ie()},$e=async(a,s)=>{if(!a.length)return;const{error:t}=await l.from("clinics").update({ativo:s}).in("id",a);if(t){alert("Erro ao atualizar clínicas: "+t.message);return}ue([]),$()},la=()=>{j({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),ne(null),oe(null),ce(null)},Ne=()=>{ke(null),v({name:"",responsavel_nome:"",documento:"",email_contato:"",telefone_contato:"",plano:"basico",paginas_liberadas:[],package_id:"",ativo:!0,logo_url:null}),M(null),B(null),J(null)},ia=async a=>{const s=await Be(a);if(s){ce(s),ne(null),oe(null);return}ce(null),ne(a),oe(URL.createObjectURL(a))},na=async a=>{const s=await Be(a);if(s){J(s),M(null),B(null);return}J(null),M(a),B(URL.createObjectURL(a))},oa=a=>{ke(a.id),v({name:a.name||"",responsavel_nome:a.responsavel_nome||"",documento:a.documento||"",email_contato:a.email_contato||"",telefone_contato:a.telefone_contato||"",plano:a.plano||"basico",paginas_liberadas:a.paginas_liberadas||[],package_id:(Ve[a.id]||[])[0]||"",ativo:a.ativo??!0,logo_url:a.logo_url||null}),M(null),B(null),J(null),q(!0)},ca=a=>{I(a.id),p({clinic_id:a.clinic_id||"",name:a.name||"",email:a.email||"",role:a.role||"user",ativo:a.ativo??!0,paginas_liberadas:a.paginas_liberadas||[]}),z(!0)},da=async a=>{if(a.preventDefault(),!!m.name.trim()){if(T&&ie){alert(T);return}Z(!0);try{const{package_id:s,...t}=m,i=O.find(N=>N.id===s),n={...t,plano:i?.name||m.plano||"basico"},c=n.email_contato?.trim().toLowerCase();if(c){const{data:N}=await l.from("clinic_users").select("id, clinic_id").eq("email",c).maybeSingle();if(N){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}}const{data:d,error:S}=await l.from("clinics").insert([{...n}]).select().single();if(S)throw S;if(d?.id&&ie)try{const N=await We(d.id,ie);await l.from("clinics").update({logo_url:N}).eq("id",d.id)}catch(N){alert(`Clínica criada, mas não foi possível enviar a imagem: ${N.message}`)}if(d?.id&&c){const{data:N}=await l.from("clinic_users").select("id").eq("clinic_id",d.id).eq("email",c).maybeSingle();if(!N){const{error:L}=await l.from("clinic_users").insert({clinic_id:d.id,email:c,name:m.responsavel_nome?.trim()||c.split("@")[0]||"Responsável",role:"owner",ativo:!0,paginas_liberadas:m.paginas_liberadas||[]});if(L)console.warn("Erro ao criar usuário da clínica:",L.message),alert(`Clínica criada, mas não foi possível criar o usuário automaticamente: ${L.message}`);else{const Fe=P?`${P}?redirectTo=${encodeURIComponent("/")}`:void 0,Te={shouldCreateUser:!0};Fe&&(Te.emailRedirectTo=Fe);const{error:Oe}=await l.auth.signInWithOtp({email:c,options:Te});Oe&&alert(`Usuário criado, mas não foi possível enviar o e-mail de acesso: ${Oe.message}`)}}}d?.id&&await ze(d.id,s||""),la(),$()}catch(s){alert("Erro ao salvar clínica: "+s.message)}finally{Z(!1)}}},ma=async a=>{if(a.preventDefault(),!!D&&x.name.trim()){if(W&&de){alert(W);return}Z(!0);try{const{package_id:s,...t}=x,i=O.find(S=>S.id===s),n={...t,plano:i?.name||x.plano||"basico"};let c=x.logo_url||null;de&&(c=await We(D,de));const{error:d}=await l.from("clinics").update({...n,logo_url:c}).eq("id",D);if(d)throw d;await ze(D,s||""),q(!1),Ne(),$()}catch(s){alert("Erro ao atualizar clínica: "+s.message)}finally{Z(!1)}}},ua=async()=>{H(!0);try{const a=y.email.trim().toLowerCase();if(!a){alert("Informe um e-mail válido.");return}const{data:s}=await l.from("clinic_users").select("id").eq("email",a).maybeSingle();if(s){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}const{error:t}=await l.from("clinic_users").insert([{...y,email:a}]);if(t)throw t;if(a){const n=P?`${P}?redirectTo=${encodeURIComponent("/")}`:void 0,c={shouldCreateUser:!0};n&&(c.emailRedirectTo=n);const{error:d}=await l.auth.signInWithOtp({email:a,options:c});d&&alert("Usuário criado, mas não foi possível enviar o email de acesso: "+d.message)}const{data:i}=await l.from("clinic_users").select("*").order("created_at",{ascending:!1});i&&k(i),_({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})}catch(a){alert("Erro ao salvar usuário: "+a.message)}finally{H(!1)}},xa=async a=>{if(a.preventDefault(),!!V){H(!0);try{const s=b.email.trim().toLowerCase();if(!s){alert("Informe um e-mail válido.");return}const{data:t}=await l.from("clinic_users").select("id").eq("email",s).maybeSingle();if(t&&t.id!==V){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}const{error:i}=await l.from("clinic_users").update({...b,email:s}).eq("id",V);if(i)throw i;const{data:n}=await l.from("clinic_users").select("*").order("created_at",{ascending:!1});n&&k(n),z(!1),I(null),p({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})}catch(s){alert("Erro ao atualizar usuário: "+s.message)}finally{H(!1)}}},ga=async a=>{const s=a.name||a.email||"este usuário";if(!confirm(`Excluir ${s}?`))return;const{error:t}=await l.from("clinic_users").delete().eq("id",a.id);if(t){alert("Erro ao excluir usuário: "+t.message);return}k(i=>i.filter(n=>n.id!==a.id)),xe(i=>i.filter(n=>n!==a.id)),V===a.id&&(z(!1),I(null),p({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]}))};r.useEffect(()=>{F(g)},[g]);const we=a=>{F(a),h(ta[a])};r.useEffect(()=>{$(),ra(),Ie(),l.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>{a&&k(a)}),l.from("clinic_invites").select("*").order("created_at",{ascending:!1}).then(({data:a,error:s})=>{if(s){console.warn("Convites indisponíveis (tabela ausente?):",s.message),ea(!1);return}pe(a||[])}),l.auth.getSession().then(({data:a})=>sa(a.session?.user.id||null))},[]),r.useEffect(()=>()=>{U?.startsWith("blob:")&&URL.revokeObjectURL(U)},[U]),r.useEffect(()=>()=>{E?.startsWith("blob:")&&URL.revokeObjectURL(E)},[E]);const ee=r.useMemo(()=>{const a=w.length,s=w.reduce((n,c)=>n+(c.clinic_users?.length||0),0),t=w.reduce((n,c)=>n+(c.clinic_users?.filter(d=>d.ativo!==!1).length||0),0),i=w.reduce((n,c)=>n+(c.bank_accounts?.length||0),0);return{totalClinics:a,totalUsers:s,totalUsersAtivos:t,totalAccounts:i}},[w]),ae=r.useMemo(()=>w.filter(a=>{const s=a.name?.toLowerCase().includes(G.toLowerCase()),t=R==="todas"||R==="ativas"&&a.ativo!==!1||R==="inativas"&&a.ativo===!1;return s&&t}),[w,G,R]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(pa,{size:22})," Administrador"]}),e.jsx("p",{className:"text-gray-500",children:"Visão geral de todos os clientes (multiusuário)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>we("overview"),className:`px-3 py-2 text-sm rounded-lg border ${f==="overview"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Visão geral"}),e.jsx("button",{onClick:()=>we("clinics"),className:`px-3 py-2 text-sm rounded-lg border ${f==="clinics"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Clínicas"}),e.jsx("button",{onClick:()=>we("users"),className:`px-3 py-2 text-sm rounded-lg border ${f==="users"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Usuários"}),e.jsxs("button",{onClick:$,className:"px-4 py-2 bg-white border border-gray-200 rounded-lg flex items-center gap-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(ja,{size:16})," Atualizar"]})]})]}),f==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-50 text-brand-600 flex items-center justify-center",children:e.jsx(De,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Clínicas"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:ee.totalClinics})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center",children:e.jsx(ha,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Usuários"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[ee.totalUsers," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",ee.totalUsersAtivos," ativos)"]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center",children:e.jsx(fa,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Contas Bancárias"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:ee.totalAccounts})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Clínicas"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Dados gerais de todos os clientes"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{type:"text",value:G,onChange:a=>Se(a.target.value),placeholder:"Buscar clínica por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("select",{value:R,onChange:a=>Xe(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"todas",children:"Todas"}),e.jsx("option",{value:"ativas",children:"Ativas"}),e.jsx("option",{value:"inativas",children:"Inativas"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Nome"}),e.jsx("th",{className:"px-6 py-3",children:"Criada em"}),e.jsx("th",{className:"px-6 py-3",children:"Plano"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Usuários"}),e.jsx("th",{className:"px-6 py-3",children:"Contas"}),e.jsx("th",{className:"px-6 py-3",children:"Categorias"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[le&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-6 text-center text-gray-400",children:"Carregando..."})}),!le&&ae.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-6 text-center text-gray-400",children:"Nenhuma clínica encontrada."})}),!le&&ae.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-800",children:a.name}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:qe(a.created_at)}),e.jsx("td",{className:"px-6 py-4 text-gray-600 capitalize",children:a.plano||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a.ativo===!1?"bg-gray-100 text-gray-600":"bg-emerald-50 text-emerald-700"}`,children:a.ativo===!1?"Inativa":"Ativa"})}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[a.clinic_users?.length||0,a.clinic_users&&a.clinic_users.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[" • ",a.clinic_users.filter(s=>s.ativo!==!1).length," ativos"]})]}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.bank_accounts?.length||0}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.categories?.length||0})]},a.id))]})]})})]})]}),f==="clinics"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(De,{size:18})," Clínicas"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestão completa das clínicas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$e(me,!0),className:"px-3 py-2 text-sm bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-100",children:"Ativar selecionadas"}),e.jsx("button",{onClick:()=>$e(me,!1),className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100",children:"Desativar selecionadas"})]})]}),e.jsxs("form",{onSubmit:da,className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Clínica"}),e.jsx("input",{value:m.name,onChange:a=>j(s=>({...s,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem da clínica"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:U||m.logo_url?e.jsx("img",{src:U||m.logo_url||"",alt:"Imagem da clínica",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:_e(m.name||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[U||m.logo_url?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async a=>{const s=a.target.files?.[0];s&&await ia(s),a.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),T&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:T})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsável"}),e.jsx("input",{value:m.responsavel_nome,onChange:a=>j(s=>({...s,responsavel_nome:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ/CPF"}),e.jsx("input",{value:m.documento,onChange:a=>j(s=>({...s,documento:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{value:m.email_contato,onChange:a=>j(s=>({...s,email_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:m.telefone_contato,onChange:a=>j(s=>({...s,telefone_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacote"}),e.jsxs("select",{value:m.package_id,onChange:a=>j(s=>({...s,package_id:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),O.map(a=>e.jsx("option",{value:a.id,children:a.name||"Sem nome"},a.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>j(a=>({...a,paginas_liberadas:o.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>j(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:he,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:o.map(a=>e.jsx("button",{type:"button",onClick:()=>{m.paginas_liberadas.includes(a.value)||(j(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),he.current&&he.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>j(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[u[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:a=>j(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativa"]}),e.jsxs("button",{type:"submit",disabled:X,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[X?e.jsx(se,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar"]})]})]}),e.jsx("input",{type:"text",value:G,onChange:a=>Se(a.target.value),placeholder:"Buscar clínica por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[ae.map(a=>{const s=me.includes(a.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:t=>{t.target.checked?ue(i=>[...i,a.id]):ue(i=>i.filter(n=>n!==a.id))}}),e.jsx("div",{className:"h-12 w-12 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:a.logo_url?e.jsx("img",{src:a.logo_url,alt:`Logo de ${a.name||"clínica"}`,className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:_e(a.name||"")})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:[a.name," ",!a.ativo&&e.jsx("span",{className:"text-xs text-red-600",children:"(inativa)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",a.id," • Plano: ",a.plano||"—"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Contato: ",a.responsavel_nome||"-"," • ",a.email_contato||"-"," • ",a.telefone_contato||"-"]}),a.paginas_liberadas&&a.paginas_liberadas.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Páginas: ",a.paginas_liberadas.map(t=>u[t]||t).join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>oa(a),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.ativo?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:a.ativo?"Ativa":"Inativa"})]})]},a.id)}),ae.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhuma clínica cadastrada."})]}),Qe&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-3xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar clínica"}),e.jsx("button",{type:"button",onClick:()=>{q(!1),Ne()},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:ma,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Clínica"}),e.jsx("input",{value:x.name,onChange:a=>v(s=>({...s,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem da clínica"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:E||x.logo_url?e.jsx("img",{src:E||x.logo_url||"",alt:"Imagem da clínica",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:_e(x.name||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[E||x.logo_url?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async a=>{const s=a.target.files?.[0];s&&await na(s),a.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),W&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:W})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsável"}),e.jsx("input",{value:x.responsavel_nome,onChange:a=>v(s=>({...s,responsavel_nome:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ/CPF"}),e.jsx("input",{value:x.documento,onChange:a=>v(s=>({...s,documento:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{value:x.email_contato,onChange:a=>v(s=>({...s,email_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:x.telefone_contato,onChange:a=>v(s=>({...s,telefone_contato:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacote"}),e.jsxs("select",{value:x.package_id,onChange:a=>v(s=>({...s,package_id:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),O.map(a=>e.jsx("option",{value:a.id,children:a.name||"Sem nome"},a.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>v(a=>({...a,paginas_liberadas:o.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>v(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:fe,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:o.map(a=>e.jsx("button",{type:"button",onClick:()=>{x.paginas_liberadas.includes(a.value)||(v(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),fe.current&&fe.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>v(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[u[a]||a," ✕"]},a))})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 w-full",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:x.ativo,onChange:a=>v(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativa"]}),e.jsx("button",{type:"button",onClick:()=>{q(!1),Ne()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:X,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[X?e.jsx(se,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar alterações"]})]})]})]})})]}),f==="users"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(va,{size:16})," Usuários da Clínica"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l.from("clinic_users").update({ativo:!0}).in("id",K).then(()=>l.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&k(a))),className:"px-3 py-2 text-sm bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-100",children:"Ativar"}),e.jsx("button",{onClick:()=>l.from("clinic_users").update({ativo:!1}).in("id",K).then(()=>l.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&k(a))),className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100",children:"Desativar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-4 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Convidar usuário"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Gere um convite por e-mail (role: owner/admin/user)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:C.email,onChange:a=>Y(s=>({...s,email:a.target.value})),placeholder:"email@dominio.com",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500"}),e.jsxs("select",{value:C.clinic_id,onChange:a=>Y(s=>({...s,clinic_id:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"Clínica..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs("select",{value:C.role,onChange:a=>Y(s=>({...s,role:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]}),e.jsx("button",{type:"button",disabled:Le||!A,onClick:async()=>{if(!A){alert("Convites indisponíveis: tabela clinic_invites não encontrada no Supabase.");return}if(!C.email||!C.clinic_id){alert("Informe e-mail e clínica");return}const a=C.email.trim().toLowerCase(),{data:s}=await l.from("clinic_users").select("id").eq("email",a).maybeSingle();if(s){alert("Já existe um usuário com este e-mail em outra clínica. Use um e-mail diferente.");return}Re(!0);try{const t=crypto.randomUUID(),i=new Date(Date.now()+10080*60*1e3).toISOString(),{error:n,data:c}=await l.from("clinic_invites").insert([{clinic_id:C.clinic_id,email:a,role:C.role,token:t,invited_by:aa,expires_at:i}]).select().single();if(n)throw n;const d=P?`${P}?redirectTo=${encodeURIComponent(`/accept-invite?token=${c.token}`)}`:void 0,S={shouldCreateUser:!0};d&&(S.emailRedirectTo=d);const{error:N}=await l.auth.signInWithOtp({email:a,options:S});alert(N?`Convite gerado, mas não foi possível enviar o email: ${N.message}. Link: /accept-invite?token=${c.token}`:`Convite enviado por email. Se necessário, use o link /accept-invite?token=${c.token}`);const{data:L}=await l.from("clinic_invites").select("*").order("created_at",{ascending:!1});L&&pe(L),Y({clinic_id:"",email:"",role:"user"})}catch(t){alert("Erro ao enviar convite: "+t.message)}finally{Re(!1)}},className:`px-4 py-2 rounded-lg text-sm ${A?"bg-brand-600 text-white hover:bg-brand-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:A?Le?"Enviando...":"Enviar convite":"Convites indisponíveis"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-white text-gray-500 border border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"E-mail"}),e.jsx("th",{className:"px-3 py-2",children:"Clínica"}),e.jsx("th",{className:"px-3 py-2",children:"Role"}),e.jsx("th",{className:"px-3 py-2",children:"Expira"}),e.jsx("th",{className:"px-3 py-2",children:"Token"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[A?Pe.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-800",children:a.email}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:a.clinic_id}),e.jsx("td",{className:"px-3 py-2 text-gray-600 capitalize",children:a.role}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:qe(a.expires_at)}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-500 break-all",children:a.token}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:async()=>{if(!confirm("Revogar convite?"))return;const{error:s}=await l.from("clinic_invites").delete().eq("id",a.id);if(s){alert(s.message);return}pe(t=>t.filter(i=>i.id!==a.id))},className:"text-sm text-red-600 hover:underline",children:"Revogar"})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-3 text-center text-gray-400",children:"Convites indisponíveis (tabela clinic_invites ausente)."})}),A&&Pe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-3 text-center text-gray-400",children:"Nenhum convite pendente."})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),e.jsxs("select",{value:y.clinic_id,onChange:a=>_({...y,clinic_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:y.name,onChange:a=>_({...y,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:y.email,onChange:a=>_({...y,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@dominio.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Papel/Acesso"}),e.jsxs("select",{value:y.role,onChange:a=>_({...y,role:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>_(a=>({...a,paginas_liberadas:o.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>_(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:ve,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:o.map(a=>e.jsx("button",{type:"button",onClick:()=>{y.paginas_liberadas.includes(a.value)||(_(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),ve.current&&ve.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>_(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[u[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:y.ativo,onChange:a=>_(s=>({...s,ativo:a.target.checked})),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Ativo"]}),e.jsxs("button",{type:"button",onClick:ua,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[be?e.jsx(se,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Adicionar"]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:Ee,onChange:a=>He(a.target.value),placeholder:"Buscar usuário por nome...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500 flex-1"}),e.jsx("button",{onClick:()=>{l.from("clinic_users").update({role:Ae,paginas_liberadas:ge}).in("id",K).then(()=>l.from("clinic_users").select("*").order("created_at",{ascending:!1}).then(({data:a})=>a&&k(a)))},className:"px-3 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700",children:"Aplicar papel/páginas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aplicar papel aos selecionados"}),e.jsxs("select",{value:Ae,onChange:a=>Ye(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas (aplicar aos selecionados)"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>Q(o.map(a=>a.value)),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>Q([]),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:je,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:o.map(a=>e.jsx("button",{type:"button",onClick:()=>{ge.includes(a.value)||(Q(s=>[...s,a.value]),je.current&&je.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ge.map(a=>e.jsxs("button",{type:"button",onClick:()=>Q(s=>s.filter(t=>t!==a)),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[u[a]||a," ✕"]},a))})]})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[Ue.filter(a=>a.name?.toLowerCase().includes(Ee.toLowerCase())).map(a=>{const s=K.includes(a.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:t=>{t.target.checked?xe(i=>[...i,a.id]):xe(i=>i.filter(n=>n!==a.id))}}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:[a.name," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",a.role||"user",")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.email," • Clínica: ",a.clinic_id]}),a.paginas_liberadas&&a.paginas_liberadas.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Páginas: ",a.paginas_liberadas.map(t=>u[t]||t).join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ca(a),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>ga(a),className:"text-sm text-red-600",children:"Excluir"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.ativo?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:a.ativo?"Ativo":"Inativo"})]})]},a.id)}),Ue.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum usuário cadastrado."})]}),Ze&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar usuário"}),e.jsx("button",{type:"button",onClick:()=>{z(!1),I(null),p({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:xa,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),e.jsxs("select",{value:b.clinic_id,onChange:a=>p({...b,clinic_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:b.name,onChange:a=>p({...b,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:b.email,onChange:a=>p({...b,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@dominio.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Papel/Acesso"}),e.jsxs("select",{value:b.role,onChange:a=>p({...b,role:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas liberadas"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>p(a=>({...a,paginas_liberadas:o.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>p(a=>({...a,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:ye,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:o.map(a=>e.jsx("button",{type:"button",onClick:()=>{b.paginas_liberadas.includes(a.value)||(p(s=>({...s,paginas_liberadas:[...s.paginas_liberadas,a.value]})),ye.current&&ye.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:a.label},a.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.paginas_liberadas.map(a=>e.jsxs("button",{type:"button",onClick:()=>p(s=>({...s,paginas_liberadas:s.paginas_liberadas.filter(t=>t!==a)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[u[a]||a," ✕"]},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"edit-user-active",type:"checkbox",checked:b.ativo,onChange:a=>p({...b,ativo:a.target.checked}),className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"edit-user-active",className:"text-sm text-gray-700",children:"Ativo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{z(!1),I(null),p({clinic_id:"",name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[]})},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:be,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[be?e.jsx(se,{size:16,className:"animate-spin"}):e.jsx(te,{size:16}),"Salvar alterações"]})]})]})]})})]})]})};export{Ea as default};
