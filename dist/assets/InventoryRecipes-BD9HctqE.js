import{u as C,r as t,j as e}from"./index-HcuLVkXM.js";import{S as I,v as S,a as R,w as D}from"./service-C61pE4fL.js";import{D as k}from"./DataTable-BxUe0ZZe.js";import{I as q}from"./ItemPicker-DiZaaD8I.js";import{P}from"./plus-DDz1DOCh.js";import{X as L}from"./x-Dm__mln4.js";const z=()=>{const{effectiveClinicId:h,user:m}=C(),a=h,[x,f]=t.useState([]),[g,j]=t.useState([]),[b,u]=t.useState(!0),[N,l]=t.useState(!1),[d,p]=t.useState(""),[r,c]=t.useState([{item_id:"",quantity:1}]),y=async()=>{if(a){u(!0);try{const[s,i]=await Promise.all([S(a),R(a)]);f(s),j(i)}finally{u(!1)}}};t.useEffect(()=>{y()},[a]);const v=()=>c([...r,{item_id:"",quantity:1}]),w=async()=>{!a||!m||!d.trim()||(await D({clinic_id:a,name:d,created_by:m.id},r.filter(s=>s.item_id)),l(!1),p(""),c([{item_id:"",quantity:1}]),await y())},_=t.useMemo(()=>[{header:"Receita",accessorKey:"name"},{header:"Itens",accessorKey:"procedure_recipe_lines",cell:({row:s})=>s.original.procedure_recipe_lines?.length||0},{header:"Criado em",accessorKey:"created_at",cell:({row:s})=>new Date(s.original.created_at).toLocaleDateString("pt-BR")}],[x]);return a?e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{title:"Receitas de Procedimento",subtitle:"Defina BOMs para automação futura de consumo.",actions:e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-emerald-600 px-4 py-2 text-sm text-white",onClick:()=>l(!0),children:[e.jsx(P,{className:"h-4 w-4"})," Nova receita"]})}),b?e.jsx("div",{className:"text-sm text-gray-500",children:"Carregando receitas..."}):e.jsx(k,{data:x,columns:_}),N?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Nova receita"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Associe itens e quantidades padrão."})]}),e.jsx("button",{className:"rounded-full p-2 hover:bg-gray-100",onClick:()=>l(!1),children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Nome"}),e.jsx("input",{className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm",value:d,onChange:s=>p(s.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[r.map((s,i)=>e.jsxs("div",{className:"grid gap-3 rounded-lg border border-gray-200 p-3 md:grid-cols-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Item"}),e.jsx(q,{items:g,value:s.item_id,onChange:o=>{const n=[...r];n[i].item_id=o,c(n)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm",value:s.quantity,onChange:o=>{const n=[...r];n[i].quantity=Number(o.target.value||0),c(n)}})]})]},i)),e.jsx("button",{className:"rounded-md border border-gray-200 px-3 py-2 text-xs",onClick:v,children:"Adicionar item"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"rounded-md border border-gray-200 px-4 py-2 text-sm",onClick:()=>l(!1),children:"Cancelar"}),e.jsx("button",{className:"rounded-md bg-emerald-600 px-4 py-2 text-sm text-white",onClick:w,children:"Salvar"})]})]})]})}):null]}):null};export{z as default};
