import{r as i,j as a,P as Z,s as l}from"./index-Bi_Yktdj.js";import{P as D}from"./plus-CW1JmJBD.js";import{X as ee}from"./x-CTfOJ2Wq.js";import{L as ae}from"./loader-2-wegoqaf-.js";const k=[{value:"/",label:"Dashboard"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/profile",label:"Meu perfil"},{value:"/assistant",label:"Assistente IA"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Configurações"},{value:"/settings?section=categorias",label:"Configurações • Categorias"},{value:"/settings?section=taxas",label:"Configurações • Taxas"},{value:"/settings?section=clientes",label:"Configurações • Clientes"},{value:"/settings?section=procedimentos",label:"Configurações • Procedimentos"},{value:"/settings?section=profissionais",label:"Configurações • Profissionais"},{value:"/settings?section=fornecedores",label:"Configurações • Fornecedores"},{value:"/settings?section=usuarios",label:"Configurações • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dashboard"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"}],C={name:"",description:"",pages:[],courseIds:[],trainingIds:[]},ie=()=>{const[x,q]=i.useState([]),[T,y]=i.useState({}),[w,L]=i.useState([]),[_,M]=i.useState([]),[O,R]=i.useState([]),[j,P]=i.useState(!0),[S,I]=i.useState(!1),[F,p]=i.useState(!1),[h,v]=i.useState(null),[d,c]=i.useState(C),[E,g]=i.useState(null),[u,B]=i.useState(""),[b,f]=i.useState(""),[A,z]=i.useState(!1),G=i.useMemo(()=>Object.fromEntries(k.map(e=>[e.value,e.label])),[]),N=async()=>{const{data:e,error:s}=await l.from("content_packages").select("*").order("created_at",{ascending:!1});if(s)throw s;q(e||[])},U=async e=>{if(!e.length){y({});return}const{data:s,error:r}=await l.from("content_package_items").select("package_id, content_items (id, type)").in("package_id",e);if(r)throw r;const t={};(s||[]).forEach(n=>{const o=n.package_id,m=n.content_items;!o||!m||(t[o]||(t[o]={courses:0,trainings:0}),m.type==="course"&&(t[o].courses+=1),m.type==="training"&&(t[o].trainings+=1))}),y(t)},X=async()=>{const{data:e,error:s}=await l.from("content_items").select("id, title, type, published").order("title",{ascending:!0});if(s)throw s;const r=e||[];L(r.filter(t=>t.type==="course")),M(r.filter(t=>t.type==="training"))},$=async()=>{const{data:e,error:s}=await l.from("clinics").select("id, name").order("name",{ascending:!0});if(s)throw s;R(e||[])},H=async e=>{if(!e){f("");return}const{data:s,error:r}=await l.from("clinic_packages").select("package_id").eq("clinic_id",e);if(r)throw r;const t=(s||[]).map(n=>n.package_id).filter(Boolean)[0]||"";f(t)},J=async()=>{P(!0),g(null);try{await Promise.all([N(),X(),$()])}catch(e){g(e.message||"Erro ao carregar pacotes.")}finally{P(!1)}};i.useEffect(()=>{J()},[]),i.useEffect(()=>{const e=x.map(s=>s.id).filter(Boolean);U(e).catch(()=>y({}))},[x]),i.useEffect(()=>{u&&H(u).catch(()=>f(""))},[u]);const K=()=>{v(null),c(C),p(!0)},Q=async e=>{v(e.id),c({name:e.name||"",description:e.description||"",pages:e.pages||[],courseIds:[],trainingIds:[]}),p(!0);try{const{data:s,error:r}=await l.from("content_package_items").select("content_items (id, type)").eq("package_id",e.id);if(r)throw r;const t=[],n=[];(s||[]).forEach(o=>{const m=o.content_items;m&&(m.type==="course"&&t.push(m.id),m.type==="training"&&n.push(m.id))}),c(o=>({...o,courseIds:t,trainingIds:n}))}catch(s){g(s.message||"Erro ao carregar itens do pacote.")}},V=async e=>{if(e.preventDefault(),!d.name.trim()){g("Informe o nome do pacote.");return}I(!0),g(null);try{const s={name:d.name.trim(),description:d.description.trim(),pages:d.pages};let r=h;if(h){const{error:t}=await l.from("content_packages").update(s).eq("id",h);if(t)throw t}else{const{data:t,error:n}=await l.from("content_packages").insert([s]).select().single();if(n)throw n;r=t?.id}if(r){await l.from("content_package_items").delete().eq("package_id",r);const t=Array.from(new Set([...d.courseIds,...d.trainingIds]));if(t.length){const n=t.map(m=>({package_id:r,content_id:m})),{error:o}=await l.from("content_package_items").insert(n);if(o)throw o}}p(!1),v(null),c(C),await N()}catch(s){g(s.message||"Erro ao salvar pacote.")}finally{I(!1)}},W=async e=>{if(!confirm(`Excluir o pacote "${e.name}"?`))return;const{error:s}=await l.from("content_packages").delete().eq("id",e.id);if(s){g(s.message);return}N()},Y=async()=>{if(u){z(!0);try{if(await l.from("clinic_packages").delete().eq("clinic_id",u),b){const{error:e}=await l.from("clinic_packages").insert([{clinic_id:u,package_id:b}]);if(e)throw e}alert("Pacotes atualizados para a clínica.")}catch(e){g(e.message||"Erro ao salvar pacotes da clínica.")}finally{z(!1)}}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Pacotes"}),a.jsx("p",{className:"text-gray-500",children:"Defina cursos, treinamentos e páginas para cada pacote."})]}),a.jsxs("button",{type:"button",onClick:K,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[a.jsx(D,{size:16}),"Adicionar pacote"]})]}),E&&a.jsx("div",{className:"bg-white border border-red-100 rounded-xl p-4 text-sm text-red-600",children:E}),a.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[a.jsx(Z,{size:16})," Atribuir pacotes à clínica"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),a.jsxs("select",{value:u,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[a.jsx("option",{value:"",children:"Selecione..."}),O.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacotes liberados"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 border border-gray-200 rounded-lg px-2 py-1",children:[a.jsx("input",{type:"radio",name:"clinicPackage",checked:!b,onChange:()=>f("")}),"Sem pacote"]}),x.map(e=>{const s=b===e.id;return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 border border-gray-200 rounded-lg px-2 py-1",children:[a.jsx("input",{type:"radio",name:"clinicPackage",checked:s,onChange:()=>f(e.id)}),e.name]},e.id)}),x.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum pacote cadastrado."})]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"button",disabled:!u||A,onClick:Y,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50",children:A?"Salvando...":"Salvar pacotes"})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[j&&a.jsx("div",{className:"text-sm text-gray-400",children:"Carregando pacotes..."}),!j&&x.length===0&&a.jsx("div",{className:"text-sm text-gray-400",children:"Nenhum pacote cadastrado."}),!j&&x.map(e=>{const s=T[e.id]||{courses:0,trainings:0};return a.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-5 space-y-3",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e.name}),e.description&&a.jsx("p",{className:"text-sm text-gray-500",children:e.description})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>Q(e),className:"text-sm text-brand-600",children:"Editar"}),a.jsx("button",{onClick:()=>W(e),className:"text-sm text-red-600",children:"Excluir"})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-600",children:[a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Cursos: ",s.courses]}),a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Treinamentos: ",s.trainings]}),a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Páginas: ",e.pages?.length||0]})]}),e.pages?.length>0&&a.jsx("p",{className:"text-xs text-gray-500",children:e.pages.map(r=>G[r]||r).join(", ")})]},e.id)})]}),F&&a.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:h?"Editar pacote":"Novo pacote"}),a.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-gray-700",children:a.jsx(ee,{size:18})})]}),a.jsxs("form",{onSubmit:V,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),a.jsx("input",{value:d.name,onChange:e=>c(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),a.jsx("textarea",{value:d.description,onChange:e=>c(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",rows:3})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cursos inclusos"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:[w.map(e=>{const s=d.courseIds.includes(e.id);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?c(t=>({...t,courseIds:[...t.courseIds,e.id]})):c(t=>({...t,courseIds:t.courseIds.filter(n=>n!==e.id)}))}}),e.title||"Sem título"]},e.id)}),w.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum curso cadastrado."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Treinamentos inclusos"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:[_.map(e=>{const s=d.trainingIds.includes(e.id);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?c(t=>({...t,trainingIds:[...t.trainingIds,e.id]})):c(t=>({...t,trainingIds:t.trainingIds.filter(n=>n!==e.id)}))}}),e.title||"Sem título"]},e.id)}),_.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum treinamento cadastrado."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas inclusas"}),a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("button",{type:"button",onClick:()=>c(e=>({...e,pages:k.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),a.jsx("button",{type:"button",onClick:()=>c(e=>({...e,pages:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:k.map(e=>{const s=d.pages.includes(e.value);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?c(t=>({...t,pages:[...t.pages,e.value]})):c(t=>({...t,pages:t.pages.filter(n=>n!==e.value)}))}}),e.label]},e.value)})})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),a.jsxs("button",{type:"submit",disabled:S,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[S?a.jsx(ae,{size:16,className:"animate-spin"}):a.jsx(D,{size:16}),h?"Salvar":"Adicionar"]})]})]})]})})]})};export{ie as default};
