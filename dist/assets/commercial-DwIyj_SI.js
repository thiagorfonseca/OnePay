import{s as u}from"./index-Bi_Yktdj.js";async function l(m){const{clinicId:n,from:o,to:e}=m;let t=u.from("revenues").select("*").order("data_competencia",{ascending:!0});n&&(t=t.eq("clinic_id",n)),o&&(t=t.gte("data_competencia",o)),e&&(t=t.lte("data_competencia",e));const{data:r}=await t,{data:s}=await u.from("revenue_procedures").select("*"),c=n?(s||[]).filter(i=>i.clinic_id===n):s||[],{data:d}=await u.from("customers").select("*"),a=n?(d||[]).filter(i=>i.clinic_id===n):d||[];return{revenues:r||[],revenueProcedures:c,customers:a}}function p(m){const n={};return m.revenues.forEach(o=>{const e=(o.paciente||"Sem nome").trim()||"Sem nome";n[e]||(n[e]={faturamento:0,atendimentos:0,procedimentos:new Set,categorias:new Set,procedimentosCount:0,datas:new Set});const t=n[e],r=Number(o.valor_liquido??o.valor??0);t.faturamento+=isFinite(r)?r:0,t.atendimentos+=1,o.data_competencia&&t.datas.add(o.data_competencia),m.revenueProcedures.filter(c=>c.revenue_id===o.id).forEach(c=>{c.procedimento&&t.procedimentos.add(c.procedimento),c.categoria&&t.categorias.add(c.categoria),t.procedimentosCount+=c.quantidade||0})}),Object.entries(n).map(([o,e])=>{const t=e.atendimentos?e.faturamento/e.atendimentos:0,r=e.datas.size;return{name:o,faturamento:e.faturamento,atendimentos:e.atendimentos,ticket:t,recorrencia:r,procedimentosCount:e.procedimentosCount,procedimentos:Array.from(e.procedimentos),categorias:Array.from(e.categorias)}})}function _(m,n,o){const e={};m.revenues.forEach(a=>{if(!a.data_competencia||n&&a.data_competencia<n||o&&a.data_competencia>o)return;const i=(a.paciente||"Sem nome").trim()||"Sem nome";e[i]||(e[i]=new Set),e[i].add(a.data_competencia)});const t=Object.entries(e).map(([a,i])=>({name:a,atendimentos:i.size,dates:Array.from(i).sort(),status:i.size>1?"Recorrente":"NÃ£o recorrente"})),r=t.length,s=t.filter(a=>a.atendimentos>1).length,c=r-s,d=r?s/r*100:0;return{rows:t,total:r,recorrentes:s,naoRecorrentes:c,percentual:d}}export{_ as a,p as b,l as f};
