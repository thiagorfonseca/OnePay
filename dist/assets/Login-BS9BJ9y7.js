import{r as d,b as E,j as e,W as k,s as i}from"./index-V1BrPv90.js";const S=()=>{const[r,p]=d.useState(""),[c,b]=d.useState(""),[l,t]=d.useState(!1),[u,s]=d.useState(null),[o,x]=d.useState(!1),y=E(),m=`${window.location.origin}/auth/callback`,w=async a=>{a.preventDefault(),t(!0),s(null);try{if(o){const{error:n,data:h}=await i.auth.signUp({email:r,password:c,options:{emailRedirectTo:m}});if(n)throw n;if(h.user){const{data:g,error:f}=await i.from("clinics").insert([{name:"Minha Clínica"}]).select().single();f?console.error(f):g&&await i.from("profiles").insert([{id:h.user.id,clinic_id:g.id,full_name:r.split("@")[0],role:"admin"}])}alert("Cadastro realizado! Verifique seu email ou faça login."),x(!1)}else{const{error:n}=await i.auth.signInWithPassword({email:r,password:c});if(n)throw n;y("/")}}catch(n){s(n.message)}finally{t(!1)}},j=async()=>{try{t(!0),s(null);const{error:a}=await i.auth.signInWithOAuth({provider:"google",options:{redirectTo:m,queryParams:{prompt:"consent"}}});a&&s("Erro ao entrar com Google: "+a.message)}catch(a){s(a?.message||"Erro inesperado ao entrar com Google.")}finally{t(!1)}},v=async()=>{try{t(!0),s(null);const{error:a}=await i.auth.signInWithOtp({email:r,options:{emailRedirectTo:m,shouldCreateUser:!0}});a?s("Erro ao enviar magic link: "+a.message):alert("Enviamos um link de acesso para o seu email.")}catch(a){s(a?.message||"Erro inesperado ao enviar magic link.")}finally{t(!1)}},N=async()=>{t(!0),s(null);const{error:a}=await i.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/auth/reset`});t(!1),a?s("Erro ao enviar reset de senha: "+a.message):alert("Enviamos um email para redefinir sua senha.")};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center text-brand-600",children:e.jsx("div",{className:"w-12 h-12 bg-brand-500 rounded-lg flex items-center justify-center text-white",children:e.jsx(k,{size:32})})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"OnePay"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:o?"Crie sua conta e da sua clínica":"Faça login para acessar o sistema"})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[e.jsxs("form",{className:"space-y-6",onSubmit:w,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:r,onChange:a=>p(a.target.value),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-brand-500 focus:border-brand-500 sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Senha"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:c,onChange:a=>b(a.target.value),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-brand-500 focus:border-brand-500 sm:text-sm"})})]}),u&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:u}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:l,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50",children:l?"Processando...":o?"Criar Conta":"Entrar"})})]}),!o&&e.jsxs("div",{className:"mt-4 grid gap-2",children:[e.jsx("button",{type:"button",onClick:j,className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",disabled:l,children:"Entrar com Google"}),e.jsx("button",{type:"button",onClick:v,className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",disabled:l||!r,children:"Enviar Magic Link"}),e.jsx("button",{type:"button",onClick:N,className:"text-sm text-blue-600 hover:underline",disabled:l||!r,children:"Esqueci minha senha"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:o?"Já tem uma conta?":"Novo por aqui?"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>x(!o),className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",children:o?"Voltar para Login":"Criar nova conta"})})]})]})})]})};export{S as default};
