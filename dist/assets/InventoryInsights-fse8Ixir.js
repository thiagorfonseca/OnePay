import{u as y,r as a,j as e}from"./index-HcuLVkXM.js";import{S as j,t as b}from"./service-C61pE4fL.js";const w=()=>{const{effectiveClinicId:d,session:n}=y(),t=d,[i,m]=a.useState([]),[x,o]=a.useState(!0),[r,u]=a.useState(""),[c,h]=a.useState(null),l=async()=>{if(t){o(!0);try{const s=await b(t);m(s)}finally{o(!1)}}};a.useEffect(()=>{l()},[t]);const p=async()=>{!t||!n||(await fetch("https://kevzqjffwbcjxvoebfll.supabase.co/functions/v1/inventory-insights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({clinic_id:t})}),await l())},g=async()=>{if(!t||!n||!r.trim())return;const f=await(await fetch("https://kevzqjffwbcjxvoebfll.supabase.co/functions/v1/inventory-assistant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({clinic_id:t,question:r})})).json();h(f?.answer||"Sem resposta no momento.")};return t?e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{title:"IA & Insights",subtitle:"Análises automáticas e recomendações para compras inteligentes.",actions:e.jsx("button",{className:"rounded-md border border-gray-200 px-4 py-2 text-sm",onClick:p,children:"Gerar insight"})}),e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Pergunte ao estoque"}),e.jsxs("div",{className:"mt-3 flex flex-col gap-3 md:flex-row",children:[e.jsx("input",{className:"flex-1 rounded-md border border-gray-200 px-3 py-2 text-sm",placeholder:"Ex: o que recomprar esta semana?",value:r,onChange:s=>u(s.target.value)}),e.jsx("button",{className:"rounded-md bg-emerald-600 px-4 py-2 text-sm text-white",onClick:g,children:"Perguntar"})]}),c?e.jsx("p",{className:"mt-3 text-sm text-gray-700",children:c}):null]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Insights recentes"}),x?e.jsx("div",{className:"text-sm text-gray-500",children:"Carregando insights..."}):i.length?i.map(s=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.title||"Resumo semanal"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"—"})]})}),e.jsx("p",{className:"mt-3 text-sm text-gray-700 whitespace-pre-line",children:s.summary})]},s.id)):e.jsx("div",{className:"text-sm text-gray-500",children:"Nenhum insight gerado."})]})]}):null};export{w as default};
