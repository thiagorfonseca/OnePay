import{r,a as ls,u as os,j as e,T as cs,C as ds,U as zt,d as ms,s as d,e as us}from"./index-V1BrPv90.js";import{D as oe}from"./download-Cw_fITMr.js";import{U as nt}from"./upload-Dux9Vz-Z.js";import{L as ne}from"./loader-2-Bvn7HOnG.js";import{P as Y}from"./plus-DeuT8SVf.js";import{T as Ft}from"./trash-2-B-KDvqta.js";const xs=m=>{const y=(m.match(/,/g)||[]).length;return(m.match(/;/g)||[]).length>y?";":","},ps=(m,y)=>{const w=[];let S="",k=!1;for(let B=0;B<m.length;B++){const W=m[B];if(W==='"'){k=!k;continue}W===y&&!k?(w.push(S),S=""):S+=W}return w.push(S),w.map(B=>B.trim())},fa=m=>{const w=m.replace(/^\uFEFF/,"").split(/\r?\n/).filter(W=>W.trim().length>0);if(!w.length)throw new Error("Arquivo vazio");const S=xs(w[0]),k=W=>ps(W,S),B=k(w[0]).map(W=>W.toLowerCase());return{lines:w,header:B,parseLine:k}},ha=m=>{const y=m.trim().toLowerCase();return y?["c","create","criar","novo","adicionar","inserir"].includes(y)?"create":["u","update","atualizar","editar","edit"].includes(y)?"update":["d","delete","apagar","remover","excluir"].includes(y)?"delete":null:null},gs=m=>{const y=m.trim().toLowerCase();return y?["receita","receitas","r","income"].includes(y)?"receita":["despesa","despesas","d","expense"].includes(y)?"despesa":null:null},ba="user-avatars",it=350,fs=m=>m.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,hs=m=>new Promise((y,w)=>{const S=new Image,k=URL.createObjectURL(m);S.onload=()=>{URL.revokeObjectURL(k),y({width:S.width,height:S.height})},S.onerror=()=>{URL.revokeObjectURL(k),w(new Error("Imagem inválida."))},S.src=k}),ya=async m=>{if(!m.type.startsWith("image/"))return"Envie um arquivo de imagem.";try{const{width:y,height:w}=await hs(m);return y!==w?"A imagem precisa ser quadrada.":y>it||w>it?`A imagem deve ter no máximo ${it} x ${it}px.`:null}catch{return"Não foi possível ler a imagem."}},ja=async(m,y)=>{const w=fs(y.name),S=`clinics/${m}/${crypto.randomUUID()}-${w}`,{error:k}=await d.storage.from(ba).upload(S,y,{upsert:!0});if(k)throw k;const{data:B}=d.storage.from(ba).getPublicUrl(S);return B.publicUrl},va=(m,y)=>{const w=m.trim();if(w){const k=w.split(/\s+/).filter(Boolean);return k.length===1?k[0].slice(0,2).toUpperCase():`${k[0][0]||""}${k[k.length-1][0]||""}`.toUpperCase()}const S=y.trim();return S?S.slice(0,2).toUpperCase():"US"},Cs=()=>{const[m,y]=r.useState("categorias"),[w,S]=ls(),[k,B]=r.useState(!0),[W,Na]=r.useState([]),[J,Lt]=r.useState("receita"),[Rt,qt]=r.useState(!1),{effectiveClinicId:l,isAdmin:wa,clinic:$t,role:Ca}=os(),ze=[{value:"/",label:"Dashboard"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/assistant",label:"Assistente IA"},{value:"/profile",label:"Meu perfil"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Configurações"},{value:"/settings?section=categorias",label:"Configurações • Categorias"},{value:"/settings?section=taxas",label:"Configurações • Taxas"},{value:"/settings?section=clientes",label:"Configurações • Clientes"},{value:"/settings?section=procedimentos",label:"Configurações • Procedimentos"},{value:"/settings?section=profissionais",label:"Configurações • Profissionais"},{value:"/settings?section=fornecedores",label:"Configurações • Fornecedores"},{value:"/settings?section=usuarios",label:"Configurações • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dashboard"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"}],lt=r.useMemo(()=>Object.fromEntries(ze.map(t=>[t.value,t.label])),[]),[ye,Fe]=r.useState(""),[Dt,Tt]=r.useState(!1),[Le,ot]=r.useState(null),[Mt,_a]=r.useState([]),[F,ce]=r.useState({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"}),[Vt,Ot]=r.useState(!1),[Re,ct]=r.useState(null),[Bt,Sa]=r.useState([]),[K,je]=r.useState({name:"",cpf:"",cep:""}),[qe,D]=r.useState(null),[$e,De]=r.useState(!1),[Te,ve]=r.useState(null),[Qt,Gt]=r.useState(!1),[Me,Wt]=r.useState(null),[Ve,ka]=r.useState(""),[dt,Oe]=r.useState(1),[pe,ge]=r.useState([]),[Ea,Be]=r.useState(!1),[X,Ne]=r.useState({name:"",cpf:"",cep:""}),mt=10,[Qe,Ua]=r.useState([]),[P,ie]=r.useState({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),[Ge,we]=r.useState(null),[Jt,Kt]=r.useState(!1),[Xt,Zt]=r.useState(!1),[Pa,Ce]=r.useState(!1),[fe,_e]=r.useState([]),[Ht,Aa]=r.useState(""),[Yt,Ia]=r.useState([]),[ee,We]=r.useState({nome:"",tipo:"venda"}),[ut,ea]=r.useState(null),[ta,aa]=r.useState(!1),[xt,za]=r.useState([]),[T,Se]=r.useState({nome:"",cnpj:"",telefone:""}),[pt,sa]=r.useState(null),[ra,na]=r.useState(!1),[ia,la]=r.useState(!1),[gt,oa]=r.useState([]),[A,te]=r.useState({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),[ft,ca]=r.useState(null),[Je,le]=r.useState(!1),[da,ae]=r.useState(null),[ht,Fa]=r.useState(""),[bt,ma]=r.useState(!1),[yt,jt]=r.useState(null),[Ke,vt]=r.useState(null),[Xe,Nt]=r.useState(null),[La,ke]=r.useState(!1),[U,Z]=r.useState({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),[ua,H]=r.useState(null),[wt,Ze]=r.useState(null),[He,Ye]=r.useState(null),[et,tt]=r.useState(null),Ct=r.useRef(null),_t=r.useRef(null),se=t=>t.replace(/\D/g,""),Ee=r.useMemo(()=>($t?.paginas_liberadas||[]).map(t=>t.trim()).filter(Boolean),[$t?.paginas_liberadas]),Q=r.useMemo(()=>{if(!Ee.length)return ze;const t=Ee.includes("/settings");return ze.filter(a=>a.value==="/settings?section=usuarios"&&t||Ee.includes(a.value))},[Ee,ze]),xa=r.useMemo(()=>new Set(Q.map(t=>t.value)),[Q]),he=Ca==="owner",pa=typeof window<"u"?`${window.location.origin}/auth/reset`:"";r.useEffect(()=>()=>{Ke?.startsWith("blob:")&&URL.revokeObjectURL(Ke)},[Ke]),r.useEffect(()=>()=>{He?.startsWith("blob:")&&URL.revokeObjectURL(He)},[He]);const St=t=>{const a=se(t);if(a.length!==11||/^(\d)\1+$/.test(a))return!1;const s=n=>{let g=0;for(let v=0;v<n;v++)g+=parseInt(a[v],10)*(n+1-v);const b=g*10%11;return b===10?0:b};return s(9)===parseInt(a[9],10)&&s(10)===parseInt(a[10],10)},at=async()=>{try{B(!0);let t=d.from("categories").select("*").order("name");l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;if(s)throw s;Na(a||[])}catch(t){console.error(t)}finally{B(!1)}},kt=async()=>{let t=d.from("card_fees").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&_a(a)},be=async()=>{let t=d.from("customers").select("*").order("name",{ascending:!0});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Sa(a)},Ue=async()=>{let t=d.from("procedures").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Ua(a)},Et=async()=>{let t=d.from("professionals").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&Ia(a)},st=async()=>{let t=d.from("suppliers").select("*").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:a,error:s}=await t;!s&&a&&za(a)},Pe=async()=>{if(!l){oa([]);return}ma(!0);const{data:t,error:a}=await d.from("clinic_users").select("*").eq("clinic_id",l).order("created_at",{ascending:!1});!a&&t&&oa(t),ma(!1)};r.useEffect(()=>{const t=w.get("section");t&&["categorias","taxas","clientes","procedimentos","profissionais","fornecedores","usuarios"].includes(t)&&y(t)},[w]),r.useEffect(()=>{m==="usuarios"&&he&&Pe()},[l,m,he]);const de=t=>{y(t);const a=new URLSearchParams(w);a.set("section",t),S(a,{replace:!0})},Ra=async t=>{if(!l){alert("Nenhuma clínica ativa encontrada para associar os clientes.");return}Gt(!0),Wt(null);try{const s=(await t.text()).replace(/^\uFEFF/,"").split(/\r?\n/).filter(o=>o.trim().length>0);if(!s.length)throw new Error("Arquivo vazio.");const n=s[0],g=(n.match(/,/g)||[]).length,v=(n.match(/;/g)||[]).length>g?";":",",f=o=>{const i=[];let c="",p=!1;for(let N=0;N<o.length;N++){const q=o[N];if(q==='"'){p=!p;continue}q===v&&!p?(i.push(c),c=""):c+=q}return i.push(c),i.map(N=>N.trim())},x=f(n).map(o=>o.toLowerCase()),j=x.some(o=>o.includes("cpf")||o.includes("nome")),z=j?s.slice(1):s,M=o=>{const i=x.findIndex(c=>o.some(p=>c.includes(p)));return i>=0?i:-1},V=j?M(["nome"]):-1,ue=j?M(["cpf"]):-1,xe=j?M(["cep"]):-1,G=new Set,R=[],L=[],E=(o,i,c)=>{const p=i>=0?i:c;return o[p]??""};z.forEach(o=>{const i=f(o),c=(!j&&i.length>=3,0),p=E(i,V,c+0),N=E(i,ue,c+1),q=E(i,xe,c+2),I=se(N),_=se(q);if(!p.trim()){R.push({name:p,cpf:N,cep:_,reason:"Nome obrigatório"});return}if(I){if(!St(I)){R.push({name:p,cpf:N,cep:_,reason:"CPF inválido"});return}if(G.has(I)){R.push({name:p,cpf:N,cep:_,reason:"CPF duplicado no arquivo"});return}G.add(I)}L.push({name:p.trim(),cpf:I||null,cep:_||null})});const{data:h}=await d.from("customers").select("cpf").eq("clinic_id",l),C=new Set((h||[]).map(o=>se(o.cpf||"")).filter(Boolean)),u=L.filter(o=>o.cpf&&C.has(o.cpf)?(R.push({name:o.name,cpf:o.cpf,cep:o.cep||"",reason:"CPF já existe na clínica"}),!1):!0);if(u.length){const o=u.map(c=>({name:c.name,cpf:c.cpf,cep:c.cep||null,clinic_id:l})),{error:i}=await d.from("customers").insert(o);if(i)throw i}Wt({imported:u.length,rejected:R}),be()}catch(a){alert("Erro ao importar clientes: "+a.message)}finally{Gt(!1)}};r.useEffect(()=>{l&&(at(),kt(),be(),Ue(),Et(),st())},[l]);const qa=async t=>{if(t.preventDefault(),!l){alert("Nenhuma clínica ativa definida.");return}if(ye.trim()){Tt(!0);try{if(Le){const{error:a}=await d.from("categories").update({name:ye}).eq("id",Le);if(a)throw a}else{const{error:a}=await d.from("categories").insert([{name:ye,tipo:J,cor_opcional:J==="receita"?"#0ea5e9":"#ef4444",clinic_id:l}]);if(a)throw a}Fe(""),ot(null),at()}catch(a){alert("Erro ao criar: "+a.message)}finally{Tt(!1)}}},$a=async t=>{if(confirm("Excluir categoria?"))try{const{error:a}=await d.from("categories").delete().eq("id",t);if(a)throw a;Le===t&&(ot(null),Fe("")),at()}catch(a){alert("Erro: "+a.message)}},Da=async t=>{if(!l){alert("Nenhuma clínica ativa definida.");return}qt(!0);try{const a=await t.text(),{lines:s,header:n,parseLine:g}=fa(a),b=n.some(u=>["acao","ação","action","nome","categoria","tipo","id"].some(o=>u.includes(o))),v=b?s.slice(1):s,f=u=>{const o=n.findIndex(i=>u.some(c=>i.includes(c)));return o>=0?o:-1},x=b?f(["acao","ação","action"]):-1,j=b?f(["id"]):-1,z=b?f(["nome","categoria"]):-1,M=b?f(["tipo"]):-1,V=z>=0?z:x>=0||j>=0?2:0,ue=M>=0?M:x>=0||j>=0?3:1,xe=j>=0?j:x>=0?1:-1,G=[],R=[],L=[],E=[],h=(u,o,i)=>{const c=o>=0?o:i;return(u[c]??"").trim()};v.forEach((u,o)=>{const i=g(u);if(i.every($=>!$.trim()))return;const c=x>=0?h(i,x,0):"",p=h(i,j,xe),N=h(i,z,V),q=h(i,M,ue);let I=c?ha(c):null;if(c&&!I){E.push({line:o+1,reason:"Ação inválida"});return}if(I||(I=p?"update":"create"),I==="delete"){if(!p){E.push({line:o+1,reason:"ID obrigatório para apagar"});return}L.push(p);return}const _=gs(q);if(I==="create"){if(!N){E.push({line:o+1,reason:"Nome obrigatório"});return}const $=_||J;G.push({name:N,tipo:$,cor_opcional:$==="receita"?"#0ea5e9":"#ef4444",clinic_id:l});return}if(!p){E.push({line:o+1,reason:"ID obrigatório para atualizar"});return}const O={};if(N&&(O.name=N),_&&(O.tipo=_,O.cor_opcional=_==="receita"?"#0ea5e9":"#ef4444"),!Object.keys(O).length){E.push({line:o+1,reason:"Nada para atualizar"});return}R.push({id:p,payload:O})});const C=G.length+R.length+L.length;if(!C&&E.length===0){alert("Nenhuma linha válida encontrada no CSV.");return}if(G.length){const{error:u}=await d.from("categories").insert(G);if(u)throw u}if(R.length){const o=(await Promise.all(R.map(i=>d.from("categories").update(i.payload).eq("id",i.id).eq("clinic_id",l)))).find(i=>i.error);if(o?.error)throw o.error}if(L.length){const{error:u}=await d.from("categories").delete().in("id",L).eq("clinic_id",l);if(u)throw u}if(at(),C||E.length){const u=[`Criadas: ${G.length}`,`Atualizadas: ${R.length}`,`Apagadas: ${L.length}`,`Rejeitadas: ${E.length}`].join(" • ");alert(`Importação de categorias concluída. ${u}`)}}catch(a){alert("Erro ao importar categorias: "+a.message)}finally{qt(!1)}},Ta=async t=>{if(!l){alert("Nenhuma clínica ativa definida.");return}la(!0);try{const a=await t.text(),{lines:s,header:n,parseLine:g}=fa(a),b=n.some(i=>["acao","ação","action","nome","cnpj","documento","telefone","id"].some(c=>i.includes(c))),v=b?s.slice(1):s,f=i=>{const c=n.findIndex(p=>i.some(N=>p.includes(N)));return c>=0?c:-1},x=b?f(["acao","ação","action"]):-1,j=b?f(["id"]):-1,z=b?f(["nome"]):-1,M=b?f(["cnpj","documento","doc"]):-1,V=b?f(["telefone","fone","celular"]):-1,ue=z>=0?z:x>=0||j>=0?2:0,xe=M>=0?M:x>=0||j>=0?3:1,G=V>=0?V:x>=0||j>=0?4:2,R=j>=0?j:x>=0?1:-1,L=[],E=[],h=[],C=[],u=(i,c,p)=>{const N=c>=0?c:p;return(i[N]??"").trim()};v.forEach((i,c)=>{const p=g(i);if(p.every(is=>!is.trim()))return;const N=x>=0?u(p,x,0):"",q=u(p,j,R),I=u(p,z,ue),_=u(p,M,xe),O=u(p,V,G);let $=N?ha(N):null;if(N&&!$){C.push({line:c+1,reason:"Ação inválida"});return}if($||($=q?"update":"create"),$==="delete"){if(!q){C.push({line:c+1,reason:"ID obrigatório para apagar"});return}h.push(q);return}const ga=_?se(_)||_:"";if($==="create"){if(!I){C.push({line:c+1,reason:"Nome obrigatório"});return}L.push({nome:I,cnpj:ga||null,telefone:O||null,clinic_id:l});return}if(!q){C.push({line:c+1,reason:"ID obrigatório para atualizar"});return}const Ie={};if(I&&(Ie.nome=I),_&&(Ie.cnpj=ga||null),O&&(Ie.telefone=O||null),!Object.keys(Ie).length){C.push({line:c+1,reason:"Nada para atualizar"});return}E.push({id:q,payload:Ie})});const o=L.length+E.length+h.length;if(!o&&C.length===0){alert("Nenhuma linha válida encontrada no CSV.");return}if(L.length){const{error:i}=await d.from("suppliers").insert(L);if(i)throw i}if(E.length){const c=(await Promise.all(E.map(p=>d.from("suppliers").update(p.payload).eq("id",p.id).eq("clinic_id",l)))).find(p=>p.error);if(c?.error)throw c.error}if(h.length){const{error:i}=await d.from("suppliers").delete().in("id",h).eq("clinic_id",l);if(i)throw i}if(st(),o||C.length){const i=[`Criados: ${L.length}`,`Atualizados: ${E.length}`,`Apagados: ${h.length}`,`Rejeitados: ${C.length}`].join(" • ");alert(`Importação de fornecedores concluída. ${i}`)}}catch(a){alert("Erro ao importar fornecedores: "+a.message)}finally{la(!1)}},Ma=async t=>{if(t.preventDefault(),!l){alert("Nenhuma clínica ativa definida.");return}if(!F.bandeira.trim())return;const a=parseInt(F.min_installments||"1",10)||1,s=parseInt(F.max_installments||"1",10)||1;if(a>s){alert("Intervalo de parcelas inválido (mínimo maior que máximo).");return}Ot(!0);try{const n=parseFloat(F.taxa_percent.replace(",","."))||0;if(Re){const{error:g}=await d.from("card_fees").update({bandeira:F.bandeira,taxa_percent:n,metodo:F.metodo,min_installments:a,max_installments:s,clinic_id:l}).eq("id",Re);if(g)throw g}else{const{error:g}=await d.from("card_fees").insert([{bandeira:F.bandeira,taxa_percent:n,metodo:F.metodo,min_installments:a,max_installments:s,clinic_id:l}]);if(g)throw g}ce({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"}),ct(null),kt()}catch(n){alert("Erro ao salvar taxa: "+n.message)}finally{Ot(!1)}},Va=async t=>{if(!confirm("Excluir taxa?"))return;const{error:a}=await d.from("card_fees").delete().eq("id",t);a||(Re===t&&(ct(null),ce({bandeira:"",taxa_percent:"0",metodo:"Cartão de Crédito",min_installments:"1",max_installments:"1"})),kt())},Oa=async t=>{if(t.preventDefault(),D(null),!l){D("Nenhuma clínica ativa encontrada.");return}if(!K.name.trim())return;const a=se(K.cpf),s=se(K.cep);if(a&&!St(a)){D("CPF inválido.");return}if(s&&s.length!==8){D("CEP inválido (use 8 dígitos).");return}if(a){const{data:n}=await d.from("customers").select("id").eq("cpf",a).eq("clinic_id",l).maybeSingle();if(n){D("CPF já cadastrado.");return}}De(!0);try{const{error:n}=await d.from("customers").insert([{name:K.name,cpf:a||null,cep:s||null,clinic_id:l}]);if(n)throw n;je({name:"",cpf:"",cep:""}),be()}catch(n){alert("Erro ao salvar cliente: "+n.message)}finally{De(!1)}},Ba=async t=>{if(t.preventDefault(),!Te)return;if(D(null),!l){D("Nenhuma clínica ativa encontrada.");return}if(!X.name.trim())return;const a=se(X.cpf),s=se(X.cep);if(a&&!St(a)){D("CPF inválido.");return}if(s&&s.length!==8){D("CEP inválido (use 8 dígitos).");return}if(a){const{data:n}=await d.from("customers").select("id").eq("cpf",a).eq("clinic_id",l).maybeSingle();if(n&&n.id!==Te){D("CPF já cadastrado.");return}}De(!0);try{const{error:n}=await d.from("customers").update({name:X.name,cpf:a||null,cep:s||null,clinic_id:l}).eq("id",Te);if(n)throw n;Be(!1),ve(null),Ne({name:"",cpf:"",cep:""}),be()}catch(n){alert("Erro ao salvar cliente: "+n.message)}finally{De(!1)}},Qa=async t=>{if(!confirm("Excluir cliente?"))return;const{error:a}=await d.from("customers").delete().eq("id",t);a||(Te===t&&(ve(null),je({name:"",cpf:"",cep:""})),ge(s=>s.filter(n=>n!==t)),be())},Ga=async()=>{if(!pe.length||!confirm(`Excluir ${pe.length} clientes selecionados?`))return;const{error:t}=await d.from("customers").delete().in("id",pe);if(t){alert("Erro ao excluir clientes: "+t.message);return}ge([]),be()},Wa=t=>{const a=x=>`"${String(x??"").replace(/"/g,'""')}"`,s=["Nome","CPF","CEP"],n=t.map(x=>[a(x.name||""),a(x.cpf||""),a(x.cep||"")].join(",")),g=[s.join(","),...n].join(`
`),b=new Blob([g],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(b),f=document.createElement("a");f.href=v,f.download="clientes.csv",f.click(),URL.revokeObjectURL(v)},Ja=(t,a)=>{const s=j=>`"${String(j??"").replace(/"/g,'""')}"`,n=["nome","tipo"],g=t.map(j=>[s(j.name||""),s(j.tipo||a)].join(",")),b=[n.join(","),...g].join(`
`),v=new Blob([b],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(v),x=document.createElement("a");x.href=f,x.download=`categorias_${a}.csv`,x.click(),URL.revokeObjectURL(f)},Ka=t=>{const a=x=>`"${String(x??"").replace(/"/g,'""')}"`,s=["nome","documento","telefone"],n=t.map(x=>[a(x.nome||""),a(x.cnpj||""),a(x.telefone||"")].join(",")),g=[s.join(","),...n].join(`
`),b=new Blob([g],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(b),f=document.createElement("a");f.href=v,f.download="fornecedores.csv",f.click(),URL.revokeObjectURL(v)},Xa=t=>{const a=window.open("","_blank");if(!a)return;const s=t.map(n=>`
      <tr>
        <td>${n.name||""}</td>
        <td>${n.cpf||""}</td>
        <td>${n.cep||""}</td>
      </tr>
    `).join("");a.document.write(`
      <html>
        <head>
          <title>Clientes</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 24px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ddd; padding: 8px; font-size: 12px; }
            th { background: #f3f4f6; text-align: left; }
          </style>
        </head>
        <body>
          <h2>Clientes</h2>
          <table>
            <thead>
              <tr><th>Nome</th><th>CPF</th><th>CEP</th></tr>
            </thead>
            <tbody>${s}</tbody>
          </table>
        </body>
      </html>
    `),a.document.close(),a.focus(),a.print()},Za=()=>{te({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),ae(null),jt(null),vt(null),Nt(null)},rt=()=>{ca(null),Z({name:"",email:"",role:"user",ativo:!0,paginas_liberadas:[],avatar_url:null}),H(null),Ze(null),Ye(null),tt(null)},Ha=t=>{ca(t.id),Z({name:t.name||"",email:t.email||"",role:t.role||"user",ativo:t.ativo!==!1,paginas_liberadas:t.paginas_liberadas||[],avatar_url:t.avatar_url||null}),H(null),Ze(null),Ye(null),tt(null),ke(!0)},Ya=async t=>{if(!l)return;const{error:a}=await d.from("clinic_users").update({ativo:t.ativo===!1}).eq("id",t.id).eq("clinic_id",l);if(a){alert("Erro ao atualizar usuário: "+a.message);return}Pe()},es=async t=>{const a=await ya(t);if(a){Nt(a),jt(null),vt(null);return}Nt(null),jt(t),vt(URL.createObjectURL(t))},ts=async t=>{const a=await ya(t);if(a){tt(a),Ze(null),Ye(null);return}tt(null),Ze(t),Ye(URL.createObjectURL(t))},as=async t=>{if(!l)return;if(!he){alert("Apenas o super admin da clínica pode excluir usuários.");return}const a=t.name||t.email||"este usuário";if(!confirm(`Apagar ${a}?`))return;const{error:s}=await d.from("clinic_users").delete().eq("id",t.id).eq("clinic_id",l);if(s){alert("Erro ao apagar usuário: "+s.message);return}ft===t.id&&(ke(!1),rt()),Pe()},ss=async t=>{if(t.preventDefault(),!he){ae("Apenas o super admin da clínica pode gerenciar usuários.");return}if(!l){ae("Nenhuma clínica ativa encontrada.");return}const a=A.name.trim(),s=A.email.trim().toLowerCase();if(!a||!s){ae("Nome e e-mail são obrigatórios.");return}if(Xe&&yt){ae(Xe);return}const n=Q.length>0?A.paginas_liberadas.filter(f=>xa.has(f)):A.paginas_liberadas;le(!0),ae(null);let g=A.avatar_url;if(yt)try{g=await ja(l,yt)}catch(f){ae(`Erro ao enviar imagem: ${f.message}`),le(!1);return}const b={clinic_id:l,name:a,email:s,role:A.role,ativo:A.ativo,paginas_liberadas:n,avatar_url:g||null},v=await d.from("clinic_users").insert(b);if(v.error){ae(v.error.message),le(!1);return}if(pa){const f={shouldCreateUser:!0,emailRedirectTo:pa},{error:x}=await d.auth.signInWithOtp({email:s,options:f});x&&ae(`Usuário criado, mas não foi possível enviar o e-mail: ${x.message}`)}Za(),Pe(),le(!1)},rs=async t=>{if(t.preventDefault(),!he){H("Apenas o super admin da clínica pode gerenciar usuários.");return}if(!l){H("Nenhuma clínica ativa encontrada.");return}if(!ft){H("Nenhum usuário selecionado para edição.");return}const a=U.name.trim(),s=U.email.trim().toLowerCase();if(!a||!s){H("Nome e e-mail são obrigatórios.");return}if(et&&wt){H(et);return}const n=Q.length>0?U.paginas_liberadas.filter(f=>xa.has(f)):U.paginas_liberadas;le(!0),H(null);let g=U.avatar_url;if(wt)try{g=await ja(l,wt)}catch(f){H(`Erro ao enviar imagem: ${f.message}`),le(!1);return}const b={clinic_id:l,name:a,email:s,role:U.role,ativo:U.ativo,paginas_liberadas:n,avatar_url:g||null},v=await d.from("clinic_users").update(b).eq("id",ft).eq("clinic_id",l);if(v.error){H(v.error.message),le(!1);return}ke(!1),rt(),Pe(),le(!1)},Ut=W.filter(t=>t.tipo===J),re=r.useMemo(()=>{const t=Ve.trim().toLowerCase(),a=[...Bt].sort((s,n)=>(s.name||"").localeCompare(n.name||""));return t?a.filter(s=>(s.name||"").toLowerCase().includes(t)):a},[Bt,Ve]),me=Math.max(1,Math.ceil(re.length/mt)),Ae=Math.min(dt,me),ns=re.slice((Ae-1)*mt,Ae*mt),Pt=r.useMemo(()=>{const t=ht.trim().toLowerCase();return t?gt.filter(a=>{const s=(a.name||"").toLowerCase(),n=(a.email||"").toLowerCase();return s.includes(t)||n.includes(t)}):gt},[gt,ht]),At=Ke||A.avatar_url||"",It=He||U.avatar_url||"";return r.useEffect(()=>{Oe(1)},[Ve]),r.useEffect(()=>{dt>me&&Oe(me)},[dt,me]),e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Configurações"}),e.jsx("p",{className:"text-gray-500",children:"Cadastre categorias, taxas, clientes e usuários"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>de("categorias"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="categorias"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Categorias"}),e.jsx("button",{onClick:()=>de("taxas"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="taxas"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Taxas de Cartão"}),e.jsx("button",{onClick:()=>de("clientes"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="clientes"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Clientes"}),e.jsx("button",{onClick:()=>de("procedimentos"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="procedimentos"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Procedimentos"}),e.jsx("button",{onClick:()=>de("profissionais"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="profissionais"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Profissionais"}),e.jsx("button",{onClick:()=>de("fornecedores"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="fornecedores"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Fornecedores"}),wa&&e.jsx("button",{onClick:()=>de("usuarios"),className:`px-4 py-2 rounded-lg text-sm font-medium border ${m==="usuarios"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Usuários"})]}),m==="categorias"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsx("button",{onClick:()=>Lt("receita"),className:`flex-1 py-4 text-sm font-medium text-center transition-colors ${J==="receita"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50":"text-gray-500 hover:text-gray-700"}`,children:"Categorias de Receitas"}),e.jsx("button",{onClick:()=>Lt("despesa"),className:`flex-1 py-4 text-sm font-medium text-center transition-colors ${J==="despesa"?"text-red-600 border-b-2 border-red-600 bg-red-50":"text-gray-500 hover:text-gray-700"}`,children:"Categorias de Despesas"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre categorias individualmente ou importe via CSV."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`nome,tipo
Categoria ${J==="receita"?"Receita":"Despesa"},${J}`)}`,download:`modelo_categorias_${J}.csv`,className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>Ja(Ut,J),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Baixar CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Rt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(nt,{size:14})," ",Rt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Da(t.target.files[0]),t.target.value="")}})]})]})]}),e.jsxs("form",{onSubmit:qa,className:"flex gap-3 mb-8",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{value:ye,onChange:t=>Fe(t.target.value),placeholder:`Nova categoria de ${J}...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("button",{type:"submit",disabled:Dt||!ye.trim(),className:"px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50 flex items-center gap-2",children:[Dt?e.jsx(ne,{size:18,className:"animate-spin"}):e.jsx(Y,{size:18}),Le?"Atualizar":"Adicionar"]})]}),k?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Carregando..."}):e.jsxs("ul",{className:"divide-y divide-gray-100",children:[Ut.map(t=>e.jsxs("li",{className:"py-3 flex items-center justify-between hover:bg-gray-50 px-2 rounded-lg -mx-2 transition-colors",children:[e.jsx("span",{className:"font-medium text-gray-700",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{ot(t.id),Fe(t.name)},className:"text-xs text-gray-500 hover:text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>$a(t.id),className:"p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition-colors",children:e.jsx(Ft,{size:16})})]})]},t.id)),Ut.length===0&&e.jsx("li",{className:"text-center py-8 text-gray-400 italic",children:"Nenhuma categoria cadastrada."})]})]})]}),m==="taxas"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ds,{size:18})," Taxas por Bandeira"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre a taxa (%) por bandeira de cartão de crédito."})]})}),e.jsxs("form",{onSubmit:Ma,className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bandeira"}),e.jsx("input",{required:!0,value:F.bandeira,onChange:t=>ce({...F,bandeira:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: Visa, Master, Elo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Taxa (%)"}),e.jsx("input",{required:!0,type:"number",step:"0.01",value:F.taxa_percent,onChange:t=>ce({...F,taxa_percent:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas (mín)"}),e.jsx("input",{required:!0,type:"number",min:"1",value:F.min_installments,onChange:t=>ce({...F,min_installments:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas (máx)"}),e.jsx("input",{required:!0,type:"number",min:"1",value:F.max_installments,onChange:t=>ce({...F,max_installments:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"submit",disabled:Vt,className:"w-full px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2 justify-center",children:[Vt?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),Re?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[Mt.map(t=>e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.bandeira}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.metodo," • ",t.min_installments,"x até ",t.max_installments,"x"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-brand-600 font-bold",children:[t.taxa_percent,"%"]}),e.jsx("button",{onClick:()=>{ct(t.id),ce({bandeira:t.bandeira,taxa_percent:String(t.taxa_percent),metodo:t.metodo,min_installments:String(t.min_installments||1),max_installments:String(t.max_installments||1)})},className:"text-gray-400 hover:text-brand-600",children:"Editar"}),e.jsx("button",{onClick:()=>Va(t.id),className:"text-gray-400 hover:text-red-600",children:e.jsx(Ft,{size:16})})]})]},t.id)),Mt.length===0&&e.jsx("div",{className:"text-sm text-gray-400",children:"Nenhuma taxa cadastrada."})]})]}),m==="clientes"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(zt,{size:18})," Clientes"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Registre clientes. CPF e CEP são opcionais."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`Nome,CPF,CEP
Fulano da Silva,12345678909,01000-000
Maria Souza,98765432100,20000-000`)}`,download:"modelo_clientes.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>Wa(re),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Baixar CSV"]}),e.jsxs("button",{type:"button",onClick:()=>Xa(re),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Baixar PDF"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Qt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(nt,{size:14})," ",Qt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Ra(t.target.files[0]),t.target.value="")}})]})]})]}),Me&&e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 bg-gray-50 text-sm",children:[e.jsx("p",{className:"font-semibold text-gray-800 mb-1",children:"Relatório de importação"}),e.jsxs("p",{className:"text-gray-700",children:["Importados: ",Me.imported]}),Me.rejected.length>0&&e.jsxs("div",{className:"mt-2 text-gray-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Registros recusados:"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1",children:Me.rejected.map((t,a)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:t.name||"(sem nome)"})," — CPF: ",t.cpf||"(vazio)"," — CEP: ",t.cep||"-"," — ",t.reason]},a))})]})]}),e.jsxs("form",{onSubmit:Oa,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{required:!0,value:K.name,onChange:t=>je({...K,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome completo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{value:K.cpf,onChange:t=>je({...K,cpf:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Somente números"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsx("input",{value:K.cep,onChange:t=>je({...K,cep:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"00000-000"})]}),e.jsx("div",{className:"md:col-span-4 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:$e,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[$e?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),"Salvar Cliente"]})})]}),qe&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg",children:qe}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("input",{value:Ve,onChange:t=>ka(t.target.value),placeholder:"Buscar cliente por nome...",className:"w-full md:max-w-xs px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:re.length>0&&re.every(t=>pe.includes(t.id)),onChange:t=>{t.target.checked?ge(re.map(a=>a.id)):ge([])}}),"Selecionar todos"]}),e.jsx("button",{type:"button",disabled:!pe.length,onClick:Ga,className:"px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg border border-red-100 disabled:opacity-50",children:"Excluir selecionados"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[re.length," clientes"]})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[ns.map(t=>{const a=pe.includes(t.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:s=>{s.target.checked?ge(n=>[...n,t.id]):ge(n=>n.filter(g=>g!==t.id))}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["CPF: ",t.cpf||"-"," • CEP: ",t.cep||"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{D(null),ve(t.id),Ne({name:t.name||"",cpf:t.cpf||"",cep:t.cep||""}),Be(!0)},className:"text-gray-400 hover:text-brand-600 text-sm",children:"Editar"}),e.jsx("button",{onClick:()=>Qa(t.id),className:"text-gray-400 hover:text-red-600",children:e.jsx(Ft,{size:16})})]})]},t.id)}),re.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum cliente cadastrado."})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("button",{type:"button",disabled:Ae<=1,onClick:()=>Oe(t=>Math.max(1,t-1)),className:"px-3 py-2 border border-gray-200 rounded-lg disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{children:["Página ",Ae," de ",me]}),e.jsx("button",{type:"button",disabled:Ae>=me,onClick:()=>Oe(t=>Math.min(me,t+1)),className:"px-3 py-2 border border-gray-200 rounded-lg disabled:opacity-50",children:"Próxima"})]}),Ea&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar cliente"}),e.jsx("button",{onClick:()=>{Be(!1),ve(null),D(null)},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:Ba,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{required:!0,value:X.name,onChange:t=>Ne({...X,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{value:X.cpf,onChange:t=>Ne({...X,cpf:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsx("input",{value:X.cep,onChange:t=>Ne({...X,cep:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),qe&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg",children:qe}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Be(!1),ve(null),D(null)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:$e,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[$e?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),"Salvar alterações"]})]})]})]})})]}),m==="procedimentos"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ms,{size:16})," Procedimentos realizados"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre procedimentos individualmente ou importe via CSV."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`#,Categoria,Procedimento,Custo insumo,Tempo (min),Valor cobrado
1,Consulta,Consulta Geral,50,30,200`)}`,download:"modelo_procedimentos.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Modelo CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${Xt?"opacity-60 pointer-events-none":""}`,children:[e.jsx(nt,{size:14})," ",Xt?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{if(!t.target.files?.length)return;if(!l){alert("Nenhuma clínica ativa para importar procedimentos.");return}const a=t.target.files[0];Zt(!0);try{const n=(await a.text()).replace(/^\uFEFF/,"").split(/\r?\n/).filter(h=>h.trim().length>0);if(!n.length)throw new Error("Arquivo vazio");const g=n[0],b=(g.match(/,/g)||[]).length,f=(g.match(/;/g)||[]).length>b?";":",",x=h=>{const C=[];let u="",o=!1;for(let i=0;i<h.length;i++){const c=h[i];if(c==='"'){o=!o;continue}c===f&&!o?(C.push(u),u=""):u+=c}return C.push(u),C.map(i=>i.trim())},j=x(g).map(h=>h.toLowerCase()),z=j.some(h=>h.includes("procedimento")||h.includes("categoria")),M=z?n.slice(1):n,V=h=>{const C=j.findIndex(u=>h.some(o=>u.includes(o)));return C>=0?C:-1},ue=z?V(["categoria"]):-1,xe=z?V(["procedimento"]):-1,G=z?V(["custo"]):-1,R=z?V(["tempo"]):-1,L=z?V(["valor"]):-1,E=M.map(h=>{const C=x(h),u=!z&&C.length>=6?1:0,o=_=>{if(_==null||_==="")return null;const O=_.replace(/\./g,"").replace(",","."),$=Number(O);return Number.isFinite($)?$:null},i=(_,O)=>{const $=_>=0?_:O;return C[$]??""},c=i(ue,u+0),p=i(xe,u+1),N=i(G,u+2),q=i(R,u+3),I=i(L,u+4);return{categoria:c||null,procedimento:p||"",custo_insumo:o(N),tempo_minutos:o(q),valor_cobrado:o(I),clinic_id:l}}).filter(h=>h.procedimento);if(E.length){const{error:h}=await d.from("procedures").insert(E);if(h)throw h;Ue()}else alert("Nenhuma linha válida encontrada no CSV.")}catch(s){alert("Erro ao importar CSV: "+s.message)}finally{Zt(!1),t.target.value=""}}})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("input",{type:"text",value:Ht,onChange:t=>Aa(t.target.value),placeholder:"Buscar procedimento...",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-brand-500 flex-1 min-w-[220px]"}),e.jsx("button",{onClick:async()=>{if(!fe.length||!confirm("Apagar procedimentos selecionados?"))return;const{error:t}=await d.from("procedures").delete().in("id",fe);t||(_e([]),Ue())},className:"px-4 py-2 bg-red-50 text-red-700 rounded-lg border border-red-200 text-sm mr-2 disabled:opacity-50",disabled:!fe.length,children:"Apagar selecionados"}),e.jsxs("button",{onClick:()=>{we(null),ie({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),Ce(!0)},className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[e.jsx(Y,{size:16})," Novo procedimento"]})]}),e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:fe.length>0&&fe.length===Qe.length,onChange:t=>{t.target.checked?_e(Qe.map(a=>a.id)):_e([])}})}),e.jsx("th",{className:"px-4 py-2 text-left",children:"#"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Procedimento"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Custo insumo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Tempo (min)"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Valor cobrado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Qe.filter(t=>t.procedimento?.toLowerCase().includes(Ht.toLowerCase())).map((t,a)=>{const s=fe.includes(t.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:e.jsx("input",{type:"checkbox",checked:s,onChange:n=>{n.target.checked?_e(g=>[...g,t.id]):_e(g=>g.filter(b=>b!==t.id))}})}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:a+1}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.categoria||"-"}),e.jsx("td",{className:"px-4 py-2 font-semibold text-gray-800",children:t.procedimento}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.custo_insumo??"-"}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.tempo_minutos??"-"}),e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.valor_cobrado??"-"}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[e.jsx("button",{onClick:()=>{we(t.id),ie({categoria:t.categoria||"",procedimento:t.procedimento||"",valor_cobrado:t.valor_cobrado||"",custo_insumo:t.custo_insumo||"",tempo_minutos:t.tempo_minutos||""}),Ce(!0)},className:"text-brand-600 text-sm mr-3",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir procedimento?"))return;const{error:n}=await d.from("procedures").delete().eq("id",t.id);n||Ue()},className:"text-red-600 text-sm",children:"Apagar"})]})]},t.id)}),Qe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-sm text-gray-400",children:"Nenhum procedimento cadastrado."})})]})]})}),Pa&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:Ge?"Editar procedimento":"Novo procedimento"}),e.jsx("button",{onClick:()=>{Ce(!1),we(null)},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!P.procedimento.trim()){if(!l){alert("Nenhuma clínica ativa para salvar procedimento.");return}Kt(!0);try{const a={categoria:P.categoria||null,procedimento:P.procedimento,valor_cobrado:P.valor_cobrado?Number(P.valor_cobrado):null,custo_insumo:P.custo_insumo?Number(P.custo_insumo):null,tempo_minutos:P.tempo_minutos?Number(P.tempo_minutos):null,clinic_id:l};if(Ge){const{error:s}=await d.from("procedures").update(a).eq("id",Ge);if(s)throw s}else{const{error:s}=await d.from("procedures").insert([a]);if(s)throw s}ie({categoria:"",procedimento:"",valor_cobrado:"",custo_insumo:"",tempo_minutos:""}),we(null),Ce(!1),Ue()}catch(a){alert("Erro ao salvar procedimento: "+a.message)}finally{Kt(!1)}}},className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsx("input",{value:P.categoria,onChange:t=>ie({...P,categoria:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: Consulta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedimento"}),e.jsx("input",{required:!0,value:P.procedimento,onChange:t=>ie({...P,procedimento:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do procedimento"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor cobrado"}),e.jsx("input",{type:"number",value:P.valor_cobrado,onChange:t=>ie({...P,valor_cobrado:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custo insumo"}),e.jsx("input",{type:"number",value:P.custo_insumo,onChange:t=>ie({...P,custo_insumo:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tempo (min)"}),e.jsx("input",{type:"number",value:P.tempo_minutos,onChange:t=>ie({...P,tempo_minutos:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Ce(!1),we(null)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Jt,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Jt?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),Ge?"Atualizar":"Salvar"]})]})]})]})})]}),m==="profissionais"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(zt,{size:16})," Profissionais"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre profissionais para venda e execução."})]})}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!ee.nome.trim()){aa(!0);try{if(ut){const{error:a}=await d.from("professionals").update({nome:ee.nome,tipo:ee.tipo,clinic_id:l}).eq("id",ut);if(a)throw a}else{const{error:a}=await d.from("professionals").insert([{nome:ee.nome,tipo:ee.tipo,clinic_id:l}]);if(a)throw a}We({nome:"",tipo:"venda"}),ea(null),Et()}catch(a){alert("Erro ao salvar profissional: "+a.message)}finally{aa(!1)}}},className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:ee.nome,onChange:t=>We({...ee,nome:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do profissional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:ee.tipo,onChange:t=>We({...ee,tipo:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"venda",children:"Venda"}),e.jsx("option",{value:"execucao",children:"Execução"})]})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:ta,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[ta?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),ut?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[Yt.map(t=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tipo: ",t.tipo]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{ea(t.id),We({nome:t.nome||"",tipo:t.tipo||"venda"})},className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir profissional?"))return;const{error:a}=await d.from("professionals").delete().eq("id",t.id);a||Et()},className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),Yt.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum profissional cadastrado."})]})]}),m==="fornecedores"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(zt,{size:16})," Fornecedores"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cadastre fornecedores para usar no lançamento de despesas."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("a",{href:`data:text/csv;charset=utf-8,${encodeURIComponent(`nome,documento,telefone
Fornecedor Ltda,12345678000199,11999999999`)}`,download:"modelo_fornecedores.csv",className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Modelo CSV"]}),e.jsxs("button",{type:"button",onClick:()=>Ka(xt),className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{size:14})," Baixar CSV"]}),e.jsxs("label",{className:`px-3 py-2 text-sm bg-brand-600 text-white rounded-lg flex items-center gap-2 cursor-pointer hover:bg-brand-700 ${ia?"opacity-60 pointer-events-none":""}`,children:[e.jsx(nt,{size:14})," ",ia?"Importando...":"Importar CSV",e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:async t=>{t.target.files?.length&&(await Ta(t.target.files[0]),t.target.value="")}})]})]})]}),e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!T.nome.trim()){na(!0);try{if(pt){const{error:a}=await d.from("suppliers").update({nome:T.nome,cnpj:T.cnpj,telefone:T.telefone,clinic_id:l}).eq("id",pt);if(a)throw a}else{const{error:a}=await d.from("suppliers").insert([{nome:T.nome,cnpj:T.cnpj,telefone:T.telefone,clinic_id:l}]);if(a)throw a}Se({nome:"",cnpj:"",telefone:""}),sa(null),st()}catch(a){alert("Erro ao salvar fornecedor: "+a.message)}finally{na(!1)}}},className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da empresa"}),e.jsx("input",{value:T.nome,onChange:t=>Se({...T,nome:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Fornecedor Ltda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ"}),e.jsx("input",{value:T.cnpj,onChange:t=>Se({...T,cnpj:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Somente números"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{value:T.telefone,onChange:t=>Se({...T,telefone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"(00) 00000-0000"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:ra,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[ra?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),pt?"Atualizar":"Salvar"]})})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[xt.map(t=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["CNPJ: ",t.cnpj||"-"," • Tel: ",t.telefone||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{sa(t.id),Se({nome:t.nome||"",cnpj:t.cnpj||"",telefone:t.telefone||""})},className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(!confirm("Excluir fornecedor?"))return;const{error:a}=await d.from("suppliers").delete().eq("id",t.id);a||st()},className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),xt.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum fornecedor cadastrado."})]})]}),m==="usuarios"&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:he?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(us,{size:16})," Usuários"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Crie usuários e defina quais páginas cada um pode acessar."})]})}),l?e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:ss,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:A.name,onChange:t=>te({...A,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:A.email,onChange:t=>te({...A,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@clinica.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem do usuário"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-[10px] text-gray-400",children:At?e.jsx("img",{src:At,alt:"Avatar do usuário",className:"h-full w-full object-cover"}):e.jsx("span",{children:"Sem imagem"})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[At?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async t=>{const a=t.target.files?.[0];a&&await es(a),t.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),Xe&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:Xe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),e.jsxs("select",{value:A.role,onChange:t=>te({...A,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"user-active",type:"checkbox",checked:A.ativo,onChange:t=>te({...A,ativo:t.target.checked}),className:"h-4 w-4 text-brand-600"}),e.jsx("label",{htmlFor:"user-active",className:"text-sm text-gray-700",children:"Usuário ativo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Páginas liberadas"}),Q.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>te(t=>({...t,paginas_liberadas:Q.map(a=>a.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>te(t=>({...t,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]})]}),Q.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Defina as páginas liberadas para a clínica antes de liberar acessos."}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:Ct,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:Q.map(t=>e.jsx("button",{type:"button",onClick:()=>{A.paginas_liberadas.includes(t.value)||(te(a=>({...a,paginas_liberadas:[...a.paginas_liberadas,t.value]})),Ct.current&&Ct.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:t.label},t.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.paginas_liberadas.map(t=>e.jsxs("button",{type:"button",onClick:()=>te(a=>({...a,paginas_liberadas:a.paginas_liberadas.filter(s=>s!==t)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[lt[t]||t," ✕"]},t))})]})]}),da&&e.jsx("p",{className:"text-sm text-red-600",children:da}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:Je,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Je?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),"Adicionar usuário"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("input",{value:ht,onChange:t=>Fa(t.target.value),placeholder:"Buscar usuário...",className:"w-full md:max-w-xs px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Pt.length," usuários"]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg divide-y",children:[bt&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Carregando usuários..."}),!bt&&Pt.map(t=>e.jsxs("div",{className:"p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 shrink-0 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:`Foto de ${t.name||"usuário"}`,className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:va(t.name||"",t.email||"")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Perfil: ",t.role||"user"," • ",t.ativo===!1?"Inativo":"Ativo"]}),t.paginas_liberadas&&t.paginas_liberadas.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Páginas: ",t.paginas_liberadas.map(a=>lt[a]||a).join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Ha(t),className:"text-sm text-brand-600",children:"Editar"}),e.jsx("button",{type:"button",onClick:()=>Ya(t),className:`text-sm ${t.ativo===!1?"text-emerald-600":"text-red-600"}`,children:t.ativo===!1?"Ativar":"Desativar"}),e.jsx("button",{type:"button",onClick:()=>as(t),className:"text-sm text-red-600",children:"Apagar"})]})]},t.id)),!bt&&Pt.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-400 text-center",children:"Nenhum usuário cadastrado."})]})]}),La&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Editar usuário"}),e.jsx("button",{type:"button",onClick:()=>{ke(!1),rt()},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:rs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{value:U.name,onChange:t=>Z({...U,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Nome do usuário"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:U.email,onChange:t=>Z({...U,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"email@clinica.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagem do usuário"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 rounded-full border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden text-xs font-semibold text-gray-500",children:It?e.jsx("img",{src:It,alt:"Avatar do usuário",className:"h-full w-full object-cover object-center"}):e.jsx("span",{children:va(U.name||"",U.email||"")})}),e.jsxs("label",{className:"px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[It?"Trocar imagem":"Adicionar imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async t=>{const a=t.target.files?.[0];a&&await ts(a),t.currentTarget.value=""}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Quadrada até 350 x 350."})]}),et&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:et})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),e.jsxs("select",{value:U.role,onChange:t=>Z({...U,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"edit-user-active",type:"checkbox",checked:U.ativo,onChange:t=>Z({...U,ativo:t.target.checked}),className:"h-4 w-4 text-brand-600"}),e.jsx("label",{htmlFor:"edit-user-active",className:"text-sm text-gray-700",children:"Usuário ativo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Páginas liberadas"}),Q.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Z(t=>({...t,paginas_liberadas:Q.map(a=>a.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),e.jsx("button",{type:"button",onClick:()=>Z(t=>({...t,paginas_liberadas:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]})]}),Q.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Defina as páginas liberadas para a clínica antes de liberar acessos."}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("details",{ref:_t,className:"relative",children:[e.jsx("summary",{className:"list-none cursor-pointer w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:"Selecionar página..."}),e.jsx("div",{className:"absolute z-20 mt-2 w-full max-h-56 overflow-auto border border-gray-200 rounded-lg bg-white shadow-lg",children:Q.map(t=>e.jsx("button",{type:"button",onClick:()=>{U.paginas_liberadas.includes(t.value)||(Z(a=>({...a,paginas_liberadas:[...a.paginas_liberadas,t.value]})),_t.current&&_t.current.removeAttribute("open"))},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:t.label},t.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.paginas_liberadas.map(t=>e.jsxs("button",{type:"button",onClick:()=>Z(a=>({...a,paginas_liberadas:a.paginas_liberadas.filter(s=>s!==t)})),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 hover:border-gray-300",children:[lt[t]||t," ✕"]},t))})]})]}),ua&&e.jsx("p",{className:"text-sm text-red-600",children:ua}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{ke(!1),rt()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:Je,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[Je?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),"Salvar alterações"]})]})]})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Selecione uma clínica para gerenciar usuários."})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Acesso restrito ao super admin da clínica."})})]})};export{Cs as default};
