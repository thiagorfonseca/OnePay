import{j as e,i as H,d as J,r as c}from"./index-HcuLVkXM.js";import{r as X,s as Z}from"./archetypeService-ChV8hfRs.js";const U=["FACILITADOR","ANALISTA","REALIZADOR","VISIONÁRIO"],b=[["ATENCIOSO","CONTROLADO","ENERGÉTICO","SOCIÁVEL"],["DOADOR","SUBMISSO","COMPETITIVO","CONVINCENTE"],["RESPEITOSO","RESERVADO","HABILIDOSO","ESTIMULANTE"],["SENSÍVEL","SATISFEITO","AUTOSSUFICIENTE","ESPIRITUOSO"],["PACIENTE","PLANEJADOR","POSITIVO","CHARMOSO"],["TÍMIDO","ORGANIZADO","SEGURO","ESPONTÂNEO"],["SERVIÇAL","ORDEIRO","FRANCO","OTIMISTA"],["AMIGÁVEL","FIEL","VIGOROSO","ENGRAÇADO"],["DIPLOMÁTICO","MINUNCIOSO","AUDACIOSO","ENCANTADOR"],["PREVISÍVEL","CULTO","CONFIANTE","ALEGRE"],["INOFENSIVO","IDEALISTA","INDEPENDENTE","INSPIRADO"],["PROFUNDO","DEMONSTRATIVO","DECIDIDO","IRÔNICO"],["MEDIADOR","DESEMBARAÇADO","ATIVO","MUSICAL"],["TOLERANTE","PENSATIVO","FIRME","CONVERSADOR"],["LEAL","OUVINTE","LÍDER","ATIVO"],["CONTENTE","DETALHISTA","CHEFE","ATRAENTE"],["AGRADÁVEL","PERFECCIONISTA","PRODUTIVO","POPULAR"],["EQUILIBRADO","COMPORTADO","VALENTE","VIVAZ"],["ACANHADO","TRANQUILO","AUTORITARIO","METIDO"],["COMPREENSIVO","DISCIPLINADO","ARROJADO","SEQUESTRADOR"],["DÓCIL","TÉCNICO","DESTEMIDO","EXIBIDO"],["EXPERIENTE","INVESTIGADOR","PIONEIRO","EXPRESSIVO"],["CONSIDERADO","COERENTE","VIGILANTE","INVENTIVO"],["FIEL","SENSATO","OTIMISTA","ENTUSIASMADO"],["CASUAL","RIGOROSO","AMBICIOSO","TALENTOSO"],["COOPERATIVO","PENSADOR","TOMADOR DE DECISÃO","CRÍTICO"],["DIPLOMATA","DESENVOLVIDO","ENFRENTA DESAFIOS","CRIATIVO"],["PACIENTE","DESCONFIADO","INQUIETO","AVENTUREIRO"],["CALMO","EXIGENTE","OBSTINADO","CONQUISTADOR"],["SENSÍVEL","METÓDICO","DESTEMIDO","INOVADOR"],["TRANQUILO","MELANCÓLICO","ORIENTADO","EXTROVERTIDO"],["COMPLACENTE","RACIONAL","AUTOCONFIANTE","IMPULSIVO"],["ACOMODADO","CRÍTICO","ASTUTO","INSTÁVEL"],["VAGAROSO","DESCONFIADO","IRRITÁVEL","DISTRAÍDO"],["VINGATIVO","RELUTANTE","AGITADO","IMPRUDENTE"],["ACOMODADO","CRÍTICO","ASTUTO","INSTÁVEL"],["ANIMADO","ANALÍTICO","AVENTUREIRO","ADAPTÁVEL"],["SERENO","PERSUASIVO","PERSISTENTE","BRINCALHÃO"],["ATENCIOSO","CONTROLADO","ENERGÉTICO","SOCIÁVEL"],["DOADOR","SUBMISSO","COMPETITIVO","CONVINCENTE"]],W=a=>{const l={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0};return a.forEach(i=>{if(i==null)return;const o=U[i];o&&(l[o]+=1)}),l},Y=a=>{const l=Object.entries(a),i=Math.max(...l.map(([,r])=>r)),o=l.filter(([,r])=>r===i).map(([r])=>r);return o.length>1?{topProfile:"EMPATE",topProfiles:o}:{topProfile:o[0],topProfiles:o}},K=(a,l=40)=>{const i=l>0?l:1,o={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0};return Object.keys(o).forEach(r=>{o[r]=a[r]/i*100}),o},ee=({current:a,total:l,label:i})=>{const o=l>0?l:1,r=Math.min(100,Math.max(0,a/o*100));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:i||"Progresso"}),e.jsxs("span",{children:[a,"/",l]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-500 rounded-full transition-all",style:{width:`${r}%`}})})]})},se=({index:a,total:l,options:i,selectedIndex:o,onSelect:r})=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 shadow-sm space-y-5",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Pergunta ",a+1," de ",l]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mt-1",children:"Escolha a palavra que mais combina com você"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map((N,A)=>{const f=o===A;return e.jsx("button",{type:"button",onClick:()=>r(A),className:`text-left px-4 py-3 rounded-xl border transition-all ${f?"border-brand-500 bg-brand-50 text-brand-700 shadow-sm":"border-gray-200 bg-white text-gray-700 hover:border-brand-300 hover:bg-brand-50/40"}`,children:e.jsx("span",{className:"font-medium",children:N})},`${N}-${A}`)})})]}),m=b.length,te=Array.from({length:m},()=>null),ae={name:"",email:"",phone:"",profession:"",city:"",consent:!1},oe=()=>{const{publicToken:a}=H(),l=J(),[i,o]=c.useState(!0),[r,N]=c.useState(null),[A,f]=c.useState(!1),[T,g]=c.useState("intro"),[t,O]=c.useState(ae),[p,C]=c.useState(te),[u,S]=c.useState(0),[h,x]=c.useState(null),[D,j]=c.useState(!1),I=a?`archetypeDraft:${a}`:"",E=r?.audience_type==="INTERNAL";c.useEffect(()=>{if(!a)return;let s=!0;return(async()=>{o(!0);const d=await X(a);s&&(d?(f(!1),N(d)):(f(!0),N(null)),o(!1))})(),()=>{s=!1}},[a]),c.useEffect(()=>{if(!I)return;const s=typeof window<"u"?window.localStorage.getItem(I):null;if(s)try{const n=JSON.parse(s);if(n?.form&&O(d=>({...d,...n.form})),Array.isArray(n?.answers)&&n.answers.length===m&&C(n.answers),typeof n?.currentIndex=="number"){const d=Math.min(Math.max(n.currentIndex,0),m-1);S(d)}n?.step==="quiz"&&g("quiz")}catch{}},[I]),c.useEffect(()=>{if(!I||typeof window>"u")return;const s={form:t,answers:p,currentIndex:u,step:T};window.localStorage.setItem(I,JSON.stringify(s))},[I,t,p,u,T]),c.useEffect(()=>{r&&r.audience_type==="INTERNAL"&&(g("quiz"),O(s=>({...s,consent:!0})))},[r]);const R=c.useMemo(()=>p.filter(s=>s!==null).length,[p]),L=R===m,k=()=>{if(x(null),E){g("quiz");return}if(!t.name.trim()){x("Informe seu nome para continuar.");return}if(!t.consent){x("Você precisa aceitar a LGPD para continuar.");return}g("quiz")},F=s=>{x(null),C(n=>{const d=[...n];return d[u]=s,d}),u<m-1&&S(n=>n+1)},G=()=>{x(null),S(s=>Math.max(0,s-1))},_=async()=>{if(!(!r||!a)){if(!L){x("Responda todas as perguntas antes de finalizar.");return}j(!0),x(null);try{const s=W(p),{topProfile:n,topProfiles:d}=Y(s),B=K(s,m),Q=p.map((q,M)=>{const y=q??0,z=b[M][y],$=U[y];return{questionId:M+1,selectedIndex:y,selectedWord:z,scoredProfile:$}}),v=a.trim(),P=r.clinic_id.trim(),V=r.audience_type?.trim().toUpperCase();if(!v||!P||!V)throw new Error("Token inválido. Atualize a página e tente novamente.");await Z({clinic_id:P,public_token:v,audience_type:V,name:E?"":t.name.trim(),email:E?null:t.email.trim()||null,phone:E?null:t.phone.trim()||null,profession:E?null:t.profession.trim()||null,city:E?null:t.city.trim()||null,consent_lgpd:E?!0:t.consent,scores:s,top_profile:n,top_profiles:n==="EMPATE"?d:null,answers:Q});const w={scores:s,percentages:B,topProfile:n,topProfiles:d};typeof window<"u"&&I&&(window.localStorage.removeItem(I),window.localStorage.setItem(`archetypeResult:${a}`,JSON.stringify(w))),l(`/public/perfil/${a}/resultado`,{state:{result:w}})}catch(s){console.error(s);const n="Não foi possível salvar suas respostas. Tente novamente.";x(s?.message?`${n} (${s.message})`:n)}finally{j(!1)}}};return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:"Carregando..."}):A||!a||!r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-8 max-w-md text-center space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Link inválido ou expirado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Peça um novo link para acessar o teste de perfil."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-12 space-y-8",children:[e.jsxs("header",{className:"space-y-3 text-center",children:[e.jsx("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full bg-brand-50 text-brand-700 text-xs font-semibold uppercase tracking-wide",children:"Questionário comportamental"}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-800",children:"Teste de Perfil Comportamental"}),e.jsxs("p",{className:"text-gray-500 max-w-2xl mx-auto",children:["Responda ",m," perguntas para mapear seu estilo de comunicação, decisão e execução. Não existem respostas certas ou erradas."]})]}),T==="intro"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.2fr_0.8fr] gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 space-y-5 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Antes de começar"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Preencha seus dados básicos e siga para as perguntas."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Nome *",e.jsx("input",{type:"text",value:t.name,onChange:s=>O({...t,name:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Email",e.jsx("input",{type:"email",value:t.email,onChange:s=>O({...t,email:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["WhatsApp",e.jsx("input",{type:"tel",value:t.phone,onChange:s=>O({...t,phone:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Profissão",e.jsx("input",{type:"text",value:t.profession,onChange:s=>O({...t,profession:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600 sm:col-span-2",children:["Cidade",e.jsx("input",{type:"text",value:t.city,onChange:s=>O({...t,city:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]})]}),e.jsxs("label",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:t.consent,onChange:s=>O({...t,consent:s.target.checked}),className:"mt-1"}),e.jsx("span",{children:"Concordo com o uso dos meus dados conforme a LGPD."})]}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h}),e.jsx("button",{type:"button",onClick:k,className:"px-6 py-3 rounded-xl bg-brand-600 text-white font-medium hover:bg-brand-700",children:"Iniciar teste"})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Como funciona"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:["Você verá ",m," perguntas, cada uma com 4 palavras."]}),e.jsx("p",{children:"Escolha a palavra que mais combina com você no momento."}),e.jsx("p",{children:"O teste leva de 6 a 8 minutos em média."})]}),e.jsx("div",{className:"bg-brand-50 text-brand-700 rounded-xl p-4 text-sm",children:"Suas respostas são usadas apenas para gerar o resultado do perfil comportamental."})]})]}),T==="quiz"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-4 shadow-sm",children:e.jsx(ee,{current:R,total:m,label:"Respondidas"})}),e.jsx(se,{index:u,total:m,options:b[u],selectedIndex:p[u],onSelect:F}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:G,disabled:u===0,className:"px-5 py-2.5 rounded-xl border border-gray-200 text-gray-600 disabled:opacity-50",children:"Voltar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[R,"/",m," respondidas"]}),e.jsx("button",{type:"button",onClick:_,disabled:!L||D,className:"px-6 py-2.5 rounded-xl bg-brand-600 text-white font-medium disabled:opacity-50",children:D?"Enviando...":"Finalizar teste"})]})]}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h})]})]})})};export{oe as default};
