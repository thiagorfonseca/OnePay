import{c as yt,R as F,r as N,u as $t,a as Bt,s as le,j as e,W as Ft,A as Lt,C as lt}from"./index-HcuLVkXM.js";import{f as j,a as Ke,b as Ae}from"./utils-C6qNh0Lg.js";import{u as ct}from"./useModalControls-BiWM_r1l.js";import{L as zt}from"./loader-2-CJ7EHZdi.js";import{i as Ut,c as dt,D as Vt,f as Kt,E as Wt,L as We,a as Be,C as Ht,A as qt,b as Pe,d as Yt,e as Ye,h as Xt,g as Qt,j as vt,u as Gt,G as Zt,k as ut,l as Jt,X as xe,Y as fe,m as ea,R as He,n as Se,T as ke,B as Ee,o as Fe}from"./generateCategoricalChart-B03fitBM.js";import{B as qe}from"./BarChart-CmfSdQYO.js";import{T as ta}from"./trash-2-FGsD9cgR.js";const aa=yt("ArrowDownCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),ra=yt("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);var sa=["type","layout","connectNulls","ref"],na=["key"];function ge(a){"@babel/helpers - typeof";return ge=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ge(a)}function mt(a,n){if(a==null)return{};var r=oa(a,n),s,l;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(a);for(l=0;l<h.length;l++)s=h[l],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(r[s]=a[s])}return r}function oa(a,n){if(a==null)return{};var r={};for(var s in a)if(Object.prototype.hasOwnProperty.call(a,s)){if(n.indexOf(s)>=0)continue;r[s]=a[s]}return r}function Ce(){return Ce=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(a[s]=r[s])}return a},Ce.apply(this,arguments)}function pt(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);n&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(a,l).enumerable})),r.push.apply(r,s)}return r}function z(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?pt(Object(r),!0).forEach(function(s){q(a,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(r,s))})}return a}function he(a){return da(a)||ca(a)||la(a)||ia()}function ia(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function la(a,n){if(a){if(typeof a=="string")return Xe(a,n);var r=Object.prototype.toString.call(a).slice(8,-1);if(r==="Object"&&a.constructor&&(r=a.constructor.name),r==="Map"||r==="Set")return Array.from(a);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xe(a,n)}}function ca(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function da(a){if(Array.isArray(a))return Xe(a)}function Xe(a,n){(n==null||n>a.length)&&(n=a.length);for(var r=0,s=new Array(n);r<n;r++)s[r]=a[r];return s}function ua(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function ht(a,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,Nt(s.key),s)}}function ma(a,n,r){return n&&ht(a.prototype,n),r&&ht(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a}function pa(a,n,r){return n=Le(n),ha(a,jt()?Reflect.construct(n,r||[],Le(a).constructor):n.apply(a,r))}function ha(a,n){if(n&&(ge(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xa(a)}function xa(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function jt(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jt=function(){return!!a})()}function Le(a){return Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Le(a)}function fa(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(n&&n.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),n&&Qe(a,n)}function Qe(a,n){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,l){return s.__proto__=l,s},Qe(a,n)}function q(a,n,r){return n=Nt(n),n in a?Object.defineProperty(a,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[n]=r,a}function Nt(a){var n=ga(a,"string");return ge(n)=="symbol"?n:n+""}function ga(a,n){if(ge(a)!="object"||!a)return a;var r=a[Symbol.toPrimitive];if(r!==void 0){var s=r.call(a,n);if(ge(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var be=(function(a){function n(){var r;ua(this,n);for(var s=arguments.length,l=new Array(s),h=0;h<s;h++)l[h]=arguments[h];return r=pa(this,n,[].concat(l)),q(r,"state",{isAnimationFinished:!0,totalLength:0}),q(r,"generateSimpleStrokeDasharray",function(c,u){return"".concat(u,"px ").concat(c-u,"px")}),q(r,"getStrokeDasharray",function(c,u,f){var w=f.reduce(function(_,k){return _+k});if(!w)return r.generateSimpleStrokeDasharray(u,c);for(var A=Math.floor(c/w),C=c%w,P=u-c,R=[],D=0,O=0;D<f.length;O+=f[D],++D)if(O+f[D]>C){R=[].concat(he(f.slice(0,D)),[C-O]);break}var S=R.length%2===0?[0,P]:[P];return[].concat(he(n.repeat(f,A)),he(R),S).map(function(_){return"".concat(_,"px")}).join(", ")}),q(r,"id",Gt("recharts-line-")),q(r,"pathRef",function(c){r.mainCurve=c}),q(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),q(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return fa(n,a),ma(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();this.setState({totalLength:s})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();s!==this.state.totalLength&&this.setState({totalLength:s})}}},{key:"getTotalLength",value:function(){var s=this.mainCurve;try{return s&&s.getTotalLength&&s.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(s,l){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var h=this.props,c=h.points,u=h.xAxis,f=h.yAxis,w=h.layout,A=h.children,C=Kt(A,Wt);if(!C)return null;var P=function(O,S){return{x:O.x,y:O.y,value:O.value,errorVal:vt(O.payload,S)}},R={clipPath:s?"url(#clipPath-".concat(l,")"):null};return F.createElement(We,R,C.map(function(D){return F.cloneElement(D,{key:"bar-".concat(D.props.dataKey),data:c,xAxis:u,yAxis:f,layout:w,dataPointFormatter:P})}))}},{key:"renderDots",value:function(s,l,h){var c=this.props.isAnimationActive;if(c&&!this.state.isAnimationFinished)return null;var u=this.props,f=u.dot,w=u.points,A=u.dataKey,C=Be(this.props,!1),P=Be(f,!0),R=w.map(function(O,S){var _=z(z(z({key:"dot-".concat(S),r:3},C),P),{},{index:S,cx:O.x,cy:O.y,value:O.value,dataKey:A,payload:O.payload,points:w});return n.renderDotItem(f,_)}),D={clipPath:s?"url(#clipPath-".concat(l?"":"dots-").concat(h,")"):null};return F.createElement(We,Ce({className:"recharts-line-dots",key:"dots"},D),R)}},{key:"renderCurveStatically",value:function(s,l,h,c){var u=this.props,f=u.type,w=u.layout,A=u.connectNulls;u.ref;var C=mt(u,sa),P=z(z(z({},Be(C,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:l?"url(#clipPath-".concat(h,")"):null,points:s},c),{},{type:f,layout:w,connectNulls:A});return F.createElement(Ht,Ce({},P,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(s,l){var h=this,c=this.props,u=c.points,f=c.strokeDasharray,w=c.isAnimationActive,A=c.animationBegin,C=c.animationDuration,P=c.animationEasing,R=c.animationId,D=c.animateNewValues,O=c.width,S=c.height,_=this.state,k=_.prevPoints,W=_.totalLength;return F.createElement(qt,{begin:A,duration:C,isActive:w,easing:P,from:{t:0},to:{t:1},key:"line-".concat(R),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(Z){var $=Z.t;if(k){var Y=k.length/u.length,X=u.map(function(T,ye){var Q=Math.floor(ye*Y);if(k[Q]){var se=k[Q],L=Pe(se.x,T.x),ce=Pe(se.y,T.y);return z(z({},T),{},{x:L($),y:ce($)})}if(D){var ve=Pe(O*2,T.x),je=Pe(S/2,T.y);return z(z({},T),{},{x:ve($),y:je($)})}return z(z({},T),{},{x:T.x,y:T.y})});return h.renderCurveStatically(X,s,l)}var ae=Pe(0,W),U=ae($),V;if(f){var re="".concat(f).split(/[,\s]+/gim).map(function(T){return parseFloat(T)});V=h.getStrokeDasharray(U,W,re)}else V=h.generateSimpleStrokeDasharray(W,U);return h.renderCurveStatically(u,s,l,{strokeDasharray:V})})}},{key:"renderCurve",value:function(s,l){var h=this.props,c=h.points,u=h.isAnimationActive,f=this.state,w=f.prevPoints,A=f.totalLength;return u&&c&&c.length&&(!w&&A>0||!Yt(w,c))?this.renderCurveWithAnimation(s,l):this.renderCurveStatically(c,s,l)}},{key:"render",value:function(){var s,l=this.props,h=l.hide,c=l.dot,u=l.points,f=l.className,w=l.xAxis,A=l.yAxis,C=l.top,P=l.left,R=l.width,D=l.height,O=l.isAnimationActive,S=l.id;if(h||!u||!u.length)return null;var _=this.state.isAnimationFinished,k=u.length===1,W=dt("recharts-line",f),Z=w&&w.allowDataOverflow,$=A&&A.allowDataOverflow,Y=Z||$,X=Ye(S)?this.id:S,ae=(s=Be(c,!1))!==null&&s!==void 0?s:{r:3,strokeWidth:2},U=ae.r,V=U===void 0?3:U,re=ae.strokeWidth,T=re===void 0?2:re,ye=Xt(c)?c:{},Q=ye.clipDot,se=Q===void 0?!0:Q,L=V*2+T;return F.createElement(We,{className:W},Z||$?F.createElement("defs",null,F.createElement("clipPath",{id:"clipPath-".concat(X)},F.createElement("rect",{x:Z?P:P-R/2,y:$?C:C-D/2,width:Z?R:R*2,height:$?D:D*2})),!se&&F.createElement("clipPath",{id:"clipPath-dots-".concat(X)},F.createElement("rect",{x:P-L/2,y:C-L/2,width:R+L,height:D+L}))):null,!k&&this.renderCurve(Y,X),this.renderErrorBar(Y,X),(k||c)&&this.renderDots(Y,se,X),(!O||_)&&Qt.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(s,l){return s.animationId!==l.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:l.curPoints}:s.points!==l.curPoints?{curPoints:s.points}:null}},{key:"repeat",value:function(s,l){for(var h=s.length%2!==0?[].concat(he(s),[0]):s,c=[],u=0;u<l;++u)c=[].concat(he(c),he(h));return c}},{key:"renderDotItem",value:function(s,l){var h;if(F.isValidElement(s))h=F.cloneElement(s,l);else if(Ut(s))h=s(l);else{var c=l.key,u=mt(l,na),f=dt("recharts-line-dot",typeof s!="boolean"?s.className:"");h=F.createElement(Vt,Ce({key:c},u,{className:f}))}return h}}])})(N.PureComponent);q(be,"displayName","Line");q(be,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Zt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});q(be,"getComposedData",function(a){var n=a.props,r=a.xAxis,s=a.yAxis,l=a.xAxisTicks,h=a.yAxisTicks,c=a.dataKey,u=a.bandSize,f=a.displayedData,w=a.offset,A=n.layout,C=f.map(function(P,R){var D=vt(P,c);return A==="horizontal"?{x:ut({axis:r,ticks:l,bandSize:u,entry:P,index:R}),y:Ye(D)?null:s.scale(D),value:D,payload:P}:{x:Ye(D)?null:r.scale(D),y:ut({axis:s,ticks:h,bandSize:u,entry:P,index:R}),value:D,payload:P}});return z({points:C,layout:A},w)});var xt=Jt({chartName:"LineChart",GraphicalChild:be,axisComponents:[{axisType:"xAxis",AxisComp:xe},{axisType:"yAxis",AxisComp:fe}],formatAxisMap:ea});const ba={DINHEIRO:{diasAtePrimeiroRecebimento:0,intervaloDias:0},PIX:{diasAtePrimeiroRecebimento:0,intervaloDias:0},DEBITO:{diasAtePrimeiroRecebimento:1,intervaloDias:0,usarDiasUteis:!0},CREDITO:{diasAtePrimeiroRecebimento:30,intervaloDias:30},BOLETO:{usarDataVencimento:!0},CHEQUE:{usarDataVencimento:!0},TRANSFERENCIA:{diasAtePrimeiroRecebimento:0,intervaloDias:0},CONVENIO:{diasAtePrimeiroRecebimento:30,intervaloDias:30},OUTRO:{diasAtePrimeiroRecebimento:0,intervaloDias:0}},ft=(a,n)=>{const r=new Date(a);return r.setDate(r.getDate()+n),r},ya=(a,n)=>{const r=new Date(a);let s=0;for(;s<n;){r.setDate(r.getDate()+1);const l=r.getDay();l!==0&&l!==6&&(s+=1)}return r},gt=(a,n)=>{const r=new Date(a);return r.setMonth(r.getMonth()+n),r},va=(a,n)=>{const r=Math.floor(a/n*100)/100,s=Array(n).fill(r),l=r*n,h=Math.round((a-l)*100)/100;return s[s.length-1]=Math.round((s[s.length-1]+h)*100)/100,s};function ja(a){const n=[];return a.forEach(r=>{const s=(r.datasParcelas||[]).filter(Boolean),l=Math.max(1,s.length||r.numeroParcelas||1),h=va(r.valorTotal,l),c=[];if(s.length)c.push(...s.slice(0,l));else if(r.tipo==="RECEITA"){const u=ba[r.formaPagamento],f=r.dataVencimento||r.dataEmissao,w=u.usarDataVencimento?f:u.diasAtePrimeiroRecebimento&&!r.dataVencimento?u.usarDiasUteis?ya(f,u.diasAtePrimeiroRecebimento):ft(f,u.diasAtePrimeiroRecebimento):f;for(let A=0;A<l;A++)u.intervaloDias&&A>0?c.push(ft(w,u.intervaloDias*A)):!u.intervaloDias&&A>0?c.push(gt(w,A)):c.push(w)}else{const u=r.dataVencimento||r.dataEmissao;for(let f=0;f<l;f++)c.push(gt(u,f))}h.forEach((u,f)=>{const w=r.status==="REALIZADO"&&!!r.dataBaixa;n.push({lancamentoId:r.id,tipo:r.tipo,dataPrevista:c[f]||r.dataEmissao,valor:u,status:w?"REALIZADO":"PREVISTO",dataRealizado:w?r.dataBaixa:void 0})})}),n}function Na(a){const n=new Map;return a.forEach(r=>{const s=r.dataPrevista.toISOString().split("T")[0],l=n.get(s)||{data:new Date(s),totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoDia:0};r.tipo==="RECEITA"?l.totalReceitasPrevistas+=r.valor:l.totalDespesasPrevistas+=r.valor,l.saldoPrevistoDia=l.totalReceitasPrevistas-l.totalDespesasPrevistas,n.set(s,l)}),Array.from(n.values()).sort((r,s)=>r.data.getTime()-s.data.getTime())}function Da(a){const n=new Map;return a.forEach(r=>{const s=r.dataPrevista.getFullYear(),l=r.dataPrevista.getMonth()+1,h=`${s}-${l}`,c=n.get(h)||{ano:s,mes:l,totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoMes:0};r.tipo==="RECEITA"?c.totalReceitasPrevistas+=r.valor:c.totalDespesasPrevistas+=r.valor,c.saldoPrevistoMes=c.totalReceitasPrevistas-c.totalDespesasPrevistas,n.set(h,c)}),Array.from(n.values()).sort((r,s)=>r.ano-s.ano||r.mes-s.mes)}function bt(a,n){let r=n;return a.map(s=>(r+=s.saldoPrevistoDia,{...s,saldoAcumulado:r}))}const wa=a=>Number(a?.valor_bruto??a?.valor??a?.valor_liquido??0)||0,Oa=()=>{const{effectiveClinicId:a,isAdmin:n,isSystemAdmin:r,selectedClinicId:s}=$t(),[l,h]=Bt(),[c,u]=N.useState(!0),[f,w]=N.useState([]),[A,C]=N.useState([]),[P,R]=N.useState([]),[D,O]=N.useState([]),[S,_]=N.useState(()=>new Date(new Date().getFullYear(),new Date().getMonth(),1)),[k,W]=N.useState(()=>new Date(new Date().getFullYear(),new Date().getMonth()+1,0)),[Z,$]=N.useState(!1),[Y,X]=N.useState(!1),[ae,U]=N.useState(null),V=t=>!t||Number.isNaN(t.getTime())?"":t.toISOString().split("T")[0],re=t=>{if(!t)return null;const o=new Date(`${t}T00:00:00`);return Number.isNaN(o.getTime())?null:o},T=t=>{if(typeof t=="string"){const i=Number(t.replace(",","."));return isNaN(i)?0:i}const o=Number(t||0);return isNaN(o)?0:o},ye=async(t,o,i)=>{if(!t.length)return t;const m=d=>{if(!d)return null;const p=new Date(d);if(!Number.isNaN(p.getTime()))return p;const y=new Date(`${d}T00:00:00`);return Number.isNaN(y.getTime())?null:y},b=(d,p)=>{const y=new Date(d);return y.setDate(y.getDate()+p),y},g=(d,p)=>{const y=new Date(d);let I=0;for(;I<p;){y.setDate(y.getDate()+1);const M=y.getDay();M!==0&&M!==6&&(I+=1)}return y},B=(d,p)=>{const y=new Date(d);return y.setMonth(y.getMonth()+p),y},De=d=>{const p=(d||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return p.includes("CREDITO")?"CREDITO":p.includes("DEBITO")?"DEBITO":p.includes("PIX")?"PIX":p.includes("BOLETO")?"BOLETO":p.includes("CHEQUE")?"CHEQUE":p.includes("TRANSFER")||p.includes("TED")||p.includes("DOC")?"TRANSFERENCIA":p.includes("CONVENIO")?"CONVENIO":p.includes("DINHEIRO")||p.includes("CASH")?"DINHEIRO":"OUTRO"},K=(d,p)=>{const y=Math.floor(d/p*100)/100,I=Array(p).fill(y),M=y*p,ee=Math.round((d-M)*100)/100;return I[I.length-1]=Math.round((I[I.length-1]+ee)*100)/100,I},we=d=>{if(!d)return[];try{const p=Array.isArray(d)?d:typeof d=="string"?JSON.parse(d):[];return Array.isArray(p)?p.map(y=>typeof y=="string"?{vencimento:y}:!y||typeof y!="object"?null:{vencimento:y.vencimento||y.due_date||y.data||y.date||""}).filter(Boolean):[]}catch{return[]}},me=new Date;me.setHours(0,0,0,0);const ie=d=>{const p=Number(d.valor_liquido??d.valor_bruto??d.valor??0);if(!Number.isFinite(p)||p===0)return 0;const y=we(d.recebimento_parcelas).map(H=>m(H.vencimento)).filter(Boolean),I=Math.max(1,y.length||parseInt(d.parcelas||"1",10)||1),M=De(d.forma_pagamento),ee=m(d.data_recebimento),pe=m(d.data_competencia);let te=null;if(M==="BOLETO"||M==="CHEQUE"?te=ee||pe:M==="CREDITO"||M==="CONVENIO"?te=ee||(pe?b(pe,30):null):M==="DEBITO"?te=ee||(pe?g(pe,1):null):te=ee||pe,!te&&y.length===0)return 0;const Ve=M==="CREDITO"||M==="CONVENIO"?30:0,Mt=K(p,I);let it=0;for(let H=0;H<I;H+=1){let $e=y[H]||te;$e&&(y[H]||(Ve&&H>0?$e=b(te,Ve*H):!Ve&&I>1&&H>0&&($e=B(te,H))),$e<=me&&(it+=Mt[H]||0))}return it},G=new Map;o.forEach(d=>{if(!d.bank_account_id)return;const p=ie(d);!Number.isFinite(p)||p===0||G.set(d.bank_account_id,(G.get(d.bank_account_id)||0)+p)});const x=new Map;i.forEach(d=>{if(!d.bank_account_id||d.status!=="paid")return;const p=Number(d.valor??0);Number.isFinite(p)&&x.set(d.bank_account_id,(x.get(d.bank_account_id)||0)+p)});const v=[],E=t.map(d=>{const p=T(d.initial_balance??0),y=G.get(d.id)||0,I=x.get(d.id)||0,M=p+y-I,ee=T(d.current_balance??d.initial_balance??0);return Math.abs(ee-M)>.009&&v.push({id:d.id,current_balance:M}),{...d,current_balance:M}});return v.length&&await Promise.all(v.map(d=>le.from("bank_accounts").update({current_balance:d.current_balance}).eq("id",d.id))),E},[Q,se]=N.useState(()=>l.get("tab")==="caixa"?"caixa":"dre"),[L,ce]=N.useState("linha"),[ve,je]=N.useState(!1),ze=N.useRef(null),de=N.useCallback(async()=>{if(!(!a&&!n)){u(!0);try{const t=a;let o=le.from("revenues").select("id, description, valor_liquido, valor_bruto, data_competencia, data_recebimento, forma_pagamento, parcelas, status, recebimento_parcelas, categories(name), bank_account_id");t&&(o=o.eq("clinic_id",t));const{data:i}=await o;let m=le.from("expenses").select("id, description, valor, data_competencia, data_pagamento, data_vencimento, forma_pagamento, parcelas, status, categories(name), bank_account_id");t&&(m=m.eq("clinic_id",t));const{data:b}=await m;let g=le.from("bank_accounts").select("id, clinic_id, current_balance, initial_balance");t&&(g=g.eq("clinic_id",t));const{data:B}=await g,De=await ye(B||[],i||[],b||[]);w(De||[]),R(i||[]),O(b||[]);const K=x=>{if(!x)return;const v=new Date(x);return Number.isNaN(v.getTime())?void 0:v},we=x=>{const v=(x||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return v.includes("CREDITO")?"CREDITO":v.includes("DEBITO")?"DEBITO":v.includes("PIX")?"PIX":v.includes("BOLETO")?"BOLETO":v.includes("CHEQUE")?"CHEQUE":v.includes("TRANSFER")||v.includes("TED")||v.includes("DOC")?"TRANSFERENCIA":v.includes("CONVENIO")?"CONVENIO":v.includes("DINHEIRO")||v.includes("CASH")?"DINHEIRO":"OUTRO"},me=x=>{if(!x)return[];try{const v=Array.isArray(x)?x:typeof x=="string"?JSON.parse(x):[];return Array.isArray(v)?v.map(E=>typeof E=="string"?K(E):!E||typeof E!="object"?null:K(E.vencimento||E.due_date||E.data||E.date||"")).filter(Boolean):[]}catch{return[]}},ie=[];(i||[]).forEach(x=>{const v=K(x.data_competencia);if(!v)return;const E=me(x.recebimento_parcelas);ie.push({id:x.id,tipo:"RECEITA",descricao:x.description||"Receita",dataEmissao:v,dataVencimento:K(x.data_recebimento),formaPagamento:we(x.forma_pagamento),valorTotal:x.valor_liquido||x.valor_bruto||0,numeroParcelas:Math.max(1,E.length||parseInt(x.parcelas||1,10)),datasParcelas:E.length?E:void 0,status:x.status==="paid"?"REALIZADO":"PREVISTO",dataBaixa:K(x.data_recebimento)})}),(b||[]).forEach(x=>{const v=K(x.data_competencia);v&&ie.push({id:x.id,tipo:"DESPESA",descricao:x.description||"Despesa",dataEmissao:v,dataVencimento:K(x.data_vencimento||x.data_competencia),formaPagamento:we(x.forma_pagamento),valorTotal:x.valor||0,numeroParcelas:parseInt(x.parcelas||1,10),status:x.status==="paid"?"REALIZADO":"PREVISTO",dataBaixa:K(x.data_pagamento)})});const G=ja(ie);C(G)}catch(t){console.error("Erro ao carregar dashboard:",t)}finally{u(!1)}}},[a,n,s]);N.useEffect(()=>{de()},[de]),N.useEffect(()=>{if(!a&&!n)return;const t=a?`clinic_id=eq.${a}`:void 0,o=le.channel(`dashboard-updates-${a??"all"}`);return o.on("postgres_changes",{event:"*",schema:"public",table:"revenues",...t?{filter:t}:{}},()=>de()),o.on("postgres_changes",{event:"*",schema:"public",table:"expenses",...t?{filter:t}:{}},()=>de()),o.subscribe(),()=>{le.removeChannel(o)}},[a,n,de]);const Ne=t=>{if(!t)return!1;const o=t instanceof Date?t:new Date(t);return o>=S&&o<=k},Ge=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),Ze=(t,o)=>{const i=o.map(m=>`<Row>${m.map(g=>{const B=g.type==="Number"?g.value:Ge(String(g.value));return`<Cell><Data ss:Type="${g.type}">${B}</Data></Cell>`}).join("")}</Row>`).join("");return`<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"><Worksheet ss:Name="${Ge(t)}"><Table>${i}</Table></Worksheet></Workbook>`},Je=t=>new Promise(o=>{if(!t){o(null);return}const i=t.querySelector("svg");if(!i){o(null);return}const m=i.getBoundingClientRect(),b=Math.max(1,Math.floor(m.width))||Number(i.getAttribute("width"))||800,g=Math.max(1,Math.floor(m.height))||Number(i.getAttribute("height"))||400,B=i.cloneNode(!0);B.setAttribute("xmlns","http://www.w3.org/2000/svg"),B.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),B.setAttribute("width",String(b)),B.setAttribute("height",String(g)),B.getAttribute("viewBox")||B.setAttribute("viewBox",`0 0 ${b} ${g}`);const De=i.querySelectorAll("*"),K=B.querySelectorAll("*");De.forEach((v,E)=>{const d=K[E];if(!d||!(v instanceof Element))return;const p=window.getComputedStyle(v),y=[`fill:${p.getPropertyValue("fill")};`,`stroke:${p.getPropertyValue("stroke")};`,`stroke-width:${p.getPropertyValue("stroke-width")};`,`font-size:${p.getPropertyValue("font-size")};`,`font-family:${p.getPropertyValue("font-family")};`,`font-weight:${p.getPropertyValue("font-weight")};`,`opacity:${p.getPropertyValue("opacity")};`],I=d.getAttribute("style")||"";d.setAttribute("style",`${I}${y.join("")}`)});const me=new XMLSerializer().serializeToString(B),ie=new Blob([me],{type:"image/svg+xml;charset=utf-8"}),G=URL.createObjectURL(ie),x=new Image;x.onload=()=>{const v=document.createElement("canvas");v.width=b,v.height=g;const E=v.getContext("2d");if(!E){URL.revokeObjectURL(G),o(null);return}E.fillStyle="#ffffff",E.fillRect(0,0,b,g),E.drawImage(x,0,0,b,g),URL.revokeObjectURL(G),o(v.toDataURL("image/png"))},x.onerror=()=>{URL.revokeObjectURL(G),o(null)},x.src=G}),Dt=async(t,o)=>{const i=await Je(t);if(!i)return;const m=document.createElement("a");m.href=i,m.download=`${o}.png`,m.click()},wt=async(t,o)=>{const i=await Je(t);if(!i)return;const m=window.open("","_blank");m&&(m.document.write(`
      <html>
        <head>
          <title>${o}</title>
          <style>body{font-family:Arial;padding:16px;text-align:center;}img{max-width:100%;}</style>
        </head>
        <body>
          <h3>${o}</h3>
          <img id="chart-image" src="${i}" alt="${o}" />
          <script>
            const img = document.getElementById('chart-image');
            img.onload = () => { window.print(); };
          <\/script>
        </body>
      </html>
    `),m.document.close())},At=()=>{const t=[[{type:"String",value:"Data"},{type:"String",value:"Receitas"},{type:"String",value:"Despesas"},{type:"String",value:"Saldo do Dia"},{type:"String",value:"Saldo Acumulado"},{type:"String",value:"Saldo Banco"}],..._e.map(g=>[{type:"String",value:g.data.toLocaleDateString("pt-BR")},{type:"Number",value:Number(g.totalReceitasPrevistas||0)},{type:"Number",value:Number(g.totalDespesasPrevistas||0)},{type:"Number",value:Number(g.saldoPrevistoDia||0)},{type:"Number",value:Number(g.saldoAcumulado||0)},{type:"Number",value:Number(g.saldoBanco||0)}])],o=Ze("Fluxo Previsto (período)",t),i=new Blob([o],{type:"application/xml;charset=utf-8;"}),m=URL.createObjectURL(i),b=document.createElement("a");b.href=m,b.download=`fluxo-previsto-periodo-${V(S)}-${V(k)}.xml`,b.click(),URL.revokeObjectURL(m)},Pt=()=>{const t=_e.map(i=>`
      <tr>
        <td>${i.data.toLocaleDateString("pt-BR")}</td>
        <td>${j(i.totalReceitasPrevistas)}</td>
        <td>${j(i.totalDespesasPrevistas)}</td>
        <td>${j(i.saldoPrevistoDia)}</td>
        <td>${j(i.saldoAcumulado)}</td>
        <td>${j(i.saldoBanco||0)}</td>
      </tr>
    `).join(""),o=window.open("","_blank");o&&(o.document.write(`
      <html><head><title>Fluxo Previsto (período)</title>
      <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
      </head><body>
      <h3>Fluxo Previsto (período)</h3>
      <table><thead><tr><th>Data</th><th>Receitas</th><th>Despesas</th><th>Saldo do Dia</th><th>Saldo Acumulado</th><th>Saldo Banco</th></tr></thead>
      <tbody>${t}</tbody>
      </table>
      </body></html>
    `),o.document.close(),o.print())},St=()=>{const t=[[{type:"String",value:"Competência"},{type:"String",value:"Receitas"},{type:"String",value:"Despesas"},{type:"String",value:"Saldo"},{type:"String",value:"Saldo Acumulado"},{type:"String",value:"Saldo Banco"}],...Te.map(g=>[{type:"String",value:`${String(g.mes).padStart(2,"0")}/${g.ano}`},{type:"Number",value:Number(g.totalReceitasPrevistas||0)},{type:"Number",value:Number(g.totalDespesasPrevistas||0)},{type:"Number",value:Number(g.saldoPrevistoMes||0)},{type:"Number",value:Number(g.saldoAcumulado||0)},{type:"Number",value:Number(g.saldoBanco||0)}])],o=Ze("Fluxo Previsto (mensal)",t),i=new Blob([o],{type:"application/xml;charset=utf-8;"}),m=URL.createObjectURL(i),b=document.createElement("a");b.href=m,b.download=`fluxo-previsto-mensal-${V(S)}-${V(k)}.xml`,b.click(),URL.revokeObjectURL(m)},kt=()=>{const t=Te.map(i=>`
      <tr>
        <td>${String(i.mes).padStart(2,"0")}/${i.ano}</td>
        <td>${j(i.totalReceitasPrevistas)}</td>
        <td>${j(i.totalDespesasPrevistas)}</td>
        <td>${j(i.saldoPrevistoMes)}</td>
        <td>${j(i.saldoAcumulado)}</td>
        <td>${j(i.saldoBanco||0)}</td>
      </tr>
    `).join(""),o=window.open("","_blank");o&&(o.document.write(`
      <html><head><title>Fluxo Previsto (mensal)</title>
      <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
      </head><body>
      <h3>Fluxo Previsto (mensal)</h3>
      <table><thead><tr><th>Competência</th><th>Receitas</th><th>Despesas</th><th>Saldo</th><th>Saldo Acumulado</th><th>Saldo Banco</th></tr></thead>
      <tbody>${t}</tbody>
      </table>
      </body></html>
    `),o.document.close(),o.print())},ne=N.useMemo(()=>f.reduce((t,o)=>{const i=o.current_balance??o.initial_balance??0,m=typeof i=="string"?Number(i.replace(",",".")):i;return t+(isNaN(m)?0:m)},0),[f]),Re=N.useMemo(()=>P.filter(t=>Ne(t.data_competencia)).reduce((t,o)=>t+wa(o),0),[P,S,k]),Ue=N.useMemo(()=>D.filter(t=>Ne(t.data_competencia)).reduce((t,o)=>t+(o.valor||0),0),[D,S,k]),et=N.useMemo(()=>{const t=new Map;return P.forEach(o=>{const i=o.data_competencia;if(!i||!Ne(i))return;const m=new Date(i),b=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,g=t.get(b)||{date:b,receitas:0,despesas:0,resultado:0};g.receitas+=Number(o.valor_liquido||o.valor_bruto||o.valor||0),t.set(b,g)}),D.forEach(o=>{const i=o.data_competencia;if(!i||!Ne(i))return;const m=new Date(i),b=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,g=t.get(b)||{date:b,receitas:0,despesas:0,resultado:0};g.despesas+=Number(o.valor||0),t.set(b,g)}),Array.from(t.values()).map(o=>({...o,resultado:o.receitas-o.despesas})).sort((o,i)=>o.date.localeCompare(i.date))},[P,D,S,k]),J=N.useMemo(()=>A.filter(t=>Ne(t.dataPrevista)),[A,S,k]),oe=N.useMemo(()=>{const t=Na(J),o=new Map;t.forEach(m=>{const b=m.data.toISOString().split("T")[0];o.set(b,m)});const i=new Date;if(i.setHours(0,0,0,0),i>=S&&i<=k){const m=i.toISOString().split("T")[0];o.has(m)||o.set(m,{data:i,totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoDia:0})}return Array.from(o.values()).sort((m,b)=>m.data.getTime()-b.data.getTime())},[J,S,k]),tt=N.useMemo(()=>bt(oe,0),[oe]),at=N.useMemo(()=>{if(!oe.length)return ne;const t=new Date;if(t.setHours(0,0,0,0),t<S||t>k)return ne;const o=oe.reduce((i,m)=>m.data<=t?i+m.saldoPrevistoDia:i,0);return ne-o},[oe,ne,S,k]),ue=N.useMemo(()=>bt(oe,at),[oe,at]),Oe=N.useMemo(()=>ue.map(t=>{const o=Number(t.totalReceitasPrevistas??0),i=Number(t.totalDespesasPrevistas??0),m=Number(t.saldoPrevistoDia??o-i),b=Number(t.saldoAcumulado??0),g=b-m;return{data:t.data.toISOString().split("T")[0],saldo:b,entrada:o,saida:i,saldoBanco:g}}),[ue]),_e=N.useMemo(()=>tt.map((t,o)=>({...t,saldoBanco:ue[o]?.saldoAcumulado??t.saldoAcumulado})),[tt,ue]),Et=N.useMemo(()=>J.filter(t=>t.tipo==="RECEITA").reduce((t,o)=>t+o.valor,0),[J]),Ct=N.useMemo(()=>J.filter(t=>t.tipo==="DESPESA").reduce((t,o)=>t+o.valor,0),[J]),rt=N.useMemo(()=>Da(J),[J]),st=N.useMemo(()=>{let t=0;return rt.map(o=>(t+=o.saldoPrevistoMes,{...o,saldoAcumulado:t}))},[rt]),Te=N.useMemo(()=>st.map(t=>({...t,saldoBanco:ne+t.saldoAcumulado})),[st,ne]),Ie=t=>{const o=new Date;if(t==="today")_(new Date(o.getFullYear(),o.getMonth(),o.getDate())),W(new Date(o.getFullYear(),o.getMonth(),o.getDate()));else if(t==="week"){const i=new Date(o),m=new Date(o);m.setDate(m.getDate()+6),_(i),W(m)}else t==="month"?(_(new Date(o.getFullYear(),o.getMonth(),1)),W(new Date(o.getFullYear(),o.getMonth()+1,0))):(_(new Date(o.getFullYear(),0,1)),W(new Date(o.getFullYear(),11,31)))},nt=t=>{se(t),l.set("tab",t),h(l)},Rt=le,Ot=r,_t=async()=>{if(!r){U("Apenas o administrador geral pode realizar esta ação.");return}if(!a){U("Selecione uma clínica antes de apagar.");return}X(!0),U(null);try{const{error:t}=await Rt.rpc("clear_financial_data",{p_clinic_id:a});if(t)throw t;$(!1),de()}catch(t){U(t?.message||"Erro ao apagar dados.")}finally{X(!1)}},Me=({active:t,payload:o})=>{if(!t||!o?.length)return null;const i=o[0]?.payload;return i?e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-xs text-gray-700 shadow-md",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Data: ",Ae(i.data)]}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("div",{children:["Saldo Banco: ",j(i.saldoBanco??0)]}),e.jsxs("div",{children:["Entrada: ",j(i.entrada??0)]}),e.jsxs("div",{children:["Saída: ",j(i.saida??0)]}),e.jsxs("div",{className:"font-semibold",children:["Saldo: ",j(i.saldo??0)]})]})]}):null},ot=t=>e.jsx("div",{className:t==="modal"?"bg-white border border-gray-100 rounded-xl shadow-sm p-4":"bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>Ie("today"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Dia"}),e.jsx("button",{onClick:()=>Ie("week"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Semana"}),e.jsx("button",{onClick:()=>Ie("month"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Mês"}),e.jsx("button",{onClick:()=>Ie("year"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Ano"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"date",value:V(S),onChange:o=>{const i=re(o.target.value);i&&_(i)},className:"pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-brand-500 focus:border-brand-500"})]}),e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"date",value:V(k),onChange:o=>{const i=re(o.target.value);i&&W(i)},className:"pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-brand-500 focus:border-brand-500"})]})]})]})}),Tt=ct({isOpen:ve,onClose:()=>je(!1)}),It=ct({isOpen:Z,onClose:()=>{$(!1),U(null)}});return c?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-400",children:[e.jsx(zt,{size:48,className:"animate-spin mb-4 text-brand-500"}),e.jsx("p",{children:"Carregando indicadores financeiros..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Visão Geral"}),e.jsx("p",{className:"text-gray-500",children:"Resumo financeiro em tempo real"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>nt("dre"),className:`px-4 py-2 text-sm rounded-lg border ${Q==="dre"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"DRE"}),e.jsx("button",{onClick:()=>nt("caixa"),className:`px-4 py-2 text-sm rounded-lg border ${Q==="caixa"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Fluxo de Caixa"})]}),ot("page"),Q==="dre"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Saldo em Contas"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:j(ne)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600",children:e.jsx(Ft,{size:24})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Total Receitas Faturadas (competência)"}),e.jsx("h3",{className:"text-2xl font-bold text-green-600",children:j(Re)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-green-600",children:e.jsx(ra,{size:24})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Total Despesas (competência)"}),e.jsx("h3",{className:"text-2xl font-bold text-red-600",children:j(Ue)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-600",children:e.jsx(aa,{size:24})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"DRE (competência)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-green-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Receitas (faturado)"}),e.jsx("p",{className:"text-xl font-bold text-green-700",children:j(Re)})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-red-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Despesas"}),e.jsx("p",{className:"text-xl font-bold text-red-700",children:j(Ue)})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-blue-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Resultado"}),e.jsx("p",{className:"text-xl font-bold text-blue-700",children:j(Re-Ue)})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"DRE (competência) • Entradas x Despesas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Dt(ze.current,"dre-competencia"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PNG"}),e.jsx("button",{type:"button",onClick:()=>wt(ze.current,"DRE (competência)"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"h-80",ref:ze,children:et.length>0?e.jsx(He,{width:"100%",height:"100%",children:e.jsxs(qe,{data:et,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(xe,{dataKey:"date",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ke}),e.jsx(fe,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:t=>`R$${(t/1e3).toFixed(1)}k`}),e.jsx(ke,{formatter:t=>j(t),labelFormatter:t=>`Mês: ${Ke(t)}`}),e.jsx(Ee,{dataKey:"receitas",name:"Entradas",fill:"#22c55e",radius:[6,6,0,0]}),e.jsx(Ee,{dataKey:"despesas",name:"Despesas",fill:"#ef4444",radius:[6,6,0,0]}),e.jsx(Ee,{dataKey:"resultado",name:"Resultado",fill:"#3b82f6",radius:[6,6,0,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Sem dados para o período selecionado."})})]})]}),Q==="caixa"&&e.jsxs(e.Fragment,{children:[Ot&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-red-100 shadow-sm flex flex-col md:flex-row md:items-center gap-3 justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-700",children:"Limpeza de dados financeiros"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Remove todas as receitas e despesas da clínica selecionada. Ação irreversível."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!a&&e.jsx("span",{className:"text-xs text-gray-500",children:"Selecione uma clínica no topo."}),e.jsxs("button",{type:"button",onClick:()=>$(!0),disabled:!a||Y,className:"inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-red-200 text-red-700 hover:bg-red-50 disabled:opacity-50",children:[e.jsx(ta,{size:16}),"Limpar receitas e despesas"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Faturamento emitido (mês)"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:j(Re)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Recebimento previsto caixa  (filtro)"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:j(Et)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pagamento previsto caixa (mês)"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:j(Ct)})]})]}),!ve&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo de Caixa (Saldo Previsto)+ Saldo Banco "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ce("linha"),className:`px-3 py-2 text-sm border rounded-lg ${L==="linha"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Linha"}),e.jsx("button",{type:"button",onClick:()=>ce("coluna"),className:`px-3 py-2 text-sm border rounded-lg ${L==="coluna"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Coluna"}),e.jsx("button",{type:"button",onClick:()=>je(!0),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Tela cheia"})]})]}),e.jsx("div",{className:"h-72",children:ue.length>0?e.jsx(He,{width:"100%",height:"100%",children:L==="linha"?e.jsxs(xt,{data:Oe,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(xe,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(fe,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:t=>`R$${(t/1e3).toFixed(1)}k`}),e.jsx(ke,{content:e.jsx(Me,{})}),e.jsx(Fe,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(be,{type:"linear",dataKey:"saldo",stroke:"#0ea5e9",strokeWidth:2,dot:!1})]}):e.jsxs(qe,{data:Oe,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(xe,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(fe,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:t=>`R$${(t/1e3).toFixed(1)}k`}),e.jsx(ke,{content:e.jsx(Me,{})}),e.jsx(Fe,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(Ee,{dataKey:"saldo",name:"Saldo",fill:"#0ea5e9",radius:[6,6,0,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Nenhuma previsão no período."})})]}),ve&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 p-4 sm:p-6",onClick:Tt.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-6 h-full flex flex-col",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo de Caixa (Saldo Previsto)+ Saldo Banco "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ce("linha"),className:`px-3 py-2 text-sm border rounded-lg ${L==="linha"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Linha"}),e.jsx("button",{type:"button",onClick:()=>ce("coluna"),className:`px-3 py-2 text-sm border rounded-lg ${L==="coluna"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Coluna"}),e.jsx("button",{type:"button",onClick:()=>je(!1),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Fechar"})]})]}),e.jsx("div",{className:"mb-4",children:ot("modal")}),e.jsx("div",{className:"relative flex-1 min-h-[360px]",children:ue.length>0?e.jsx(He,{width:"100%",height:"100%",children:L==="linha"?e.jsxs(xt,{data:Oe,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(xe,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(fe,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:t=>`R$${(t/1e3).toFixed(1)}k`}),e.jsx(ke,{content:e.jsx(Me,{})}),e.jsx(Fe,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(be,{type:"linear",dataKey:"saldo",stroke:"#0ea5e9",strokeWidth:2,dot:!1})]}):e.jsxs(qe,{data:Oe,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(xe,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(fe,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:t=>`R$${(t/1e3).toFixed(1)}k`}),e.jsx(ke,{content:e.jsx(Me,{})}),e.jsx(Fe,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(Ee,{dataKey:"saldo",name:"Saldo",fill:"#0ea5e9",radius:[6,6,0,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Nenhuma previsão no período."})})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo Previsto (mensal)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:St,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Excel"}),e.jsx("button",{type:"button",onClick:kt,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Competência"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Receitas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Despesas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Acumulado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Banco"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Te.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:Ke(`${t.ano}-${String(t.mes).padStart(2,"0")}`)}),e.jsx("td",{className:"px-4 py-2 text-right text-green-600 font-medium",children:j(t.totalReceitasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right text-red-600 font-medium",children:j(t.totalDespesasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoPrevistoMes)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoAcumulado)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoBanco||0)})]},`${t.ano}-${t.mes}`)),Te.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-400",children:"Sem previsões mensais."})})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo Previsto (período)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:At,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Excel"}),e.jsx("button",{type:"button",onClick:Pt,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Receitas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Despesas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo do Dia"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Acumulado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Banco"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[_e.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:t.data.toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-2 text-right text-green-600 font-medium",children:j(t.totalReceitasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right text-red-600 font-medium",children:j(t.totalDespesasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoPrevistoDia)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoAcumulado)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:j(t.saldoBanco||0)})]},t.data.toString())),_e.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-400",children:"Sem previsões registradas."})})]})]})})]})]}),Z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",onClick:It.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(Lt,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Você está prestes a apagar todas as receitas e despesas da clínica selecionada. Essa ação não pode ser desfeita."})]})]}),e.jsxs("div",{className:"p-5 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Clínica:"})," ",a||"Não selecionada"]}),ae&&e.jsx("p",{className:"text-sm text-red-600",children:ae})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>{$(!1),U(null)},className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",disabled:Y,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:_t,disabled:Y||!a,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:Y?"Apagando...":"Sim, apagar tudo"})]})]})})]})};export{Oa as default};
