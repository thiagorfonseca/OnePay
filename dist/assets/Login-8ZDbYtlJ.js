import{r as c,d as L,j as a,s as n}from"./index-HcuLVkXM.js";import{c as v}from"./utils-C6qNh0Lg.js";const F=()=>{const[u,w]=c.useState(""),[d,b]=c.useState(""),[o,i]=c.useState(!1),[p,s]=c.useState(null),[r,g]=c.useState(!1),N=L(),m=v("/auth/callback"),E=v("/auth/reset"),l=u.trim(),h=l.length>0,y=h&&d.trim().length>0,C=async e=>{e.preventDefault(),i(!0),s(null);try{if(r){const{error:t,data:f}=await n.auth.signUp({email:l,password:d,options:{emailRedirectTo:m}});if(t)throw t;if(f.user){const{data:x,error:j}=await n.from("clinics").insert([{name:"Minha Clínica"}]).select().single();j?console.error(j):x&&await n.from("profiles").insert([{id:f.user.id,clinic_id:x.id,full_name:u.split("@")[0],role:"admin"}])}alert("Cadastro realizado! Verifique seu email ou faça login."),g(!1)}else{const{error:t}=await n.auth.signInWithPassword({email:l,password:d});if(t)throw t;N("/")}}catch(t){s(t.message)}finally{i(!1)}},k=async()=>{try{i(!0),s(null);const{error:e}=await n.auth.signInWithOAuth({provider:"google",options:{redirectTo:m,queryParams:{prompt:"consent"}}});e&&s("Erro ao entrar com Google: "+e.message)}catch(e){s(e?.message||"Erro inesperado ao entrar com Google.")}finally{i(!1)}},S=async()=>{try{i(!0),s(null);const{error:e}=await n.auth.signInWithOtp({email:l,options:{emailRedirectTo:m,shouldCreateUser:!0}});e?s("Erro ao enviar magic link: "+e.message):alert("Enviamos um link de acesso para o seu email.")}catch(e){s(e?.message||"Erro inesperado ao enviar magic link.")}finally{i(!1)}},U=async()=>{i(!0),s(null);const{error:e}=await n.auth.resetPasswordForEmail(l,{redirectTo:E});i(!1),e?s("Erro ao enviar reset de senha: "+e.message):alert("Enviamos um email para redefinir sua senha.")};return a.jsx("div",{className:"auth-shell",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-icon",children:a.jsx("img",{src:"/logo-onefinc.png",alt:"OneFinc",className:"h-8 w-8 object-contain"})}),a.jsxs("div",{className:"auth-header",children:[a.jsx("h1",{children:"Entrar ou cadastrar-se"}),a.jsx("p",{children:r?"Crie sua conta para começar com a OneFinc.":"Escolha seu método de acesso para continuar."})]}),a.jsx("div",{className:"auth-socials",children:a.jsxs("button",{type:"button",onClick:k,className:"auth-social-button",disabled:o,children:[a.jsx("span",{className:"auth-social-icon google",children:"G"}),"Continuar com Google"]})}),a.jsx("div",{className:"auth-divider",children:a.jsx("span",{children:"Ou"})}),a.jsxs("form",{className:"auth-form",onSubmit:C,children:[a.jsxs("div",{className:"auth-field",children:[a.jsx("label",{htmlFor:"email",children:"E-mail"}),a.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:u,onChange:e=>w(e.target.value),placeholder:"Digite seu endereço de e-mail",className:"auth-input"})]}),a.jsxs("div",{className:"auth-field",children:[a.jsx("label",{htmlFor:"password",children:"Senha"}),a.jsx("input",{id:"password",name:"password",type:"password",autoComplete:r?"new-password":"current-password",required:r,value:d,onChange:e=>b(e.target.value),placeholder:"••••••••",className:"auth-input"})]}),p&&a.jsx("div",{className:"auth-error",children:p}),a.jsx("button",{type:"submit",disabled:o||!y,className:"auth-primary",children:o?"Processando...":r?"Criar conta com senha":"Entrar com senha"}),!r&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",onClick:S,className:"auth-magic",disabled:o||!h,children:[a.jsx("svg",{className:"auth-magic-icon",width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{d:"M12 3l1.6 4.4L18 9l-4.4 1.6L12 15l-1.6-4.4L6 9l4.4-1.6L12 3zM18.5 15.5l.7 1.9 1.8.7-1.8.7-.7 1.9-.7-1.9-1.8-.7 1.8-.7.7-1.9z",fill:"currentColor"})}),"Enviar link mágico"]}),a.jsx("button",{type:"button",onClick:U,className:"auth-link",disabled:o||!h,children:"Esqueci minha senha"})]})]}),a.jsx("div",{className:"auth-divider auth-divider-soft",children:a.jsx("span",{children:r?"Já tem uma conta?":"Novo por aqui?"})}),a.jsx("button",{onClick:()=>g(!r),className:"auth-secondary",children:r?"Voltar para Login":"Criar nova conta"})]})})};export{F as default};
