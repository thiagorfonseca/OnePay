import{s as o,a as x,r as n,j as e,N as g}from"./index-Bi_Yktdj.js";async function h(c,a){const{data:t,error:r}=await o.from("clinic_invites").select("*").eq("token",c).gt("expires_at",new Date().toISOString()).maybeSingle();if(r)throw r;if(!t)throw new Error("Convite inválido ou expirado");const i=t.email?.trim().toLowerCase(),{error:s}=await o.from("clinic_users").insert({clinic_id:t.clinic_id,email:i,name:i?.split("@")[0]||"Usuário",role:t.role,ativo:!0,user_id:a});if(s)throw s;return await o.from("clinic_invites").delete().eq("id",t.id),t}const v=()=>{const[c]=x(),a=c.get("token"),[t,r]=n.useState("checking"),[i,s]=n.useState("Validando convite..."),[d,u]=n.useState(!1);return n.useEffect(()=>{(async()=>{if(!a){r("error"),s("Token não informado.");return}const{data:{session:l}}=await o.auth.getSession();if(!l){r("need-auth"),s("Faça login para aceitar o convite.");return}try{await h(a,l.user.id),r("success"),s("Convite aceito com sucesso! Redirecionando..."),setTimeout(()=>u(!0),1200)}catch(m){r("error"),s(m.message||"Erro ao aceitar convite.")}})()},[a]),d?e.jsx(g,{to:"/",replace:!0}):t==="need-auth"?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"bg-white shadow-lg border border-gray-200 rounded-lg p-6 max-w-md w-full space-y-3 text-center",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-800",children:"Login necessário"}),e.jsx("p",{className:"text-sm text-gray-600",children:i}),e.jsx("a",{href:`/login?redirectTo=/accept-invite%3Ftoken%3D${encodeURIComponent(a||"")}`,className:"inline-flex justify-center px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 text-sm",children:"Ir para login"})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"bg-white shadow-lg border border-gray-200 rounded-lg p-6 max-w-md w-full space-y-3 text-center",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-800",children:"Convite"}),e.jsx("p",{className:"text-sm text-gray-600",children:i})]})})};export{v as default};
