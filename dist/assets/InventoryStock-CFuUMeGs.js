import{u as k,r as t,j as s}from"./index-HcuLVkXM.js";import{a as v,b as I,c as N,o as C,S as M}from"./service-C61pE4fL.js";import{D as n}from"./DataTable-BxUe0ZZe.js";const L=()=>{const{effectiveClinicId:d}=k(),o=d,[c,m]=t.useState([]),[i,u]=t.useState([]),[h,y]=t.useState([]),[p,x]=t.useState([]),[_,l]=t.useState(!0);t.useEffect(()=>{o&&(l(!0),Promise.all([v(o),I(o),N(o),C(o)]).then(([e,a,b,K])=>{m(e),u(a),y(b),x(K)}).finally(()=>l(!1)))},[o]);const S=t.useMemo(()=>{const e=new Map(i.map(a=>[a.item_id,a]));return c.map(a=>({...a,qty_on_hand:e.get(a.id)?.qty_on_hand??0,stock_value:e.get(a.id)?.stock_value??0}))},[c,i]),g=t.useMemo(()=>[{header:"Item",accessorKey:"name"},{header:"Saldo",accessorKey:"qty_on_hand"},{header:"Valor",accessorKey:"stock_value",cell:({row:e})=>Number(e.original.stock_value||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})},{header:"Unidade",accessorKey:"unit"}],[]),r=t.useMemo(()=>new Map(c.map(e=>[e.id,e.name])),[c]),f=t.useMemo(()=>[{header:"Lote",accessorKey:"batch_id"},{header:"Item",accessorKey:"item_id",cell:({row:e})=>r.get(e.original.item_id)||"—"},{header:"Validade",accessorKey:"expiry_date",cell:({row:e})=>e.original.expiry_date||"—"},{header:"Saldo",accessorKey:"qty_on_hand"}],[r]),j=t.useMemo(()=>[{header:"Container",accessorKey:"id"},{header:"Item",accessorKey:"item_id",cell:({row:e})=>r.get(e.original.item_id)||"—"},{header:"Aberto em",accessorKey:"opened_at"},{header:"Expira em",accessorKey:"expires_at",cell:({row:e})=>e.original.expires_at||"—"},{header:"Saldo",accessorKey:"remaining_qty"}],[r]);return o?s.jsxs("div",{className:"space-y-8",children:[s.jsx(M,{title:"Estoque e Lotes",subtitle:"Visão consolidada por item, por lote e por frasco aberto."}),_?s.jsx("div",{className:"text-sm text-gray-500",children:"Carregando estoque..."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Saldo por item"}),s.jsx(n,{data:S,columns:g,pageSize:10})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Saldo por lote"}),s.jsx(n,{data:h,columns:f,pageSize:8})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Frascos abertos"}),s.jsx(n,{data:p,columns:j,pageSize:8})]})]})]}):null};export{L as default};
