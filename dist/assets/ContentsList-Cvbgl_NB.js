import{c as W,r as a,u as te,b as se,s as k,j as e}from"./index-Bi_Yktdj.js";import{P as ae}from"./plus-CW1JmJBD.js";import{X as re}from"./x-CTfOJ2Wq.js";const le=W("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ne=W("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Y=W("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ie=30,O="content-watchlist",ue=({type:_,title:B,subtitle:H,basePath:T})=>{const[X,h]=a.useState(!0),[p,E]=a.useState([]),[q,K]=a.useState(null),x=a.useRef(!0),{clinicId:C,clinicPackageIds:f}=te(),R=se(),[i,F]=a.useState(null),[S,G]=a.useState(!1),[g,I]=a.useState(!1),[b,w]=a.useState(null),[c,y]=a.useState([]),[M,m]=a.useState({}),[A,L]=a.useState(new Set),[Q,U]=a.useState(new Set),P=a.useCallback(async()=>{h(!0),K(null);try{if(C&&f.length){const{data:r,error:n}=await k.from("content_package_items").select("content_items (id, title, description, thumbnail_url, type, published, created_at)").in("package_id",f);if(!x.current)return;if(n)throw n;const o=new Map;(r||[]).forEach(u=>{const l=u.content_items;!l||l.published!==!0||l.type!==_||o.has(l.id)||o.set(l.id,{id:l.id,title:l.title,description:l.description,thumbnail_url:l.thumbnail_url,created_at:l.created_at})});const $=Array.from(o.values()).sort((u,l)=>(l.created_at||"").localeCompare(u.created_at||""));E($),h(!1);return}const{data:t,error:s}=await k.from("content_items").select("id, title, description, thumbnail_url, created_at").eq("type",_).eq("published",!0).order("created_at",{ascending:!1});if(!x.current)return;if(s)throw s;E(t||[]),h(!1)}catch(t){if(!x.current)return;K(t.message||"Erro ao carregar conteúdos."),E([]),h(!1)}},[_,C,f]);a.useEffect(()=>(x.current=!0,P(),()=>{x.current=!1}),[P]);const V=a.useCallback(async t=>{I(!0),w(null);try{const{data:s,error:r}=await k.from("content_modules").select("id, title, order_index, thumbnail_url").eq("content_id",t).order("order_index",{ascending:!0});if(r)throw r;const n=s||[];if(y(n),!n.length){m({}),I(!1);return}const o=n.map(d=>d.id),{data:$,error:u}=await k.from("content_lessons").select("id, module_id, title, description, order_index").in("module_id",o).order("order_index",{ascending:!0});if(u)throw u;const l={};($||[]).forEach(d=>{d.module_id&&(l[d.module_id]||(l[d.module_id]=[]),l[d.module_id].push(d))}),m(l)}catch(s){w(s.message||"Erro ao carregar episódios."),y([]),m({})}finally{I(!1)}},[]),j=a.useCallback(()=>{if(typeof window>"u")return new Set;try{const t=window.localStorage.getItem(O),s=t?JSON.parse(t):[];return Array.isArray(s)?new Set(s.filter(r=>typeof r=="string")):new Set}catch{return new Set}},[]),Z=t=>{L(s=>{const r=new Set(s);if(r.has(t)?r.delete(t):r.add(t),typeof window<"u")try{window.localStorage.setItem(O,JSON.stringify(Array.from(r)))}catch{}return r})},v=a.useCallback(()=>{if(typeof window>"u")return;const t=new Set;p.forEach(s=>{try{window.localStorage.getItem(`content-progress:${s.id}`)&&t.add(s.id)}catch{}}),U(t)},[p]);a.useEffect(()=>{L(j())},[j]),a.useEffect(()=>{v()},[v]),a.useEffect(()=>{if(typeof window>"u")return;const t=s=>{s.key&&(s.key.startsWith("content-progress:")&&v(),s.key===O&&L(j()))};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[v,j]);const z=t=>{F(t),G(!0),y([]),m({}),w(null),V(t.id)},N=()=>{G(!1),F(null),y([]),m({}),w(null)},J=t=>{i&&(N(),R(`${T}/${i.id}?lesson=${t}`))},ee=t=>{R(`${T}/${t}`)},D=a.useMemo(()=>{for(const t of c){const s=M[t.id];if(s&&s.length)return s[0].id}return null},[c,M]);return a.useEffect(()=>{if(!S)return;const t=s=>{s.key==="Escape"&&N()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[S]),X?e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"Carregando conteúdos..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:B}),e.jsx("p",{className:"text-gray-500",children:H})]}),q&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-6 text-sm text-red-600 space-y-3",children:[e.jsxs("p",{children:["Erro ao carregar conteúdos: ",q]}),e.jsx("button",{type:"button",onClick:P,className:"px-3 py-2 text-xs rounded-lg border border-red-200 text-red-600 hover:bg-red-50",children:"Tentar novamente"})]}),p.length===0?e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-6 text-gray-500 text-sm",children:C&&f.length?"Nenhum conteúdo liberado para este pacote.":"Nenhum conteúdo publicado."}):e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-gray-400",children:"Colecao"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Arraste para ver mais"})]}),e.jsx("div",{className:"flex gap-6 overflow-x-auto pb-6 scroll-smooth snap-x snap-mandatory",children:p.map(t=>e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>z(t),onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),z(t))},className:"group relative flex-shrink-0 w-[280px] sm:w-[360px] lg:w-[420px] xl:w-[480px] snap-start focus:outline-none cursor-pointer",children:[e.jsxs("div",{className:"absolute left-4 top-4 z-10 flex flex-col gap-2",children:[Q.has(t.id)&&e.jsx("span",{className:"rounded-full bg-brand-600/90 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-white shadow-sm",children:"Em andamento"}),t.created_at&&new Date(t.created_at).getTime()>=Date.now()-ie*864e5&&e.jsx("span",{className:"rounded-full bg-rose-600/90 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-white shadow-sm",children:"Novo"}),A.has(t.id)&&e.jsx("span",{className:"rounded-full bg-white/90 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-900 shadow-sm",children:"Na lista"})]}),e.jsxs("div",{className:"relative rounded-2xl overflow-hidden bg-slate-100 shadow-sm ring-1 ring-slate-200/60 transition duration-300 ease-out transform-gpu group-hover:scale-[1.03] group-hover:-translate-y-1 group-hover:shadow-xl group-focus-visible:scale-[1.03] group-focus-visible:-translate-y-1",children:[t.thumbnail_url?e.jsx("img",{src:t.thumbnail_url,alt:t.title||"Conteúdo",className:"h-64 sm:h-72 lg:h-80 w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-64 sm:h-72 lg:h-80 w-full bg-gradient-to-br from-slate-100 via-slate-200 to-slate-100"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950/80 via-slate-950/20 to-transparent opacity-0 transition duration-300 group-hover:opacity-100 group-focus-visible:opacity-100"}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-5 opacity-0 transition duration-300 group-hover:opacity-100 group-focus-visible:opacity-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.title||"Sem título"}),t.description&&e.jsx("p",{className:"text-sm text-slate-200 mt-2 line-clamp-3",children:t.description}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:s=>{s.stopPropagation(),ee(t.id)},className:"inline-flex items-center gap-2 rounded-full bg-white/95 px-3 py-1 text-xs font-semibold text-slate-900 shadow-sm transition hover:bg-white",children:[e.jsx(Y,{size:14})," Assistir"]}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),Z(t.id)},className:"inline-flex items-center justify-center rounded-full border border-white/40 bg-white/10 p-2 text-white transition hover:bg-white/20","aria-pressed":A.has(t.id),children:A.has(t.id)?e.jsx(le,{size:14}):e.jsx(ae,{size:14})}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),z(t)},className:"inline-flex items-center justify-center rounded-full border border-white/40 bg-white/10 p-2 text-white transition hover:bg-white/20",children:e.jsx(ne,{size:14})})]})]})]}),e.jsxs("div",{className:"mt-3 px-1",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-800 line-clamp-2",children:t.title||"Sem título"}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:t.description})]})]},t.id))})]}),S&&i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/70 backdrop-blur-sm px-4 py-6",onClick:N,children:e.jsxs("div",{className:"w-full max-w-5xl overflow-hidden rounded-3xl bg-slate-950 text-white shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"relative h-56 sm:h-72",children:[i.thumbnail_url?e.jsx("img",{src:i.thumbnail_url,alt:i.title||"Conteúdo",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-slate-800 via-slate-900 to-slate-800"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/40 to-transparent"}),e.jsx("button",{type:"button",onClick:N,className:"absolute right-4 top-4 inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/60 text-white transition hover:bg-black/80","aria-label":"Fechar",children:e.jsx(re,{size:18})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-6 pb-5",children:e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:i.title||"Conteúdo"}),i.description&&e.jsx("p",{className:"text-sm text-slate-200 max-w-2xl line-clamp-3",children:i.description})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",disabled:!D,onClick:()=>D&&J(D),className:"inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm hover:bg-slate-100 disabled:opacity-60",children:[e.jsx(Y,{size:16})," Assistir"]})})]})})]}),e.jsxs("div",{className:"px-6 pb-6 pt-5 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Episódios"}),e.jsxs("span",{className:"text-xs text-slate-400",children:[c.length," módulos"]})]}),g&&e.jsx("div",{className:"py-10 text-center text-sm text-slate-400",children:"Carregando episódios..."}),!g&&b&&e.jsx("div",{className:"mt-4 rounded-xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-200",children:b}),!g&&!b&&c.length===0&&e.jsx("div",{className:"py-10 text-center text-sm text-slate-400",children:"Nenhum episódio cadastrado."}),!g&&!b&&c.length>0&&e.jsx("div",{className:"mt-5 space-y-6",children:c.map((t,s)=>{const r=M[t.id]||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-300",children:[e.jsx("h4",{className:"text-base font-semibold text-white",children:t.title||`Módulo ${s+1}`}),e.jsxs("span",{className:"text-xs text-slate-500",children:[r.length," aula",r.length===1?"":"s"]})]}),r.length===0?e.jsx("div",{className:"text-xs text-slate-400",children:"Nenhuma aula neste módulo."}):e.jsx("div",{className:"space-y-3",children:r.map((n,o)=>e.jsx("button",{type:"button",onClick:()=>J(n.id),className:"group w-full rounded-2xl border border-white/10 bg-white/5 p-3 text-left transition hover:bg-white/10",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"h-20 w-full sm:h-16 sm:w-28 flex-shrink-0 overflow-hidden rounded-xl bg-slate-800",children:t.thumbnail_url?e.jsx("img",{src:t.thumbnail_url,alt:t.title||"Módulo",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-slate-700 via-slate-800 to-slate-700"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[o+1,"."]}),e.jsx("h5",{className:"text-sm font-semibold text-white",children:n.title||"Aula"})]}),n.description&&e.jsx("p",{className:"mt-1 text-xs text-slate-300 line-clamp-2",children:n.description})]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Assistir"})]})},n.id))})]},t.id)})})]})]})})]})};export{ue as C};
