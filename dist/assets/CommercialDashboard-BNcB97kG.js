import{u as T,r as s,j as e}from"./index-HcuLVkXM.js";import{f as L,b as _,a as K}from"./commercial-BJ1Dvjq-.js";import{f as p,a as F}from"./utils-C6qNh0Lg.js";import{L as M}from"./loader-2-CJ7EHZdi.js";import{R as S,n as P,X as Y,Y as I,T as k,p as O,q as X}from"./generateCategoricalChart-B03fitBM.js";import{A as z,a as G}from"./AreaChart-CrBvek2G.js";import{P as V,a as B}from"./PieChart-BNEoZxEj.js";const ee=()=>{const{effectiveClinicId:n}=T(),[R,c]=s.useState(!0),[o,u]=s.useState([]),[h,b]=s.useState([]),[D,y]=s.useState({percentual:0}),[i,f]=s.useState(""),[d,j]=s.useState(""),[x,v]=s.useState(""),[m,N]=s.useState("");s.useEffect(()=>{(async()=>{if(!n){u([]),b([]),y({percentual:0}),c(!1);return}c(!0);const a=await L({clinicId:n,from:i||void 0,to:d||void 0});u(a.revenues),b(_(a));const r=K(a,i||void 0,d||void 0);y({percentual:r.percentual}),c(!1)})()},[n,i,d]);const A=()=>{f(x),j(m)},q=()=>{v(""),N(""),f(""),j("")},E=s.useMemo(()=>{const t={};return o.forEach(a=>{const r=a.data_competencia||a.data_recebimento||"";if(!r)return;const l=r.slice(0,7),w=Number(a.valor_liquido??a.valor??0);t[l]=(t[l]||0)+(isFinite(w)?w:0)}),Object.entries(t).sort(([a],[r])=>a.localeCompare(r)).map(([a,r])=>({month:a,total:r}))},[o]),g=s.useMemo(()=>{const t={};return h.forEach(a=>{a.categorias.forEach(r=>{r&&(t[r]=(t[r]||0)+1)})}),Object.entries(t).map(([a,r])=>({name:a,qty:r})).sort((a,r)=>r.qty-a.qty).slice(0,6)},[h]),C=["#2563eb","#10b981","#f97316","#ef4444","#a855f7","#14b8a6","#0ea5e9"];return R?e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-500",children:[e.jsx(M,{className:"animate-spin mr-2",size:20})," Carregando..."]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Comercial • Dashboard"}),e.jsx("p",{className:"text-gray-500",children:"Visão consolidada de vendas, ticket e recorrência."}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 text-sm text-gray-600",children:"Filtro de data"}),e.jsxs("div",{className:"px-4 py-3 flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"De"}),e.jsx("input",{type:"date",value:x,onChange:t=>v(t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"Até"}),e.jsx("input",{type:"date",value:m,onChange:t=>N(t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-gray-700"})]}),e.jsx("button",{type:"button",onClick:A,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Aplicar"}),(i||d||x||m)&&e.jsx("button",{type:"button",onClick:q,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Limpar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Faturamento total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:p(o.reduce((t,a)=>t+Number(a.valor_liquido??a.valor??0),0))})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Ticket médio global"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:(()=>{const t=o.length||1,a=o.reduce((r,l)=>r+Number(l.valor_liquido??l.valor??0),0);return p(a/t)})()})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"% Recorrência"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[D.percentual.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-4",children:[e.jsx("p",{className:"font-semibold text-gray-800 mb-3",children:"Evolução de vendas"}),e.jsx("div",{className:"h-64",children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(z,{data:E,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(Y,{dataKey:"month",tickFormatter:F}),e.jsx(I,{}),e.jsx(k,{formatter:t=>p(Number(t||0)),labelFormatter:t=>F(String(t))}),e.jsx(G,{type:"monotone",dataKey:"total",stroke:"#2563eb",fill:"#dbeafe"})]})})})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-4",children:[e.jsx("p",{className:"font-semibold text-gray-800 mb-3",children:"Categorias mais vendidas"}),e.jsx("div",{className:"h-64",children:g.length>0?e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(V,{children:[e.jsx(B,{data:g,dataKey:"qty",nameKey:"name",cx:"50%",cy:"50%",outerRadius:90,label:!0,children:g.map((t,a)=>e.jsx(O,{fill:C[a%C.length]},t.name))}),e.jsx(k,{}),e.jsx(X,{})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-sm text-gray-400",children:"Sem dados de categorias."})})]})]})]})};export{ee as default};
