import{c as _,b as P,r as n,j as e,s as l}from"./index-V1BrPv90.js";import{L as N}from"./loader-2-Bvn7HOnG.js";const A=_("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),h=o=>{const s=o.toLowerCase();return s.includes("code verifier")||s.includes("code_verifier")?"Link aberto em outro navegador/dispositivo. Solicite um novo link.":s.includes("invalid")||s.includes("expired")||s.includes("access_denied")?"Link inválido ou expirado. Solicite um novo link.":o},R=(o,s)=>{},B=()=>{const o=P(),[s,a]=n.useState("loading"),[y,t]=n.useState("Validando link de recuperação..."),[u,S]=n.useState(""),[w,C]=n.useState(""),[j,g]=n.useState(!1),[k,m]=n.useState(null);n.useEffect(()=>{(async()=>{try{const r=new URL(window.location.href),x=r.hash.startsWith("#")?r.hash.slice(1):r.hash,L=x.includes("?")?x.split("?")[1]:x,c=new URLSearchParams(L),f=r.searchParams.get("code")||c.get("code"),p=r.searchParams.get("error_description")||r.searchParams.get("error")||c.get("error_description")||c.get("error"),b=c.get("access_token"),v=c.get("refresh_token");if(R("params",{hasCode:!!f,hasAccessToken:!!b,hasRefreshToken:!!v,errorParam:p}),p){a("error"),t(h(p));return}if(f){const{error:d}=await l.auth.exchangeCodeForSession(f);if(d){a("error"),t(h(d.message||"Erro ao validar recuperação."));return}}else if(b&&v){const{error:d}=await l.auth.setSession({access_token:b,refresh_token:v});if(d){a("error"),t(h(d.message||"Erro ao validar recuperação."));return}}const{data:z}=await l.auth.getSession();if(!z.session){a("error"),t("Sessão de recuperação não encontrada. Solicite um novo link.");return}a("ready"),t("Defina sua nova senha.")}catch(r){a("error"),t(h(r?.message||"Erro ao validar recuperação."))}})()},[]);const E=async i=>{if(i.preventDefault(),m(null),u.length<6){m("A senha precisa ter pelo menos 6 caracteres.");return}if(u!==w){m("As senhas não conferem.");return}g(!0);const{error:r}=await l.auth.updateUser({password:u});if(r){m("Erro ao atualizar senha: "+r.message),g(!1);return}await l.auth.signOut(),a("success"),t("Senha atualizada com sucesso. Faça login novamente."),g(!1)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 w-full max-w-md space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-600 text-white flex items-center justify-center",children:e.jsx(A,{size:18})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Redefinir senha"}),e.jsx("p",{className:"text-sm text-gray-500",children:y})]})]}),s==="loading"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(N,{className:"animate-spin",size:16}),"Carregando..."]}),s==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:y}),e.jsx("button",{type:"button",onClick:()=>o("/login"),className:"w-full px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700",children:"Voltar para login"})]}),s==="ready"&&e.jsxs("form",{className:"space-y-4",onSubmit:E,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nova senha"}),e.jsx("input",{type:"password",value:u,onChange:i=>S(i.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirmar nova senha"}),e.jsx("input",{type:"password",value:w,onChange:i=>C(i.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-brand-500"})]}),k&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:k}),e.jsxs("button",{type:"submit",disabled:j,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700 disabled:opacity-50",children:[j&&e.jsx(N,{className:"animate-spin",size:16}),"Atualizar senha"]})]}),s==="success"&&e.jsx("button",{type:"button",onClick:()=>o("/login"),className:"w-full px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700",children:"Ir para login"})]})})};export{B as default};
