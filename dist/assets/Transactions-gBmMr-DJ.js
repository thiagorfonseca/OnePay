import{c as Ha,b as _t,d as vt,u as jt,r as p,R as Oa,j as e,C as Ma,A as Ba,s as y}from"./index-HcuLVkXM.js";import{f as P,b as se}from"./utils-C6qNh0Lg.js";import{u as Ee}from"./useModalControls-BiWM_r1l.js";import{P as Ra}from"./plus-DDz1DOCh.js";import{S as Nt}from"./search-C1xIXvIu.js";import{F as Va}from"./filter-CRrigRAv.js";import{L as za}from"./loader-2-CJ7EHZdi.js";import{D as $a}from"./download-CcofxccE.js";import{T as wt}from"./trash-2-FGsD9cgR.js";import{A as Ct}from"./alert-circle-CadagfFR.js";const Dt=Ha("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),kt=Ha("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),La=["Cartão de Crédito","Cartão de Débito","PIX","Boleto","Dinheiro","Transferência Bancária","Cheque"],Ua=[{value:"C. Credito",label:"C. Credito"},{value:"C. Debito",label:"C. Debito"},{value:"PIX",label:"Pix"},{value:"Boleto",label:"Boleto"},{value:"Dinheiro",label:"Dinheiro"},{value:"Cheque",label:"Cheque"},{value:"Permuta",label:"Permuta"},{value:"Outros",label:"Outros"}],Xa={"Cartão de Crédito":"2.99","Cartão de Débito":"1.50",PIX:"0.50",Boleto:"0",Dinheiro:"0","Transferência Bancária":"0",Cheque:"0"},Ke=(D,n)=>{const N=new Date(D);return N.setDate(N.getDate()+n),N.toISOString().split("T")[0]},ne=(D,n)=>{const N=new Date(D);return N.setMonth(N.getMonth()+n),N.toISOString().split("T")[0]},qt=(D,n)=>{const N=new Date(D);let $=0;for(;$<n;){N.setDate(N.getDate()+1);const re=N.getDay();re!==0&&re!==6&&$++}return N.toISOString().split("T")[0]},St=D=>{if(!D)return"PIX";const n=D.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return n.includes("CREDITO")?"C. Credito":n.includes("DEBITO")?"C. Debito":n.includes("PIX")?"PIX":n.includes("BOLETO")?"Boleto":n.includes("DINHEIRO")||n.includes("CASH")?"Dinheiro":n.includes("CHEQUE")?"Cheque":n.includes("PERMUTA")?"Permuta":(n.includes("OUTRO"),"Outros")},J=D=>Number(D?.valor_bruto??D?.valor??D?.valor_liquido??0)||0,Vt=({type:D})=>{const n=D==="income",N=n?"revenues":"expenses",$=_t(),re=vt(),{effectiveClinicId:Qa}=jt(),I=Qa||null,[Ya,We]=p.useState(!0),[Ze,ea]=p.useState([]),[pe,aa]=p.useState([]),[oe,ta]=p.useState([]),[Fe,sa]=p.useState([]),[Ga,na]=p.useState([]),[K,ra]=p.useState([]),[E,xe]=p.useState([]),[ge,oa]=p.useState(""),[la,ia]=p.useState("1"),[ca,da]=p.useState([]),[we,Ce]=p.useState({venda:"",execucao:""}),[De,H]=p.useState([]),[ua,W]=p.useState(!1),[ma,pa]=p.useState([]),[xa,Ae]=p.useState(""),[ga,ha]=p.useState([]),[V,Oe]=p.useState({tipoDespesa:"",pessoaTipo:"",status:""}),[Q,le]=p.useState("data_competencia"),[q,ie]=p.useState("desc"),[ke,Ja]=p.useState(50),[he,qe]=p.useState(1),[T,Y]=p.useState([]),[F,be]=p.useState({bank_account_id:"",category_id:"",forma_pagamento:"",data_competencia:""}),[Se,Ka]=p.useState("competencia"),[fe,Wa]=p.useState(""),[Z,Za]=p.useState(()=>{const a=new Date;return new Date(a.getFullYear(),a.getMonth(),1).toISOString().split("T")[0]}),[ye,et]=p.useState(()=>{const a=new Date;return new Date(a.getFullYear(),a.getMonth()+1,0).toISOString().split("T")[0]}),[ba,Me]=p.useState(!1),[L,Pe]=p.useState(null),[fa,ya]=p.useState(!1),[_a,_e]=p.useState(!1),[Be,va]=p.useState(!1),[ja,ve]=p.useState(!1),[z,Re]=p.useState(null),[ee,Ve]=p.useState(null),[Na,wa]=p.useState(!1),[U,Ca]=p.useState(null),[ze,$e]=p.useState(""),[Da,Le]=p.useState(!1),ka=Oa.useCallback(()=>{if(!n)return null;const s=new URLSearchParams($.search).get("return_to");if(!s)return null;try{const r=decodeURIComponent(s);return r.startsWith("/")?r:null}catch{return null}},[n,$.search]),Ue=a=>{Me(!1),Re(null),Ve(null),Ye();const s=a?.returnTarget??ka();s&&re(s)},Xe=()=>{wa(!1),Ca(null),$e("")},at=Ee({isOpen:ba,onClose:Ue}),tt=Ee({isOpen:Na,onClose:Xe}),st=Ee({isOpen:!!L,onClose:()=>Pe(null)}),nt=Ee({isOpen:_a,onClose:()=>_e(!1)}),qa={description:"",gross_amount:"",discount:"",tax_rate:Xa.PIX,tax_amount:"0",liquid_amount:"",date:new Date().toISOString().split("T")[0],due_date:new Date().toISOString().split("T")[0],category_id:"",bank_account_id:"",entity_name:"",payment_method:"PIX",observations:"",installments:"1",nsu:"",boleto_due_date:"",cheque_number:"",cheque_bank:"",cheque_due_date:"",cheque_pages:"1",cheque_value:"",is_recurring:!1,recurrence_interval:"mensal",recurrence_count:"1",card_brand:"",tipo_despesa:"",status:"pending",pessoa_tipo:"",is_installment:!1},[t,S]=p.useState(qa),G=async()=>{ea([]),We(!0);try{if(!I){ta([]),aa([]),sa([]),na([]),ra([]),da([]),pa([]),ha([]);return}const{data:{session:a}}=await y.auth.getSession();if(!a)return;const{data:s}=await y.from("categories").select("*").eq("tipo",n?"receita":"despesa");let r=y.from("bank_accounts").select("*");I&&(r=r.eq("clinic_id",I));const{data:l}=await r,{data:u}=await y.from("card_fees").select("*"),{data:c}=await y.from("customers").select("*"),{data:m}=await y.from("procedures").select("*"),{data:x}=await y.from("professionals").select("*"),{data:j}=await y.from("suppliers").select("*"),{data:k}=await y.from("revenues").select("id, data_competencia, paciente");if(s&&aa(s),l){const g=await rt(l);ta(g)}u&&sa(u),c&&na(c),m&&ra(m),x&&da(x),j&&pa(j),k&&ha(k);let _;n?_=y.from(N).select(`
            *,
            categories (name, cor_opcional),
            bank_accounts (nome_conta),
            revenue_procedures (procedimento, categoria, quantidade, valor_cobrado, procedure_id)
          `).order("data_competencia",{ascending:!1}):_=y.from(N).select(`
            *,
            categories (name, cor_opcional),
            bank_accounts (nome_conta)
          `).order("data_competencia",{ascending:!1}),I&&(_=_.eq("clinic_id",I));const A=!n&&Se==="vencimento"?"data_vencimento":"data_competencia";Z&&(_=_.gte(A,Z)),ye&&(_=_.lte(A,ye));const{data:w,error:X}=await _;if(X)throw X;ea(w||[])}catch(a){console.error("Erro ao buscar dados:",a)}finally{We(!1)}};p.useEffect(()=>{G()},[D,Z,ye,Se,I]),p.useEffect(()=>{const a=x=>{const j=(x||"").replace(",","."),k=parseFloat(j);return isNaN(k)?0:k},s=a(t.gross_amount),r=a(t.discount),l=Math.max(0,s-r),u=a(t.tax_rate);if(!t.gross_amount&&!E.length){S(x=>({...x,tax_amount:"0",liquid_amount:""}));return}const c=l*(u/100),m=l-c;S(x=>({...x,tax_amount:c.toFixed(2),liquid_amount:m.toFixed(2)}))},[t.gross_amount,t.tax_rate]),p.useEffect(()=>{if(t.payment_method==="Cartão de Crédito"||t.payment_method==="Cartão de Débito"){const s=parseInt(t.installments||"1",10)||1,r=Fe.find(l=>(!t.card_brand||l.bandeira===t.card_brand)&&s>=(l.min_installments||1)&&s<=(l.max_installments||1));if(r){S(l=>({...l,tax_rate:String(r.taxa_percent||"0"),card_brand:r.bandeira}));return}}const a=Xa[t.payment_method]??t.tax_rate;S(s=>({...s,tax_rate:a}))},[t.payment_method,t.installments,t.card_brand,Fe]),p.useEffect(()=>{if(!n||!E.length)return;const a=E.reduce((s,r)=>{const l=K.find(c=>c.id===r.id),u=l?.valor_cobrado?Number(l.valor_cobrado):0;return s+u*(r.quantidade||1)},0);S(s=>({...s,gross_amount:a.toFixed(2)}))},[E,K,n]);const b=a=>{const{name:s,value:r,type:l,checked:u}=a.target;if(l==="checkbox"){if(s==="is_recurring"){S(c=>({...c,is_recurring:u,is_installment:u?!1:c.is_installment}));return}if(s==="is_installment"){S(c=>({...c,is_installment:u,is_recurring:u?!1:c.is_recurring,...u?{}:{installments:"1"}}));return}S(c=>({...c,[s]:u}));return}s==="due_date"&&Le(!0),S(c=>({...c,[s]:r}))};p.useEffect(()=>{if(n){S(s=>s.due_date===s.date?s:{...s,due_date:s.date});return}if(Da)return;const a=t.payment_method==="Cartão de Crédito"?Ke(t.date,30):t.date;S(s=>s.due_date===a?s:{...s,due_date:a})},[t.payment_method,t.date,n,Da]);const Sa=a=>{if(!a)return[];try{const s=Array.isArray(a)?a:typeof a=="string"?JSON.parse(a):[];return Array.isArray(s)?s.map(r=>typeof r=="string"?{vencimento:r}:!r||typeof r!="object"?null:{vencimento:r.vencimento||r.due_date||r.data||r.date||"",numero_folha:r.numero_folha||r.folha||r.numero||""}).filter(Boolean):[]}catch{return[]}},Pa=()=>{const a=De.map(s=>s.vencimento).filter(Boolean);if((t.payment_method==="Boleto"||t.payment_method==="Cheque")&&a.length)return a[0];switch(t.payment_method){case"Cartão de Crédito":return Ke(t.date,30);case"Cartão de Débito":return qt(t.date,1);case"PIX":case"Dinheiro":case"Transferência Bancária":return t.date;case"Boleto":return t.boleto_due_date||t.date;case"Cheque":return t.cheque_due_date||t.date;default:return t.date}};p.useEffect(()=>{if(!n)return;const a=t.payment_method;if(a!=="Boleto"&&a!=="Cheque"){H([]),W(!1);return}const s=a==="Cheque"?Math.max(1,parseInt(t.cheque_pages||"1",10)||1):Math.max(1,parseInt(t.installments||"1",10)||1);if(s<=1){H([]),W(!1);return}const r=a==="Cheque"?t.cheque_due_date||t.date:t.boleto_due_date||t.date;H(l=>{if(!ua||l.length===0)return Array.from({length:s}).map((m,x)=>({vencimento:r?x===0?r:ne(r,x):"",...a==="Cheque"?{numero_folha:""}:{}}));const c=[...l];for(let m=0;m<s;m+=1)c[m]?(c[m].vencimento||(c[m].vencimento=r?m===0?r:ne(r,m):""),a==="Cheque"&&c[m].numero_folha===void 0&&(c[m].numero_folha="")):c[m]={vencimento:r?m===0?r:ne(r,m):"",...a==="Cheque"?{numero_folha:""}:{}};return c.slice(0,s)})},[t.payment_method,t.installments,t.boleto_due_date,t.cheque_due_date,t.cheque_pages,t.date,n,ua]);const He=a=>{if(typeof a=="string"){const r=Number(a.replace(",","."));return isNaN(r)?0:r}const s=Number(a||0);return isNaN(s)?0:s},ce=async(a,s)=>{if(!a)return;const r=oe.find(c=>c.id===a);if(!r)return;const u=He(r.current_balance??r.initial_balance??0)+s;await y.from("bank_accounts").update({current_balance:u}).eq("id",a)},je=(a,s)=>s==="income"?!1:a==="paid",rt=async a=>{if(!I||a.length===0)return a;const[s,r]=await Promise.all([y.from("revenues").select("bank_account_id, valor_liquido, valor_bruto, valor, status, data_competencia, data_recebimento, parcelas, forma_pagamento, recebimento_parcelas").eq("clinic_id",I),y.from("expenses").select("bank_account_id, valor, status").eq("clinic_id",I).eq("status","paid")]),l=s.data||[],u=r.data||[],c=i=>{if(!i)return null;const o=new Date(i);if(!Number.isNaN(o.getTime()))return o;const d=new Date(`${i}T00:00:00`);return Number.isNaN(d.getTime())?null:d},m=(i,o)=>{const d=new Date(i);return d.setDate(d.getDate()+o),d},x=(i,o)=>{const d=new Date(i);let h=0;for(;h<o;){d.setDate(d.getDate()+1);const f=d.getDay();f!==0&&f!==6&&(h+=1)}return d},j=(i,o)=>{const d=new Date(i);return d.setMonth(d.getMonth()+o),d},k=i=>{const o=(i||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return o.includes("CREDITO")?"CREDITO":o.includes("DEBITO")?"DEBITO":o.includes("PIX")?"PIX":o.includes("BOLETO")?"BOLETO":o.includes("CHEQUE")?"CHEQUE":o.includes("TRANSFER")||o.includes("TED")||o.includes("DOC")?"TRANSFERENCIA":o.includes("CONVENIO")?"CONVENIO":o.includes("DINHEIRO")||o.includes("CASH")?"DINHEIRO":"OUTRO"},_=(i,o)=>{const d=Math.floor(i/o*100)/100,h=Array(o).fill(d),f=d*o,v=Math.round((i-f)*100)/100;return h[h.length-1]=Math.round((h[h.length-1]+v)*100)/100,h},A=new Date;A.setHours(0,0,0,0);const w=i=>{const o=Number(i.valor_liquido??i.valor_bruto??i.valor??0);if(!Number.isFinite(o)||o===0)return 0;const d=Sa(i.recebimento_parcelas).map(R=>c(R.vencimento)).filter(Boolean),h=Math.max(1,d.length||parseInt(i.parcelas||"1",10)||1),f=k(i.forma_pagamento),v=c(i.data_recebimento),C=c(i.data_competencia);let O=null;if(f==="BOLETO"||f==="CHEQUE"?O=v||C:f==="CREDITO"||f==="CONVENIO"?O=v||(C?m(C,30):null):f==="DEBITO"?O=v||(C?x(C,1):null):O=v||C,!O&&d.length===0)return 0;const me=f==="CREDITO"||f==="CONVENIO"?30:0,Je=_(o,h);let Aa=0;for(let R=0;R<h;R+=1){let Te=d[R]||O;Te&&(d[R]||(me&&R>0?Te=m(O,me*R):!me&&h>1&&R>0&&(Te=j(O,R))),Te<=A&&(Aa+=Je[R]||0))}return Aa},X=new Map;l.forEach(i=>{if(!i.bank_account_id)return;const o=w(i);!Number.isFinite(o)||o===0||X.set(i.bank_account_id,(X.get(i.bank_account_id)||0)+o)});const g=new Map;u.forEach(i=>{if(!i.bank_account_id)return;const o=Number(i.valor??0);Number.isFinite(o)&&g.set(i.bank_account_id,(g.get(i.bank_account_id)||0)+o)});const B=[],ue=a.map(i=>{const o=He(i.initial_balance??0),d=X.get(i.id)||0,h=g.get(i.id)||0,f=o+d-h,v=He(i.current_balance??i.initial_balance??0);return Math.abs(v-f)>.009&&B.push({id:i.id,current_balance:f}),{...i,current_balance:f}});return B.length&&await Promise.all(B.map(i=>y.from("bank_accounts").update({current_balance:i.current_balance}).eq("id",i.id))),ue},ot=async a=>{if(a.preventDefault(),ve(!0),!I){alert("Nenhuma clínica ativa definida. Selecione uma clínica para lançar."),ve(!1);return}try{const s=i=>{const o=(i||"").replace(",","."),d=parseFloat(o);return isNaN(d)?0:d},r=s(t.gross_amount),l=s(t.discount),u=s(t.tax_amount),c=Math.max(0,r-l),m=t.liquid_amount?s(t.liquid_amount):c,x=n&&t.payment_method==="Boleto",j=n&&t.payment_method==="Cheque",k=j?Math.max(1,parseInt(t.cheque_pages||"1",10)||1):Math.max(1,parseInt(t.installments||"1",10)||1),_=(x||j)&&k>1?De.slice(0,k):[];if(n&&(t.payment_method==="Cartão de Crédito"||t.payment_method==="Cartão de Débito")&&!t.nsu.trim()){alert("Informe o NSU para pagamentos em cartão de crédito ou débito."),ve(!1);return}if((x||j)&&k>1&&(_.length!==k||_.some(o=>!o.vencimento))){alert("Informe o vencimento de todas as parcelas."),ve(!1);return}const A=_.length?_[0].vencimento:Pa(),w=[];n&&(w.push(`Taxa aplicada: ${t.tax_rate}% (R$ ${u.toFixed(2)})`),w.push(`Liquidação prevista: ${A}`)),t.payment_method.includes("Cartão")&&t.nsu&&w.push(`NSU: ${t.nsu}`),t.payment_method==="Cartão de Crédito"&&t.installments&&w.push(`Parcelas: ${t.installments}`),t.payment_method==="Boleto"&&(t.installments&&w.push(`Parcelas boleto: ${t.installments}`),t.boleto_due_date&&w.push(`Vencimento boleto: ${t.boleto_due_date}`),_.length>1&&w.push("Vencimentos boleto definidos manualmente")),t.payment_method==="Cheque"&&(t.cheque_number&&w.push(`Cheque nº ${t.cheque_number}`),t.cheque_bank&&w.push(`Banco cheque: ${t.cheque_bank}`),t.cheque_due_date&&w.push(`Vencimento cheque: ${t.cheque_due_date}`),t.cheque_pages&&w.push(`Folhas: ${t.cheque_pages}`),t.cheque_value&&w.push(`Valor/f.: R$ ${t.cheque_value}`),_.length>1&&w.push("Vencimentos de cheques definidos manualmente")),t.observations&&w.push(t.observations);const g={description:n?t.entity_name||(E[0]?K.find(i=>i.id===E[0].id)?.procedimento:"")||"Receita":t.description||"Despesa",data_competencia:t.date,category_id:n?null:t.category_id,bank_account_id:t.bank_account_id,observacoes:["Inserido via Web",...w].filter(Boolean).join(" | "),clinic_id:I};if(n)g.valor_bruto=r,g.valor_liquido=m,g.valor=m,g.data_recebimento=A,g.paciente=t.entity_name,g.forma_pagamento=t.payment_method,g.parcelas=k,g.forma_pagamento_taxa=t.tax_rate,g.bandeira=t.card_brand||null,g.recebimento_parcelas=_.length?_.map((i,o)=>({parcela:o+1,vencimento:i.vencimento,numero_folha:i.numero_folha?i.numero_folha:null})):null,x&&(g.boleto_due_date=t.boleto_due_date||A||null),j&&(g.cheque_number=t.cheque_number||null,g.cheque_bank=t.cheque_bank||null,g.cheque_due_date=t.cheque_due_date||A||null,g.cheque_pages=k,g.cheque_value=t.cheque_value?s(t.cheque_value):null),l>0&&w.push(`Desconto aplicado: R$ ${l.toFixed(2)}`),g.sale_professional_id=we.venda||null,g.exec_professional_id=we.execucao||null;else{g.valor=r;const i=t.due_date||t.date;g.data_vencimento=i;const o=ee?.data_pagamento||null;g.data_pagamento=t.status==="paid"?o||i:null,g.fornecedor=t.entity_name,g.supplier_id=xa||null,g.tipo_despesa=t.tipo_despesa||"variavel",g.parcelas=t.is_installment?t.installments:"1",g.forma_pagamento=t.payment_method,g.pessoa_tipo=t.pessoa_tipo||null,g.status=t.status||"pending"}let B=null;if(z){const{error:i}=await y.from(N).update(g).eq("id",z);if(i)throw i;B=z}else if(!n&&t.is_recurring){const i=Math.max(1,parseInt(t.recurrence_count||"1",10)),o=t.recurrence_interval,d=(v,C)=>C===0?v:o==="quinzenal"?Ke(v,15*C):o==="mensal"?ne(v,C):o==="trimestral"?ne(v,3*C):o==="anual"?ne(v,12*C):v,h=Array.from({length:i}).map((v,C)=>({...g,data_vencimento:d(t.due_date||t.date,C),data_pagamento:t.status==="paid"?d(t.due_date||t.date,C):null,data_competencia:d(t.date,C),clinic_id:I})),{error:f}=await y.from(N).insert(h);if(f)throw f}else if(!n&&t.is_installment&&parseInt(t.installments||"1",10)>1){const i=Math.max(1,parseInt(t.installments||"1",10)),o=t.due_date||t.date,d=r,h=Math.floor(d*100/i),f=Array.from({length:i}).map((C,O)=>{const me=O===0?o:ne(o,O),Je=O===i-1?Math.round(d*100-h*(i-1)):h;return{...g,clinic_id:I,valor:Je/100,data_vencimento:me,data_pagamento:t.status==="paid"?me:null,data_competencia:t.date,parcelas:1}}),{error:v}=await y.from(N).insert(f);if(v)throw v}else{const{data:i,error:o}=await y.from(N).insert([g]).select("id").maybeSingle();if(o)throw o;B=i?.id||null}if(n&&(z||B)&&E.length){const i=z||B;if(!i)return;await y.from("revenue_procedures").delete().eq("revenue_id",i);const o=E.map(d=>{const h=K.find(f=>f.id===d.id);return{revenue_id:i,procedure_id:d.id,categoria:h?.categoria||null,procedimento:h?.procedimento||null,valor_cobrado:h?.valor_cobrado||null,quantidade:d.quantidade||1}});if(o.length){const{error:d}=await y.from("revenue_procedures").insert(o);if(d)throw d}}else n&&z&&!E.length&&await y.from("revenue_procedures").delete().eq("revenue_id",z);if(z&&ee){const i=ee.bank_account_id,o=Number(n?ee.valor_liquido??ee.valor??0:ee.valor??0);if(je(ee.status,n?"income":"expense")){const v=n?o:-o;await ce(i,-v)}const h=n?m:r;if(je(t.status,n?"income":"expense")){const v=n?h:-h;await ce(t.bank_account_id,v)}}else{const i=n?m:r;if(je(t.status,n?"income":"expense")){let d=n?i:-i;if(!n&&t.is_recurring){const h=Math.max(1,parseInt(t.recurrence_count||"1",10));d=d*h}await ce(t.bank_account_id,d)}}const ue=ka();ue||G(),Ue({returnTarget:ue})}catch(s){alert("Erro ao salvar: "+s.message)}finally{ve(!1)}},lt=async()=>{if(L){ya(!0);try{const{error:a}=await y.from(N).delete().eq("id",L.id);if(a)throw a;if(L.shouldAffect){const s=n?-L.amount:L.amount;await ce(L.accountId,s)}G()}catch(a){console.error(a)}finally{ya(!1),Pe(null)}}},it=a=>{Re(a.id),Ve(a);const s=n?a.valor_bruto||a.valor||a.valor_liquido||0:a.valor||0,r=n&&a.valor_liquido||s,l=n&&s?((s-r)/s*100).toFixed(2):"0",u=(a.forma_pagamento||"").toLowerCase().includes("boleto"),c=(a.forma_pagamento||"").toLowerCase().includes("cheque"),m=Sa(a.recebimento_parcelas),x=a.data_competencia||new Date().toISOString().split("T")[0],j=a.data_vencimento||a.data_pagamento||a.data_recebimento||a.data_competencia||new Date().toISOString().split("T")[0];S({description:a.description||"",gross_amount:String(s),discount:"",tax_rate:String(l),tax_amount:n&&s?(s-r).toFixed(2):"0",liquid_amount:n?String(r):"",date:x,due_date:j,category_id:a.category_id||"",bank_account_id:a.bank_account_id||"",entity_name:n?a.paciente||"":a.fornecedor||"",payment_method:n?a.forma_pagamento||"PIX":St(a.forma_pagamento),observations:a.observacoes||"",installments:a.parcelas?String(a.parcelas):"1",nsu:a.nsu||"",boleto_due_date:a.boleto_due_date||a.boleto_vencimento||(u?a.data_recebimento:"")||"",cheque_number:a.cheque_number||"",cheque_bank:a.cheque_bank||"",cheque_due_date:a.cheque_due_date||(c?a.data_recebimento:"")||"",cheque_pages:a.cheque_pages?String(a.cheque_pages):a.parcelas?String(a.parcelas):"1",cheque_value:a.cheque_value?String(a.cheque_value):"",is_recurring:!1,recurrence_interval:"mensal",recurrence_count:"1",card_brand:a.bandeira||"",tipo_despesa:a.tipo_despesa||"",status:a.status||"pending",pessoa_tipo:a.pessoa_tipo||"",is_installment:n?!1:(a.parcelas||1)>1}),Le(!n&&j!==x),H(m),W(m.length>0),xe([]),Ce({venda:"",execucao:""}),Ae(a.supplier_id||""),Me(!0)},de=Ze.filter(a=>!(!((a.description||"").toLowerCase().includes(fe.toLowerCase())||(a.paciente||"").toLowerCase().includes(fe.toLowerCase())||(a.fornecedor||"").toLowerCase().includes(fe.toLowerCase()))||!n&&(V.tipoDespesa&&(a.tipo_despesa||"")!==V.tipoDespesa||V.pessoaTipo&&(a.pessoa_tipo||"")!==V.pessoaTipo||V.status&&(a.status||"")!==V.status))),Ne=[...de].sort((a,s)=>{const r=q==="asc"?1:-1,l=m=>{switch(Q){case"description":return(m.description||"").toLowerCase();case"paciente":return(m.paciente||m.fornecedor||"").toLowerCase();case"data_competencia":return m.data_competencia||"";case"data_vencimento":return m.data_vencimento||m.data_pagamento||"";case"categoria":return m.categories?.name||m.revenue_procedures?.[0]?.categoria||"";case"valor":return Number(n?J(m):m.valor);default:return""}},u=l(a),c=l(s);return u<c?-1*r:u>c?1*r:0});p.useEffect(()=>{qe(1),Y([])},[Q,q,fe,V,Z,ye,Se,D]);const Qe=Math.max(1,Math.ceil(Ne.length/ke)),Ie=Ne.slice((he-1)*ke,he*ke),ae=Ne.map(a=>a.id),Ia=ae.length>0&&ae.every(a=>T.includes(a)),ct=()=>{if(!ge)return;const a=Math.max(1,parseInt(la||"1",10));xe(s=>s.find(l=>l.id===ge)?s.map(l=>l.id===ge?{...l,quantidade:l.quantidade+a}:l):[...s,{id:ge,quantidade:a}]),oa(""),ia("1")},dt=E.reduce((a,s)=>{const r=K.find(u=>u.id===s.id),l=r?.valor_cobrado?Number(r.valor_cobrado):0;return a+l*(s.quantidade||1)},0),Ta=a=>{const s=Number(a||0);return Number.isFinite(s)?s.toFixed(2).replace(".",","):"0"},Ea=a=>{if(a==null)return"";const s=String(a);return/[";\n]/.test(s)?`"${s.replace(/"/g,'""')}"`:s},Fa=a=>{const s=n?["Descrição","Paciente","Data","Categoria","Forma pag.","Valor faturado"]:["Descrição","Fornecedor","Data","Vencimento","Categoria","Status","Valor"],r=Ne.map(l=>n?[l.description||"",l.paciente||"-",se(l.data_competencia),l.categories?.name||l.revenue_procedures?.[0]?.categoria||"Geral",l.forma_pagamento||"-",Ta(J(l))]:[l.description||"",l.fornecedor||"-",se(l.data_competencia),se(l.data_vencimento||l.data_pagamento),l.categories?.name||l.revenue_procedures?.[0]?.categoria||"Geral",l.status==="paid"?"Pago":"À pagar",Ta(l.valor)]);if(a==="csv"){const u=`\uFEFF${[s.map(Ea).join(";"),...r.map(j=>j.map(Ea).join(";"))].join(`
`)}`,c=new Blob([u],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(c),x=document.createElement("a");x.href=m,x.setAttribute("download",`${n?"receitas":"despesas"}-filtrado.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x);return}if(a==="pdf"){const l=r.map(c=>`<tr>${c.map(m=>`<td style="padding:6px;border:1px solid #ddd;font-size:12px;">${m}</td>`).join("")}</tr>`).join(""),u=window.open("","_blank");if(!u)return;u.document.write(`
        <html><head><title>${n?"Receitas":"Despesas"}</title>
        <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
        </head><body>
        <h3>${n?"Receitas":"Despesas"} (filtrado)</h3>
        <table>
          <thead><tr>${s.map(c=>`<th>${c}</th>`).join("")}</tr></thead>
          <tbody>${l}</tbody>
        </table>
        </body></html>
      `),u.document.close(),u.print()}},ut=a=>{Y(s=>s.includes(a)?s.filter(r=>r!==a):[...s,a])},mt=()=>{const a=Ie.map(r=>r.id),s=a.every(r=>T.includes(r));Y(s?r=>r.filter(l=>!a.includes(l)):r=>Array.from(new Set([...r,...a])))},pt=()=>{if(ae.length!==0){if(Ia){Y(a=>a.filter(s=>!ae.includes(s)));return}Y(a=>Array.from(new Set([...a,...ae])))}},xt=async()=>{if(T.length===0){alert("Selecione ao menos um registro.");return}const a={};if(F.bank_account_id&&(a.bank_account_id=F.bank_account_id),F.category_id&&(a.category_id=F.category_id),F.forma_pagamento&&(a.forma_pagamento=F.forma_pagamento),F.data_competencia&&(a.data_competencia=F.data_competencia),Object.keys(a).length===0){alert("Escolha pelo menos um campo para atualizar.");return}try{const{error:s}=await y.from(N).update(a).in("id",T);if(s)throw s;Y([]),be({bank_account_id:"",category_id:"",forma_pagamento:"",data_competencia:""}),G()}catch(s){alert("Erro ao atualizar em massa: "+s.message)}},gt=async()=>{if(T.length===0){alert("Selecione ao menos um registro.");return}_e(!0)},ht=async()=>{if(T.length===0){_e(!1);return}va(!0);try{for(const a of T){const s=Ze.find(c=>c.id===a);if(!s)continue;const r=Number(n?s.valor_liquido||0:s.valor||0),l=s.bank_account_id,{error:u}=await y.from(N).delete().eq("id",a);if(u)throw u;if(je(s.status,n?"income":"expense")){const c=n?-r:r;await ce(l,c)}}_e(!1),Y([]),G()}catch(a){alert("Erro ao excluir em massa: "+a.message)}finally{va(!1)}},bt=Pa(),ft=Math.max(1,parseInt(t.installments||"1",10)||1),yt=Math.max(1,parseInt(t.cheque_pages||"1",10)||1),M=p.useMemo(()=>{if(!n)return null;const a=o=>Number(o||0),s=de,r=s.reduce((o,d)=>o+a(J(d)),0),l=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("crédito")||(o.forma_pagamento||"").toLowerCase().includes("credito")).reduce((o,d)=>o+a(J(d)),0),u=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("débito")||(o.forma_pagamento||"").toLowerCase().includes("debito")).reduce((o,d)=>o+a(J(d)),0),c=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("pix")).reduce((o,d)=>o+a(J(d)),0),m=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("dinheiro")).reduce((o,d)=>o+a(J(d)),0),x=Array.from(new Set(s.map(o=>(o.paciente||"").trim()).filter(Boolean))),j=x.length?r/x.length:0,k=s.reduce((o,d)=>{const h=d.revenue_procedures||[];return h.length?o+h.reduce((f,v)=>f+(v.quantidade||0),0):o},0),_=x.length,A=Z||new Date().toISOString().split("T")[0],X=new Date(A).getFullYear()-1,B=x.filter(o=>ga.some(d=>d.paciente?(d.data_competencia?new Date(d.data_competencia).getFullYear():0)<=X&&d.paciente===o:!1)).length,ue=_?B/_*100:0,i=Math.max(0,_-B);return{totalReceita:r,totalCredito:l,totalDebito:u,totalPix:c,ticketMedio:j,procedimentosRealizados:k,clientesAtendidos:_,recorrenciaPercent:ue,novosClientes:i,totalDinheiro:m}},[de,n,ga,Z]),te=p.useMemo(()=>{if(n)return null;const a=de,s=a.reduce((x,j)=>x+Number(j.valor||0),0),r=a.length,l=a.filter(x=>x.tipo_despesa==="fixo").reduce((x,j)=>x+Number(j.valor||0),0),u=a.filter(x=>x.tipo_despesa==="variavel").reduce((x,j)=>x+Number(j.valor||0),0),c=s?l/s*100:0,m=s?u/s*100:0;return{total:s,quantidade:r,totalFixo:l,totalVar:u,pctFixo:c,pctVar:m}},[de,n]),Ye=()=>{S(qa),Le(!1),xe([]),Ce({venda:"",execucao:""}),Ae(""),H([]),W(!1)},Ge=Oa.useCallback(()=>{Re(null),Ve(null),Ye(),Me(!0)},[Ye]);return p.useEffect(()=>{if(!n)return;const a=new URLSearchParams($.search);if(a.get("new")!=="1")return;Ge(),a.delete("new");const s=a.toString();re(`${$.pathname}${s?`?${s}`:""}`,{replace:!0})},[n,$.pathname,$.search,re,Ge]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:n?"Receitas":"Despesas"}),e.jsxs("p",{className:"text-gray-500",children:["Gerencie ",n?"os recebimentos":"os pagamentos"," da clínica"]})]}),!n&&e.jsxs("button",{onClick:Ge,className:`
              flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition-colors shadow-sm
              ${n?"bg-brand-600 hover:bg-brand-700":"bg-red-600 hover:bg-red-700"}
            `,children:[e.jsx(Ra,{size:20}),"Nova ",n?"Receita":"Despesa"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 lg:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[220px]",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:n?"Buscar por descrição ou paciente...":"Buscar por descrição ou fornecedor...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500",value:fe,onChange:a=>Wa(a.target.value)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative min-w-[160px]",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(Ma,{size:16})}),e.jsx("input",{type:"date",value:Z,onChange:a=>Za(a.target.value),className:"pl-9 pr-3 py-2 w-full border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 text-sm text-gray-600"})]}),e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsxs("div",{className:"relative min-w-[160px]",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(Ma,{size:16})}),e.jsx("input",{type:"date",value:ye,onChange:a=>et(a.target.value),className:"pl-9 pr-3 py-2 w-full border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 text-sm text-gray-600"})]}),!n&&e.jsxs("select",{value:Se,onChange:a=>Ka(a.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"competencia",children:"Data de competência"}),e.jsx("option",{value:"vencimento",children:"Data de vencimento"})]}),n&&e.jsxs("button",{onClick:G,className:"flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors",children:[e.jsx(Va,{size:20}),"Filtrar"]})]})]}),!n&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:V.tipoDespesa,onChange:a=>Oe(s=>({...s,tipoDespesa:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"",children:"Tipo (fixo/variável)"}),e.jsx("option",{value:"fixo",children:"Fixo"}),e.jsx("option",{value:"variavel",children:"Variável"})]}),e.jsxs("select",{value:V.pessoaTipo,onChange:a=>Oe(s=>({...s,pessoaTipo:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"",children:"Pessoa (F/J)"}),e.jsx("option",{value:"fisica",children:"Pessoa Física"}),e.jsx("option",{value:"juridica",children:"Pessoa Jurídica"})]}),e.jsxs("select",{value:V.status,onChange:a=>Oe(s=>({...s,status:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[140px]",children:[e.jsx("option",{value:"",children:"Status"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"pending",children:"À pagar"})]}),e.jsxs("button",{onClick:G,className:"flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors",children:[e.jsx(Va,{size:20}),"Filtrar"]})]})]}),n&&M&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Receita Faturada"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.totalReceita)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Crédito"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.totalCredito)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Débito"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.totalDebito)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Pix"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.totalPix)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Dinheiro"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.totalDinheiro)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Ticket médio"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(M.ticketMedio)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Procedimentos realizados"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:M.procedimentosRealizados})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Clientes atendidos"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:M.clientesAtendidos})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Recorrência"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[M.recorrenciaPercent.toFixed(1),"% • Novos: ",M.novosClientes]})]})]}),!n&&te&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Despesas"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(te.total)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Quantidade de compras"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:te.quantidade})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Fixo"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[P(te.totalFixo)," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",te.pctFixo.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Variável"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[P(te.totalVar)," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",te.pctVar.toFixed(1),"%)"]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Linhas por página:"}),e.jsxs("select",{value:ke,onChange:a=>{Ja(parseInt(a.target.value,10)),qe(1)},className:"border border-gray-300 rounded px-2 py-1 text-sm bg-white",children:[e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",Ne.length]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("button",{onClick:()=>qe(a=>Math.max(1,a-1)),disabled:he===1,className:"px-2 py-1 border border-gray-300 rounded disabled:opacity-50",children:"‹"}),e.jsxs("span",{className:"px-2",children:["Página ",he," / ",Qe]}),e.jsx("button",{onClick:()=>qe(a=>Math.min(Qe,a+1)),disabled:he===Qe,className:"px-2 py-1 border border-gray-300 rounded disabled:opacity-50",children:"›"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden min-h-[300px]",children:Ya?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx(za,{size:32,className:"animate-spin mb-2"}),e.jsx("p",{children:"Carregando dados..."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col gap-2 px-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Selecionados: ",T.length]}),e.jsx("button",{onClick:pt,disabled:ae.length===0,className:"px-3 py-1 text-xs rounded border border-gray-200 text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:Ia?"Desmarcar todos os registros":`Selecionar todos os registros (${ae.length})`}),e.jsxs("select",{value:F.bank_account_id,onChange:a=>be(s=>({...s,bank_account_id:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Banco (manter)"}),oe.map(a=>e.jsx("option",{value:a.id,children:a.nome_conta||a.name},a.id))]}),e.jsxs("select",{value:F.category_id,onChange:a=>be(s=>({...s,category_id:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Categoria (manter)"}),pe.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs("select",{value:F.forma_pagamento,onChange:a=>be(s=>({...s,forma_pagamento:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Forma pgto (manter)"}),n?La.map(a=>e.jsx("option",{value:a,children:a},a)):Ua.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsx("input",{type:"date",value:F.data_competencia,onChange:a=>be(s=>({...s,data_competencia:a.target.value})),className:"px-2 py-1 border rounded text-sm",placeholder:"Data"}),e.jsx("button",{onClick:xt,className:"px-3 py-1 text-xs rounded bg-brand-600 text-white hover:bg-brand-700",disabled:T.length===0,children:"Aplicar edição em massa"}),e.jsx("button",{onClick:gt,className:"px-3 py-1 text-xs rounded border border-red-200 text-red-600 hover:bg-red-50",disabled:T.length===0,children:"Excluir selecionados"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{onClick:()=>Fa("csv"),className:"flex items-center gap-1 px-3 py-2 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx($a,{size:14})," CSV"]}),e.jsxs("button",{onClick:()=>Fa("pdf"),className:"flex items-center gap-1 px-3 py-2 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx($a,{size:14})," PDF"]})]})]}),e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100 text-gray-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"accent-brand-600",onChange:mt,checked:Ie.length>0&&Ie.every(a=>T.includes(a.id))})}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("description"),ie(q==="asc"?"desc":"asc")},children:["Descrição ",Q==="description"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("paciente"),ie(q==="asc"?"desc":"asc")},children:[n?"Paciente":"Fornecedor"," ",Q==="paciente"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("data_competencia"),ie(q==="asc"?"desc":"asc")},children:["Data ",Q==="data_competencia"&&(q==="asc"?"▲":"▼")]}),!n&&e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("data_vencimento"),ie(q==="asc"?"desc":"asc")},children:["Vencimento ",Q==="data_vencimento"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("categoria"),ie(q==="asc"?"desc":"asc")},children:["Categoria ",Q==="categoria"&&(q==="asc"?"▲":"▼")]}),n&&e.jsx("th",{className:"px-6 py-4",children:"Forma Pag."}),!n&&e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsxs("th",{className:"px-6 py-4 text-right cursor-pointer",onClick:()=>{le("valor"),ie(q==="asc"?"desc":"asc")},children:[n?"Valor faturado":"Valor"," ",Q==="valor"&&(q==="asc"?"▲":"▼")]}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Ie.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"accent-brand-600",checked:T.includes(a.id),onChange:()=>ut(a.id)})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-800",children:a.description}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:n?a.paciente||"-":a.fornecedor||"-"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:se(a.data_competencia)}),!n&&e.jsx("td",{className:"px-6 py-4 text-gray-600",children:se(a.data_vencimento||a.data_pagamento)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium",style:{backgroundColor:(a.categories?.cor_opcional||"#e5e7eb")+"20",color:a.categories?.cor_opcional||"#374151"},children:a.categories?.name||a.revenue_procedures?.[0]?.categoria||"Geral"})}),n&&e.jsx("td",{className:"px-6 py-4 text-gray-600 text-xs",children:a.forma_pagamento}),!n&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a.status==="paid"?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:a.status==="paid"?"Pago":"À pagar"})}),e.jsx("td",{className:`px-6 py-4 font-medium text-right ${n?"text-green-600":"text-red-600"}`,children:P(n?J(a):a.valor)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>it(a),className:"p-1 text-gray-400 hover:text-brand-600 transition-colors",title:"Editar",children:e.jsx(kt,{size:16})}),!n&&e.jsx("button",{onClick:()=>{Ca(a),$e(a.data_pagamento||new Date().toISOString().split("T")[0]),wa(!0)},className:"p-1 text-gray-400 hover:text-emerald-600 transition-colors",title:"Registrar data de pagamento",children:e.jsx(Dt,{size:16})}),e.jsx("button",{onClick:()=>Pe({id:a.id,amount:Number(n?a.valor_liquido:a.valor),accountId:a.bank_account_id,description:a.description,shouldAffect:je(a.status,n?"income":"expense")}),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Excluir",children:e.jsx(wt,{size:16})})]})})]},a.id)),de.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:n?8:9,className:"px-6 py-12 text-center text-gray-400",children:"Nenhum lançamento encontrado no período."})})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",onClick:st.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(Ba,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Você está prestes a excluir ",n?"esta receita":"esta despesa",". Essa ação não pode ser desfeita."]})]})]}),e.jsxs("div",{className:"p-5 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Descrição:"})," ",L.description||"Sem descrição"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"O saldo da conta será ajustado automaticamente."})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>Pe(null),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:lt,disabled:fa,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:fa?"Excluindo...":"Sim, excluir"})]})]})}),_a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",onClick:nt.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(Ba,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Você está prestes a excluir ",T.length," registro(s). Essa ação não pode ser desfeita."]})]})]}),e.jsx("div",{className:"p-5 space-y-2",children:e.jsx("p",{className:"text-sm text-gray-700",children:"O saldo das contas será ajustado automaticamente para cada registro excluído."})}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>_e(!1),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",disabled:Be,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ht,disabled:Be,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:Be?"Excluindo...":"Sim, excluir"})]})]})}),ba&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:at.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full p-6 space-y-4 max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[z?"Editar":"Nova"," ",n?"Receita":"Despesa"]}),(!n&&pe.length===0||oe.length===0)&&e.jsxs("div",{className:"p-3 bg-yellow-50 text-yellow-700 rounded-lg flex items-start gap-2 text-sm",children:[e.jsx(Ct,{size:16,className:"mt-0.5"}),e.jsxs("span",{children:["Atenção: Cadastre ",!n&&pe.length===0?e.jsx("b",{children:"Categorias de despesas"}):null,!n&&pe.length===0&&oe.length===0?" e ":"",oe.length===0?e.jsx("b",{children:"Contas Bancárias"}):null," antes de lançar."]})]}),e.jsxs("form",{onSubmit:ot,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n?e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paciente"}),e.jsx("input",{required:!0,name:"entity_name",value:t.entity_name,onChange:b,list:"entity_suggestions_top",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Digite o nome do paciente"}),e.jsx("datalist",{id:"entity_suggestions_top",children:Ga.filter(a=>(t.entity_name||"").length>=3?a.name?.toLowerCase().includes(t.entity_name.toLowerCase()):!0).slice(0,10).map(a=>e.jsx("option",{value:a.name},a.id))})]}):e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("input",{required:!0,name:"description",value:t.description,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Descreva a despesa"})]}),n&&e.jsxs("div",{className:"col-span-2 p-4 border border-gray-100 rounded-lg bg-white",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adicionar procedimento"}),e.jsxs("select",{value:ge,onChange:a=>oa(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),K.map(a=>e.jsxs("option",{value:a.id,children:[a.procedimento," (",P(a.valor_cobrado||0),")"]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Qtd."}),e.jsx("input",{type:"number",min:"1",value:la,onChange:a=>ia(a.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("button",{type:"button",onClick:ct,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[e.jsx(Ra,{size:16})," Adicionar"]})]}),E.length>0&&e.jsxs("div",{className:"mt-3 border border-gray-100 rounded-lg overflow-hidden",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Procedimento"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Qtd."}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Subtotal"}),e.jsx("th",{className:"px-3 py-2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:E.map(a=>{const s=K.find(l=>l.id===a.id),r=s?.valor_cobrado?Number(s.valor_cobrado):0;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-800",children:s?.procedimento||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:s?.categoria||"-"}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",min:"1",value:a.quantidade,onChange:l=>{const u=Math.max(1,parseInt(l.target.value||"1",10));xe(c=>c.map(m=>m.id===a.id?{...m,quantidade:u}:m))},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:P(r)}),e.jsx("td",{className:"px-3 py-2 text-gray-800 font-semibold",children:P(r*(a.quantidade||1))}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>xe(l=>l.filter(u=>u.id!==a.id)),className:"text-red-600 text-sm",children:"Remover"})})]},a.id)})})]}),e.jsxs("div",{className:"px-3 py-2 text-right text-sm font-semibold text-gray-800 bg-gray-50",children:["Subtotal procedimentos: ",P(dt)]})]})]}),e.jsxs("div",{className:"col-span-2 p-4 bg-gray-50 rounded-lg grid grid-cols-1 md:grid-cols-4 gap-4 border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Valor Bruto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold",children:"R$"}),e.jsx("input",{required:!0,name:"gross_amount",type:"number",step:"0.01",value:t.gross_amount,onChange:b,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0,00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold",children:"R$"}),e.jsx("input",{name:"discount",type:"number",step:"0.01",value:t.discount,onChange:b,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0,00"})]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Taxa (%)"}),e.jsx("input",{name:"tax_rate",type:"number",step:"0.01",value:t.tax_rate,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0"}),e.jsxs("div",{className:"text-xs text-red-500 mt-1 font-medium",children:["- R$ ",t.tax_amount]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Valor Líquido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-600 font-bold",children:"R$"}),e.jsx("input",{readOnly:!0,value:t.liquid_amount,className:"w-full pl-8 pr-3 py-2 border border-green-200 bg-green-50 text-green-700 font-bold rounded-lg outline-none"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n?"Data Competência":"Data da Compra"}),e.jsx("input",{required:!0,name:"date",type:"date",value:t.date,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Vencimento"}),e.jsx("input",{required:!0,name:"due_date",type:"date",value:t.due_date,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{required:!0,name:"category_id",value:t.category_id,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),pe.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conta Bancária"}),e.jsxs("select",{required:!0,name:"bank_account_id",value:t.bank_account_id,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),oe.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_conta||a.name||"Conta sem nome"," (",a.banco||a.bank||"Banco",")"]},a.id))]})]}),n?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pagamento"}),e.jsx("select",{name:"payment_method",value:t.payment_method,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:La.map(a=>e.jsx("option",{value:a,children:a},a))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor"}),e.jsxs("select",{value:xa,onChange:a=>{const s=a.target.value;Ae(s);const r=ma.find(l=>l.id===s);S(l=>({...l,entity_name:r?.nome||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione fornecedor..."}),ma.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pagamento"}),e.jsx("select",{name:"payment_method",value:t.payment_method,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:Ua.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de custo"}),e.jsxs("select",{name:"tipo_despesa",value:t.tipo_despesa||"",onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"fixo",children:"Fixo"}),e.jsx("option",{value:"variavel",children:"Variável"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pessoa"}),e.jsxs("select",{name:"pessoa_tipo",value:t.pessoa_tipo||"",onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"fisica",children:"Pessoa Física"}),e.jsx("option",{value:"juridica",children:"Pessoa Jurídica"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:t.status,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"pending",children:"À pagar"})]})]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profissional de venda"}),e.jsxs("select",{value:we.venda,onChange:a=>Ce(s=>({...s,venda:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),ca.filter(a=>a.tipo==="venda").map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profissional de execução"}),e.jsxs("select",{value:we.execucao,onChange:a=>Ce(s=>({...s,execucao:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),ca.filter(a=>a.tipo==="execucao").map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]})]}),n&&e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["Liquidação prevista: ",e.jsx("span",{className:"font-semibold text-gray-800",children:se(bt)})]}),e.jsx("span",{className:"text-gray-400",children:"Ajustada conforme a forma de pagamento"})]}),t.payment_method==="Cartão de Crédito"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bandeira"}),e.jsxs("select",{name:"card_brand",value:t.card_brand,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),Fe.map(a=>e.jsx("option",{value:a.bandeira,children:a.bandeira},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: 10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NSU"}),e.jsx("input",{name:"nsu",value:t.nsu,onChange:b,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Código autorizador"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Crédito: D+30 dias"})]}),t.payment_method==="Cartão de Débito"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NSU"}),e.jsx("input",{name:"nsu",value:t.nsu,onChange:b,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Código autorizador"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Débito: D+1 dia útil"})]}),t.payment_method==="Boleto"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Primeiro Vencimento"}),e.jsx("input",{name:"boleto_due_date",type:"date",value:t.boleto_due_date,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Boleto: conforme vencimento"})]}),ft>1&&e.jsxs("div",{className:"col-span-3 p-3 border border-gray-100 rounded-lg bg-gray-50 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Defina o vencimento de cada parcela."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:De.map((a,s)=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Parcela ",s+1]}),e.jsx("input",{type:"date",value:a.vencimento,onChange:r=>{const l=r.target.value;H(u=>{const c=[...u];return c[s]={...c[s],vencimento:l},c}),W(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]},`boleto-${s}`))})]})]}),t.payment_method==="Cheque"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número do Cheque"}),e.jsx("input",{name:"cheque_number",value:t.cheque_number,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Banco"}),e.jsx("input",{name:"cheque_bank",value:t.cheque_bank,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Vencimento"}),e.jsx("input",{name:"cheque_due_date",type:"date",value:t.cheque_due_date,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade de Folhas"}),e.jsx("input",{name:"cheque_pages",type:"number",min:"1",value:t.cheque_pages,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor por Folha"}),e.jsx("input",{name:"cheque_value",type:"number",step:"0.01",value:t.cheque_value,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Cheque: liquidação no vencimento"})]}),yt>1&&e.jsxs("div",{className:"col-span-3 p-3 border border-gray-100 rounded-lg bg-gray-50 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Defina o número da folha e o vencimento de cada cheque."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:De.map((a,s)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600",children:["Cheque ",s+1]}),e.jsx("input",{type:"text",value:a.numero_folha||"",onChange:r=>{const l=r.target.value;H(u=>{const c=[...u];return c[s]={...c[s],numero_folha:l},c}),W(!0)},placeholder:"Numero da folha",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"}),e.jsx("input",{type:"date",value:a.vencimento,onChange:r=>{const l=r.target.value;H(u=>{const c=[...u];return c[s]={...c[s],vencimento:l},c}),W(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]},`cheque-${s}`))})]})]})]}),!n&&e.jsxs("div",{className:"col-span-2 p-4 border border-gray-100 rounded-lg bg-gray-50 space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{id:"is_recurring",name:"is_recurring",type:"checkbox",checked:t.is_recurring,onChange:b,className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Este custo é recorrente?"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{id:"is_installment",name:"is_installment",type:"checkbox",checked:t.is_installment,onChange:b,className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Este custo é parcelado?"]})]}),t.is_recurring&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo"}),e.jsxs("select",{name:"recurrence_interval",value:t.recurrence_interval,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"quinzenal",children:"Quinzenal"}),e.jsx("option",{value:"mensal",children:"Mensal"}),e.jsx("option",{value:"trimestral",children:"Trimestral"}),e.jsx("option",{value:"anual",children:"Anual"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Repetições"}),e.jsx("input",{name:"recurrence_count",type:"number",min:"1",value:t.recurrence_count,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: 10"})]}),e.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:"As repetições serão lançamentos individuais seguindo o intervalo e vencimento informado."})]}),t.is_installment&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:"Valor será distribuído em parcelas a partir da primeira data de vencimento."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{name:"observations",rows:2,value:t.observations,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>Ue(),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:ja,className:"px-4 py-2 bg-brand-600 rounded-lg text-white hover:bg-brand-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[ja&&e.jsx(za,{size:16,className:"animate-spin"}),z?"Atualizar":"Salvar"]})]})]})]})}),Na&&U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:tt.onBackdropClick,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 space-y-4",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Registrar data de pagamento"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Despesa:"})," ",U.description||"Despesa"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vencimento:"})," ",se(U.data_vencimento||U.data_pagamento||U.data_competencia)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de pagamento real"}),e.jsx("input",{type:"date",value:ze,onChange:a=>$e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:Xe,className:"px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:async()=>{if(!ze){alert("Informe a data de pagamento.");return}const{error:a}=await y.from(N).update({data_pagamento:ze,status:"paid"}).eq("id",U.id);if(a){alert(`Erro ao registrar pagamento: ${a.message}`);return}if(U.status!=="paid"){const s=Number(U.valor||0);await ce(U.bank_account_id,-s)}Xe(),G()},className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:"Salvar"})]})]})})]})};export{Vt as default};
