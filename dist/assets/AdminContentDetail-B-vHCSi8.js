import{r as m,s as b,h as Z,a as G,b as H,j as e,L as O,R as W}from"./index-V1BrPv90.js";const L=o=>{const[r,d]=m.useState(o),[f,p]=m.useState(!0),[j,u]=m.useState(null);return{data:r,setData:d,loading:f,setLoading:p,error:j,setError:u}},X=o=>{const r=L(null),d=m.useCallback(async()=>{if(!o){r.setData(null),r.setLoading(!1);return}r.setLoading(!0);const{data:f,error:p}=await b.from("content_items").select("*").eq("id",o).maybeSingle();p&&r.setError(p.message),r.setData(f||null),r.setLoading(!1)},[o]);return m.useEffect(()=>{d()},[d]),{...r,refresh:d}},Y=o=>{const r=L([]),d=m.useCallback(async()=>{if(!o){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:f,error:p}=await b.from("content_modules").select("*").eq("content_id",o).order("order_index",{ascending:!0});p&&r.setError(p.message),r.setData(f||[]),r.setLoading(!1)},[o]);return m.useEffect(()=>{d()},[d]),{...r,refresh:d}},ee=o=>{const r=L([]),d=m.useCallback(async()=>{if(!o){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:f,error:p}=await b.from("content_lessons").select("*").eq("module_id",o).order("order_index",{ascending:!0});p&&r.setError(p.message),r.setData(f||[]),r.setLoading(!1)},[o]);return m.useEffect(()=>{d()},[d]),{...r,refresh:d}},R=o=>{const r=L([]),d=m.useCallback(async()=>{if(!o){r.setData([]),r.setLoading(!1);return}r.setLoading(!0);const{data:f,error:p}=await b.from("content_lesson_files").select("*").eq("lesson_id",o).order("created_at",{ascending:!1});p&&r.setError(p.message),r.setData(f||[]),r.setLoading(!1)},[o]);return m.useEffect(()=>{d()},[d]),{...r,refresh:d}},te=o=>{const{contentId:r,moduleId:d,lessonId:f,studentUserId:p}=o,j=L([]),u=m.useMemo(()=>JSON.stringify(o),[o]),i=m.useCallback(async()=>{if(!r){j.setData([]),j.setLoading(!1);return}j.setLoading(!0);let g=b.from("content_comments").select("*").eq("content_id",r).order("created_at",{ascending:!1});d&&(g=g.eq("module_id",d)),f&&(g=g.eq("lesson_id",f)),p&&(g=g.eq("student_user_id",p));const{data:h,error:_}=await g;_&&j.setError(_.message),j.setData(h||[]),j.setLoading(!1)},[r,d,f,p]);return m.useEffect(()=>{i()},[i,u]),{...j,refresh:i}},P="content-files",re=o=>{const{data:r}=b.storage.from(P).getPublicUrl(o);return r.publicUrl},ae=o=>{const r=`/storage/v1/object/public/${P}/`,d=o.indexOf(r);return d===-1?null:o.slice(d+r.length)},B=o=>o.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")||`file-${crypto.randomUUID()}`,V=async(o,r)=>{const{error:d}=await b.storage.from(P).upload(o,r,{upsert:!0});if(d)throw d;return re(o)},se=({lessonId:o})=>{const{data:r,refresh:d}=R(o),[f,p]=m.useState(!1),j=async i=>{p(!0);try{const g=B(i.name),h=`lesson-files/${o}/${crypto.randomUUID()}-${g}`,_=await V(h,i),{error:N}=await b.from("content_lesson_files").insert({lesson_id:o,file_name:i.name,file_url:_});if(N){alert(`Erro ao salvar arquivo: ${N.message}`);return}d()}catch(g){alert(`Erro ao enviar arquivo: ${g.message}`)}finally{p(!1)}},u=async(i,g)=>{if(confirm("Excluir arquivo?"))try{if(g){const _=ae(g);if(_){const{error:N}=await b.storage.from(P).remove([_]);if(N){alert(`Erro ao remover arquivo do storage: ${N.message}`);return}}}const{error:h}=await b.from("content_lesson_files").delete().eq("id",i);if(h){alert(`Erro ao excluir arquivo: ${h.message}`);return}d()}catch(h){alert(`Erro ao excluir arquivo: ${h.message}`)}};return e.jsxs("div",{className:"mt-2 border border-gray-100 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Materiais"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-brand-50 text-brand-700 rounded cursor-pointer",children:[f?"Enviando...":"Adicionar arquivo",e.jsx("input",{type:"file",className:"hidden",onChange:i=>{const g=i.target.files?.[0];g&&j(g),i.currentTarget.value=""}})]})]}),r.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"Nenhum arquivo anexado."}):e.jsx("div",{className:"space-y-2",children:r.map(i=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("a",{href:i.file_url||"#",target:"_blank",rel:"noreferrer",className:"text-brand-600 hover:underline",children:i.file_name||"Arquivo"}),e.jsx("button",{type:"button",onClick:()=>u(i.id,i.file_url),className:"text-xs text-red-600 hover:underline",children:"Excluir"})]},i.id))})]})},ne=({lessonId:o})=>{const{data:r}=R(o),d=r.length;return e.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded",children:[d," arquivo",d===1?"":"s"]})},oe=({moduleId:o})=>{const{data:r,refresh:d}=ee(o),[f,p]=m.useState(null),[j,u]=m.useState({}),[i,g]=m.useState({title:"",description:"",panda_video_id:"",panda_video_url:"",order_index:1,published:!1});m.useEffect(()=>{const s={};r.forEach(n=>{s[n.id]={title:n.title||"",description:n.description||"",panda_video_id:n.panda_video_id||"",panda_video_url:n.panda_video_url||"",order_index:n.order_index??0,published:!!n.published}}),u(s)},[r]);const h=async s=>{const n=j[s];if(!n)return;if(n.published&&!n.panda_video_id){alert("Informe o Panda Video ID para publicar a aula.");return}const{error:a}=await b.from("content_lessons").update({title:n.title.trim(),description:n.description||null,panda_video_id:n.panda_video_id||null,panda_video_url:n.panda_video_url||null,order_index:n.order_index,published:n.published}).eq("id",s);if(a){alert(`Erro ao salvar aula: ${a.message}`);return}d()},_=async s=>{if(!confirm("Excluir aula?"))return;const{error:n}=await b.from("content_lessons").delete().eq("id",s);if(n){alert(`Erro ao excluir aula: ${n.message}`);return}d()},N=async()=>{if(!i.title.trim())return;if(i.published&&!i.panda_video_id){alert("Informe o Panda Video ID para publicar a aula.");return}const{error:s}=await b.from("content_lessons").insert({module_id:o,title:i.title.trim(),description:i.description||null,panda_video_id:i.panda_video_id||null,panda_video_url:i.panda_video_url||null,order_index:i.order_index,published:i.published});if(s){alert(`Erro ao criar aula: ${s.message}`);return}g({title:"",description:"",panda_video_id:"",panda_video_url:"",order_index:i.order_index+1,published:!1}),d()},E=async(s,n)=>{const a=r.findIndex(U=>U.id===s);if(a===-1)return;const x=n==="up"?a-1:a+1;if(x<0||x>=r.length)return;const S=r[a],k=r[x],{error:D}=await b.from("content_lessons").update({order_index:k.order_index}).eq("id",S.id);if(D){alert(`Erro ao reordenar aulas: ${D.message}`);return}const{error:q}=await b.from("content_lessons").update({order_index:S.order_index}).eq("id",k.id);if(q){alert(`Erro ao reordenar aulas: ${q.message}`);return}d()};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"overflow-x-auto border border-gray-100 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Ordem"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Aula"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Descrição"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Panda ID"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Arquivos"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[r.map(s=>{const n=j[s.id];return e.jsxs(W.Fragment,{children:[e.jsxs("tr",{className:"align-top",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:n?.order_index??0,onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],order_index:Number(a.target.value)}})),onClick:a=>a.stopPropagation(),className:"w-16 px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{type:"button",onClick:()=>E(s.id,"up"),className:"text-xs text-gray-500 hover:text-gray-700",children:"↑"}),e.jsx("button",{type:"button",onClick:()=>E(s.id,"down"),className:"text-xs text-gray-500 hover:text-gray-700",children:"↓"})]})]})}),e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("input",{value:n?.title||"",onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],title:a.target.value}})),onClick:a=>a.stopPropagation(),className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-500 mt-2",children:[e.jsx("input",{type:"checkbox",checked:!!n?.published,onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],published:a.target.checked}})),onClick:a=>a.stopPropagation()}),"Publicado"]})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("textarea",{value:n?.description||"",onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],description:a.target.value}})),onClick:a=>a.stopPropagation(),rows:2,className:"w-full px-2 py-1 border border-gray-300 rounded"})}),e.jsxs("td",{className:"px-3 py-2 space-y-2",children:[e.jsx("input",{value:n?.panda_video_id||"",onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],panda_video_id:a.target.value}})),onClick:a=>a.stopPropagation(),placeholder:"ID do Panda",className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:n?.panda_video_url||"",onChange:a=>u(x=>({...x,[s.id]:{...x[s.id],panda_video_url:a.target.value}})),onClick:a=>a.stopPropagation(),placeholder:"URL/Embed",className:"w-full px-2 py-1 border border-gray-300 rounded"})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("button",{type:"button",onClick:()=>p(f===s.id?null:s.id),className:"flex items-center gap-2 text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",children:[e.jsx("span",{children:"Arquivos"}),e.jsx(ne,{lessonId:s.id})]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h(s.id),onMouseDown:a=>a.stopPropagation(),className:"text-xs px-2 py-1 bg-gray-900 text-white rounded",children:"Salvar"}),e.jsx("button",{type:"button",onClick:()=>_(s.id),onMouseDown:a=>a.stopPropagation(),className:"text-xs text-red-600 hover:underline",children:"Excluir"})]})})]}),f===s.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 pb-4",children:e.jsx(se,{lessonId:s.id})})})]},s.id)}),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-4 text-sm text-gray-500",children:"Nenhuma aula cadastrada."})})]})]})}),e.jsxs("div",{className:"border border-dashed border-gray-200 rounded-lg p-3 space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Nova aula"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{value:i.title,onChange:s=>g(n=>({...n,title:s.target.value})),placeholder:"Título",className:"px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:i.panda_video_id,onChange:s=>g(n=>({...n,panda_video_id:s.target.value})),placeholder:"Panda Video ID",className:"px-2 py-1 border border-gray-300 rounded"})]}),e.jsx("textarea",{value:i.description,onChange:s=>g(n=>({...n,description:s.target.value})),placeholder:"Descrição",rows:2,className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{value:i.panda_video_url,onChange:s=>g(n=>({...n,panda_video_url:s.target.value})),placeholder:"URL/Embed (opcional)",className:"w-full px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center text-sm text-gray-600",children:[e.jsxs("label",{className:"flex items-center gap-2",children:["Ordem",e.jsx("input",{type:"number",value:i.order_index,onChange:s=>g(n=>({...n,order_index:Number(s.target.value)})),className:"w-20 px-2 py-1 border border-gray-300 rounded"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.published,onChange:s=>g(n=>({...n,published:s.target.checked}))}),"Publicado"]}),e.jsx("button",{type:"button",onClick:N,className:"px-3 py-2 bg-brand-600 text-white rounded-lg text-sm",children:"Adicionar aula"})]})]})]})},le=()=>{const{id:o}=Z(),[r,d]=G(),f=H(),p=r.get("tab")||"about",j=r.get("type"),{data:u,loading:i,refresh:g}=X(o),{data:h,refresh:_}=Y(o),[N,E]=m.useState(!1),[s,n]=m.useState({}),[a,x]=m.useState({title:"",description:"",thumbnail_url:"",banner_url:"",published:!1});m.useEffect(()=>{u&&x({title:u.title||"",description:u.description||"",thumbnail_url:u.thumbnail_url||"",banner_url:u.banner_url||"",published:!!u.published})},[u]),m.useEffect(()=>{const t={};h.forEach(l=>{t[l.id]={title:l.title||"",order_index:l.order_index??0}}),n(t)},[h]);const S=async()=>{if(u){E(!0);try{const{error:t}=await b.from("content_items").update({title:a.title.trim(),description:a.description||null,thumbnail_url:a.thumbnail_url||null,banner_url:a.banner_url||null,published:a.published}).eq("id",u.id);if(t){alert(`Erro ao salvar conteúdo: ${t.message}`);return}g()}catch(t){alert(`Erro ao salvar conteúdo: ${t.message}`)}finally{E(!1)}}},k=async(t,l)=>{if(u?.id)try{const y=B(t.name),c=`content-items/${u.id}/${l}-${crypto.randomUUID()}-${y}`,v=await V(c,t);x(C=>({...C,thumbnail_url:l==="thumbnail"?v:C.thumbnail_url,banner_url:l==="banner"?v:C.banner_url}))}catch(y){alert(`Erro ao enviar imagem: ${y.message}`)}},D=async()=>{if(!u?.id)return;const{error:t}=await b.from("content_modules").insert({content_id:u.id,title:"Novo módulo",order_index:h.length+1});if(t){alert(`Erro ao criar módulo: ${t.message}`);return}_()},q=async(t,l,y)=>{const{error:c}=await b.from("content_modules").update({title:l.trim(),order_index:y}).eq("id",t);if(c){alert(`Erro ao atualizar módulo: ${c.message}`);return}_()},U=async t=>{if(!confirm("Excluir módulo?"))return;const{error:l}=await b.from("content_modules").delete().eq("id",t);if(l){alert(`Erro ao excluir módulo: ${l.message}`);return}_()},I=async(t,l)=>{const y=h.findIndex(Q=>Q.id===t);if(y===-1)return;const c=l==="up"?y-1:y+1;if(c<0||c>=h.length)return;const v=h[y],C=h[c],{error:A}=await b.from("content_modules").update({order_index:C.order_index}).eq("id",v.id);if(A){alert(`Erro ao reordenar módulos: ${A.message}`);return}const{error:F}=await b.from("content_modules").update({order_index:v.order_index}).eq("id",C.id);if(F){alert(`Erro ao reordenar módulos: ${F.message}`);return}_()},{data:$,refresh:z}=te({contentId:o||null,moduleId:r.get("module")||null,lessonId:r.get("lesson")||null,studentUserId:r.get("student")||null}),[K,M]=m.useState([]),[J,T]=m.useState([]);if(m.useEffect(()=>{(async()=>{if(!h.length){T([]);return}const l=h.map(c=>c.id),{data:y}=await b.from("content_lessons").select("id, module_id, title").in("module_id",l).order("order_index",{ascending:!0});T(y||[])})()},[h]),m.useEffect(()=>{(async()=>{const l=Array.from(new Set($.map(v=>v.student_user_id).filter(Boolean)));if(!l.length){M([]);return}const{data:y}=await b.from("profiles").select("id, full_name").in("id",l),c=(y||[]).map(v=>({id:v.id,name:v.full_name||v.id}));M(c)})()},[$]),i)return e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"Carregando conteúdo..."});if(!u)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-500",children:"Conteúdo não encontrado."}),e.jsx(O,{to:"/admin/content",className:"text-brand-600 hover:underline",children:"Voltar"})]});const w=j||u.type;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{to:`/admin/content?type=${w}`,className:"text-sm text-brand-600 hover:underline",children:"← Voltar para lista"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mt-2",children:u.title||"Sem título"}),e.jsx("p",{className:"text-gray-500",children:u.type==="course"?"Curso":"Treinamento"})]}),e.jsx("button",{type:"button",onClick:()=>f(`/admin/content?type=${w}`),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50",children:"Fechar"})]}),e.jsx("div",{className:"flex gap-2",children:["about","modules","comments"].map(t=>e.jsx("button",{type:"button",onClick:()=>d({tab:t,type:w}),className:`px-3 py-2 text-sm rounded-lg border ${p===t?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:t==="about"?"Sobre":t==="modules"?"Módulos":"Comentários"},t))}),p==="about"&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Sobre"}),e.jsx("button",{type:"button",onClick:S,disabled:N,className:"px-4 py-2 bg-brand-600 text-white rounded-lg text-sm hover:bg-brand-700 disabled:opacity-50",children:N?"Salvando...":"Salvar"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:a.title,onChange:t=>x(l=>({...l,title:t.target.value})),placeholder:"Nome",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{value:a.description,onChange:t=>x(l=>({...l,description:t.target.value})),placeholder:"Descrição",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:a.published,onChange:t=>x(l=>({...l,published:t.target.checked}))}),"Publicado"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Thumbnail URL"}),e.jsx("input",{value:a.thumbnail_url,onChange:t=>x(l=>({...l,thumbnail_url:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-gray-100 rounded cursor-pointer inline-block",children:[a.thumbnail_url?"Trocar thumbnail":"Upload thumbnail",e.jsx("input",{type:"file",className:"hidden",onChange:t=>{const l=t.target.files?.[0];l&&k(l,"thumbnail"),t.currentTarget.value=""}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Banner URL"}),e.jsx("input",{value:a.banner_url,onChange:t=>x(l=>({...l,banner_url:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("label",{className:"text-xs px-2 py-1 bg-gray-100 rounded cursor-pointer inline-block",children:[a.banner_url?"Trocar banner":"Upload banner",e.jsx("input",{type:"file",className:"hidden",onChange:t=>{const l=t.target.files?.[0];l&&k(l,"banner"),t.currentTarget.value=""}})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:a.banner_url?e.jsx("img",{src:a.banner_url,alt:"Banner",className:"w-full h-32 object-cover"}):e.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center text-xs text-gray-400",children:"Banner 1250x250"})}),e.jsx("div",{className:"border border-gray-100 rounded-lg overflow-hidden w-40 h-40",children:a.thumbnail_url?e.jsx("img",{src:a.thumbnail_url,alt:"Thumbnail",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-xs text-gray-400",children:"Thumbnail"})})]})]})]}),p==="modules"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Módulos"}),e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 bg-brand-600 text-white rounded-lg text-sm",children:"Novo módulo"})]}),h.length===0?e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-6 text-gray-500 text-sm",children:"Nenhum módulo cadastrado."}):e.jsx("div",{className:"space-y-3",children:h.map((t,l)=>{const y=s[t.id];return e.jsxs("details",{open:!0,className:"bg-white border border-gray-100 rounded-xl p-4 space-y-3",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:y?.title||"",onChange:c=>n(v=>({...v,[t.id]:{title:c.target.value,order_index:v[t.id]?.order_index??0}})),onClick:c=>c.stopPropagation(),className:"px-2 py-1 border border-gray-300 rounded"}),e.jsx("input",{type:"number",value:y?.order_index??0,onChange:c=>n(v=>({...v,[t.id]:{title:v[t.id]?.title||"",order_index:Number(c.target.value)}})),onClick:c=>c.stopPropagation(),className:"w-20 px-2 py-1 border border-gray-300 rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),I(t.id,"up")},className:"text-xs text-gray-500 hover:text-gray-700",children:"↑"}),e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),I(t.id,"down")},className:"text-xs text-gray-500 hover:text-gray-700",children:"↓"})]}),e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),q(t.id,y?.title||"",y?.order_index??0)},className:"text-xs px-2 py-1 bg-gray-900 text-white rounded",children:"Salvar"}),e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),U(t.id)},className:"text-xs text-red-600 hover:underline",children:"Excluir"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Módulo ",l+1]})]}),e.jsx(oe,{moduleId:t.id})]},t.id)})})]}),p==="comments"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Comentários"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:r.get("module")||"",onChange:t=>d({tab:"comments",type:w,module:t.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todos os módulos"}),h.map(t=>e.jsx("option",{value:t.id,children:t.title||"Sem módulo"},t.id))]}),e.jsxs("select",{value:r.get("lesson")||"",onChange:t=>d({tab:"comments",type:w,module:r.get("module")||"",lesson:t.target.value,student:r.get("student")||""}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todas as aulas"}),J.filter(t=>{const l=r.get("module");return l?t.module_id===l:!0}).map(t=>e.jsx("option",{value:t.id,children:t.title||t.id},t.id))]}),e.jsxs("select",{value:r.get("student")||"",onChange:t=>d({tab:"comments",type:w,module:r.get("module")||"",lesson:r.get("lesson")||"",student:t.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todos os alunos"}),K.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl divide-y divide-gray-100",children:[$.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"Nenhum comentário encontrado."}),$.map(t=>e.jsxs("details",{className:"p-4",children:[e.jsxs("summary",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Comentário"}),e.jsx("p",{className:"text-xs text-gray-500",children:t.created_at?.slice(0,10)})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t.status==="answered"?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"}`,children:t.status==="answered"?"Respondido":"Pendente"})]}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:t.content||"Sem conteúdo."}),t.status!=="answered"&&e.jsx("button",{type:"button",onClick:async()=>{await b.from("content_comments").update({status:"answered"}).eq("id",t.id),z()},className:"text-xs text-brand-600 hover:underline",children:"Marcar como respondido"})]})]},t.id))]})]})]})};export{le as default};
